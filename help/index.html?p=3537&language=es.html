<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>

<title>Tractis - Contracts you can enforce</title>
<!-- Mimic Internet Explorer 7 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" >
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="shortcut icon" type="image/x-icon" href="../images/tractis-help-favicon.ico" />
<link rel="shortcut icon" type="image/icon" href="../images/tractis-help-favicon.ico" />
<link rel="apple-touch-icon" href="https://www.tractis.com/images/iphone-favicon.png" />
<link href="../stylesheets/tractis/main.css%3F1521105613.css" media="screen" rel="stylesheet" type="text/css" />
<link href="../stylesheets/island_tractis.css%3F1521105588.css" media="screen" rel="stylesheet" type="text/css" />

<!--[if lte IE 6]>
  <link href="/stylesheets/ie6.css?1521105588" media="screen" rel="stylesheet" type="text/css" />    
  <![endif]-->
<!--[if gte IE 7]>
  <link href="/stylesheets/ie7.css?1521105588" media="screen" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel="stylesheet" href="wp-content/themes/tractis/style.css" type="text/css" media="screen" title="no title" charset="utf-8" />
<link rel="stylesheet" href="../stylesheets/print-help.css" type="text/css" media="print" />
  <script type="text/javascript" src="../jquery/jquery.js%3F1360401146"></script>
  <script>jQuery.noConflict();</script>
  
  	
  
</head>

<body id="tractis-help">
<div id="topbar" class="classname">
<div class="fill">
  <ul class="mainbar">





      <li><a href="/">Home</a></li>





      





      

    </ul>
    
      <p class="loginbar">
        
        
      </p>
    
    <div class="clear"></div>
  </div>
</div>


<div id="header">
  <div class="logo">
    <h1><a href="/">Tractis</a></h1>
    
      <ol>
  <li><strong>Spain</strong></li>
  
    <li><div id="change_contry"><a href="index.html%3Fp=3537&amp;language=es.html#" onclick="tractis_ajax(&quot;/pagepart/change_country&quot;, 'change_contry'); return false;">Change country</a></div></li>
  
</ol>
<ol>
  <li><strong>in English</strong></li>
  <li><a href="index.html%3Fp=3537&amp;language=es.html#" onclick="tractis_ajax_link(&quot;/pagepart/change_lang?lang=ca&amp;format=html&quot;, true); return false;">Catalan</a> · <a href="index.html%3Fp=3537&amp;language=es.html#" onclick="tractis_ajax_link(&quot;/pagepart/change_lang?lang=es&amp;format=html&quot;, true); return false;">Spanish</a></li>
</ol>

    
    <div class="clear"></div>
  </div>

  
  
  <div class="clear"></div>
</div>










<script type="text/javascript">
//<![CDATA[

	window.onload = function() { document.title='Tractis - ¿Cómo puedo utilizar Tractis Verifications?'.replace(/</g,'&lt;').replace(/>/g,'&gt;').unescapeHTML() } 
//]]>

</script>
<div id="breadcrumb">
<p><strong>Te encuentras aquí:</strong> <a href="/help">Ayuda</a>  <a href='index.html%3Fp=3537&amp;language=es.html'></a> → <a href='index.html%3Fcat=266&amp;language=es.html'>Tractis Identity</a> → <a href='index.html%3Fcat=6&amp;language=es.html'>Tractis Verifications</a> → <a href='index.html%3Fcat=233&amp;language=es.html'>Conceptos básicos</a> </p>
</div>
<div id="subheader">
<div class="titles">
<h2>Ayuda</h2>
</div>
<div class="clear"></div>
</div>

<div id="main">
<div id="content">
<div class="help-search">
	<form method="get" id="searchform" action="index.html">
	<table border="0" cellpadding="5">
		<tr>
			<td class="nowrap" style="width:50%"><label>¿Cómo podemos ayudarte?:</label></td>
			<td style="width:43%"><input type="text" value="" name="s" id="s" /></td>
			<td><input type="submit" id="searchsubmit" value="Buscar" /></td>
		</tr>
	</table>
	</form>
</div>
		

<div class="post" id="post-3537">
			
			<div class="post-header">
				<h3>¿Cómo puedo utilizar Tractis Verifications?</h3>
			</div>

			<div class="entry">
				
				<p>Tractis Identity te ofrece la posibilidad de verificar la identidad de tus usuarios mediante DNI electrónico y <a href="https://www.tractis.com/supported_certificates">otros certificados electrónicos</a>. Estas verificaciones pueden utilizarse como pasarelas de autenticación fuerte para ofrecer login con certificados a tus usuarios o creando verificaciones de identidad públicas para mostrar perfiles de usuarios certificados en tu web.</p>
<p>Para poder usar este servicio previamente <a href="index.html%3Fp=3191&amp;language=es.html">debes obtener una API Key de una Verificación de Identidad</a>.</p>
<p>Una vez dispongamos de la <em>API Key</em> la integración consta de dos partes:</p>
<ol>
<li>Crear un formulario HTML para acceder a la pasarela</li>
<li>Verificación de los datos recogidos por la pasarela</li>
</ol>
<h3 id="form">Creación del formulario HTML</h3>
<p>El formulario HTML es muy sencillo. Se compone de la siguiente forma:</p>
<pre><code>
&lt;form method="post" action="<a href="https://www.tractis.com/verifications" target="_blank">https://www.tractis.com/verifications</a>"&gt;
&lt;input type="hidden" value="IDENTIFICADOR_DE_TU_API_KEY" name="api_key"/&gt;
&lt;input type="hidden" value="URL_DONDE_DEBE_VOLVER_EL_USUARIO" name="notification_callback"/&gt;
&lt;input type="submit" value="Hacer login" name="commit"/&gt;
<em>&lt;!-- OPCIONAL: el campo public_verification es opcional --&gt;</em>
&lt;input type="hidden" value="true" name="public_verification"/&gt;
&lt;/form&gt;</code></pre>
<p>El formulario consta de los siguientes parámetros:</p>
<ul>
<li><code>api_key</code>: Identificador de la API Key de la pasarela de verificación de identidad.</li>
<li><code>notification_callback</code>: URL a la que se dirigirá al usuario una vez completada la verificación de su identidad. En esta URL se recibirán como parámetros GET el resultado del proceso.</li>
<li><code>public_verification</code> <em>(opcional)</em>: Si añadimos el parámetro <code>public_verification=true</code> indicaremos que la verificación de identidad es pública y el proceso nos devolverá una URL con la prueba de la verificación para que podamos enlazarla en nuestro sitio web.</li>
</ul>
<h3 id="get_data">Recepción de los datos</h3>
<p>Una vez completado el proceso identificación en la pasarela de verificaciones de identidad el usuario será dirigido al <code>notification_callback</code>. Si el <code>notification_callback</code> fuera <code>http://www.mysite.com/login</code> la url con la que nos llamaran será algo parecido a la siguiente :</p>
<pre><code>http://www.mysite.com/login?
    <strong>token</strong>=cc9b9fe0965f471e50b2d9e5c31bfa4a9d42af5d
   &amp;<strong>tractis%3Aattribute%3Adni</strong>=44183781E
   &amp;<strong>tractis%3Aattribute%3Aname</strong>=DAVID+GARCIA+GARCIA
   &amp;<strong>verification_code</strong>=e8b54d1bc09da6ab056cb8450487e49279b2ab83
   &amp;<strong>tractis%3Aattribute%3Aissuer</strong>=DIRECCION+GENERAL+DE+LA+POLICIA
</code></pre>
<p>Aquí podemos ver que Tractis nos devuelve una serie de parámetros que identifican la transacción de la pasarela y los atributos sobre el usuario que han sido verificados:</p>
<ul>
<li><code>tractis:attribute:dni=44183781E</code>: El número de dni del usuario que se ha logado</li>
<li><code>tractis:attribute:name=DAVID GARCIA GARCIA</code>: El nombre del usuario que se ha logado</li>
<li><code>tractis:attribute:issuer=DIRECCION GENERAL DE LA POLICIA</code>: El emisor del certificado que ha sido usado, en este caso corresponde al emisor del dnie</li>
</ul>
<p>Si se tratara de una verificación pública (con el argumento <code>public_verification=true</code> en el formulario) recibiríamos además el siguiente parámetro:</p>
<ul>
<li><code>verification_url=https://www.tractis.com/verifications/cc9b9fe0965f471e50b2d9e5c31bfa4a9d42af5d</code>: En esta URL se certifica cuáles han sido los atributos extraidos en la verificación. La URL solo será accesible mediante un enlace desde tu sitio web.</li>
</ul>
<p>Tractis solamente llamará a la URL de notification_callback si el certificado el válido.</p>
<p><strong>Nuevo:</strong> Por defecto el método HTTP de retorno cuando se ha producido la verificación de identidad con éxito es GET. Es posible configurar la API Key para que la vuelta se produzca usando el método HTTP POST, para ello tendrás que cambiar la opción en la configuración de la API Key y adaptar la recepción de atributos.</p>
<h3 id="verify">Verificación de los datos recogidos por la pasarela</h3>
<p>Una vez recibidos los datos del usuario <strong>hemos de verificar el resultado recibido para evitar que alguien haya llamado a nuestra URL de notification_callback haciéndose pasar por Tractis e intentando engañar a nuestro sistema</strong>.</p>
<p>Para verificar la autenticidad del resultado debemos llamar a <a href="https://www.tractis.com/data_verification">https://www.tractis.com/data_verification</a>&#8216; usando el método POST y pasándole <strong>nuestra API Key y todos los datos recibidos en el callback</strong>.</p>
<p>Tractis nos responderá con un código de status HTTP. Si el código es 200 los datos son fiables y podemos proceder, si el código es otro simplemente debemos ignorar el resultado y mostrar un error.</p>
<p>IMPORTANTE: Tractis no permite utilizar una misma verificación varias veces así que la verificación solo funcionará una vez para cada verificación. Si intentamos verificar los datos una segunda vez Tractis no dará por válida la verificación.</p>
<h3>Un ejemplo en código</h3>
<p>A continuación damos un ejemplo en php para ver lo simple que sería el integrarse con una pasarela.</p>
<p>El formulario de login lo pondremos dentro de una página welcome.html. Éste será el formulario que debe enviar el usuario a Tractis para poder empezar el proceso:</p>
<pre><code>
&lt;html&gt;
&lt;body&gt;
Form test&lt;br/&gt;
&lt;form method="post" action="<a href="https://www.tractis.com/verifications">https://www.tractis.com/verifications</a>"&gt;
&lt;input type="hidden" value="AQUI_TU_API_KEY" name="api_key" id="api_key"/&gt;
&lt;input type="hidden" value="AQUI_LA_URL_DE_TU_CALLBACK" name="notification_callback" id="notification_callback"/&gt;
&lt;input type="submit" value="Hacer login" name="commit"/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Como puede verse en el código anterior debemos configurar el parámetro notification_callback de manera que apunte a la url que procesará el resultado de la verificación de identidad en nuestro site.</p>
<p>Suponiendo que hemos puesto como valor <a href="http://www.example.com/auth-result.php" target="_blank">http://www.example.com/auth-result.php</a> (siendo <a href="http://www.example.com/" target="_blank">www.example.com</a> nuestro servidor web) deberemos disponer de una página llamada auth-result.php con un contenido como el siguiente:</p>
<pre><code>
&lt;html&gt;
&lt;body&gt;
&lt;?php

$s = curl_init();

curl_setopt($s,CURLOPT_URL,"<a href="https://www.tractis.com/data_verification" target="_blank">https://www.tractis.com/data_verification</a>");
curl_setopt($s,CURLOPT_POST,true);

// Tenemos que pasarle a /data_verifications todos los parámetros que nos ha enviado Tractis
// junto con nuestra API Key
$_GET['api_key'] = "AQUI_TU_API_KEY";
curl_setopt($s,CURLOPT_POSTFIELDS,$_GET);

curl_exec($s);
$status = curl_getinfo($s,CURLINFO_HTTP_CODE);

echo  "HTTP status " . $status . "&lt;br/&gt;";

if ($status == 200){
echo "Auth ok dni is " . $_GET["tractis:attribute:dni"];
}else{
echo "Auth failed";
}

?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>NOTA: Usamos la librería curl de php para hacer las llamadas de verificación. Para saber como instalarla o utilizarla mas allá de los usos expuestos consulta la documentación relativa a la misma dentro de la documentación de PHP.</p>
<p>Esta página llamará a Tractis, le pedirá que verifique que los datos son correctos, y si estos lo son, Tractis le devolverá un código HTTP 200 indicando que la información es fiable. Otro código distinto implicará que la información no es fiable y por lo tanto debe ser descartada.</p>
<p>Para acceder a la información sobre los atributos del usuario solamente debemos preguntar a la variable $_GET que contendrá todos los atributos verificados.</p>
<p>Por ejemplo el dni del usuario se encuentra en $_GET["tractis:attribute:dni"], el nombre en $_GET["tractis:attribute:name"] .</p>

				

			</div>

	</div>
</div>

	<div id="menu">
		<script type="text/javascript">function setLang() {document.getElementById("glink").href = "https://translate.google.com/translate?u=http://www.tractis.com/help/?p=3537&sl=es&tl=" + document.fgt.tl.value;return;} </script><div class="menus info"><div class="mtitle"><h3>Translate this article</h3></div><form name="fgt" action="https://translate.google.com/translate" method="GET"><input type="hidden" name="u" value="http://www.tractis.com/help/?p=3537" /><input name="sl" value="es" type="hidden" /><div class="mcontent"><p>Select your language and translate this article using Google Translate.</p><div class="grilla"><div class="labels"><label>Translate to:</label></div><div class="inputs"><select name="tl" style="width:auto" onChange="setLang()" ><option value='' selected >Choose your language...</option>
<option value='ar'>Arabic</option>
<option value='bg'>Bulgarian</option>
<option value='ca'>Catalan</option>
<option value='zh-CN'>Chinese (Simplified)</option>
<option value='zh-TW'>Chinese (Traditional)</option>
<option value='hr'>Croatian</option>
<option value='cs'>Czech</option>
<option value='da'>Danish</option>
<option value='nl'>Dutch</option>
<option value='en'>English</option>
<option value='tl'>Filipino</option>
<option value='fi'>Finnish</option>
<option value='fr'>French</option>
<option value='de'>German</option>
<option value='el'>Greek</option>
<option value='iw'>Hebrew</option>
<option value='hi'>Hindi</option>
<option value='id'>Indonesian</option>
<option value='it'>Italian</option>
<option value='ja'>Japanese</option>
<option value='ko'>Korean</option>
<option value='lv'>Latvian</option>
<option value='lt'>Lithuanian</option>
<option value='no'>Norwegian</option>
<option value='pl'>Polish</option>
<option value='pt'>Portuguese</option>
<option value='ro'>Romanian</option>
<option value='ru'>Russian</option>
<option value='sr'>Serbian</option>
<option value='sk'>Slovak</option>
<option value='sl'>Slovenian</option>
<option value='es'>Spanish</option>
<option value='sv'>Swedish</option>
<option value='uk'>Ukrainian</option>
<option value='vi'>Vietnamese</option>
</select></div><div class="clear"></div></div></div><div class="mfooter"><a class="button" id="glink" href="index.html%3Fp=3537&amp;language=es.html#" >Translate</a></h3></div></form></div>				
	</div>
	
	<div class="clear"></div>

</div>





<div id="footer">
  
  <h6 class="isologo">Tractis</h6>
  <p>© 2018 Tractis. ·
  <a href="https://www.tractis.com/legal_notice">Legal Notice</a> ·
  <a href="https://www.tractis.com/terms_of_service">Terms of Service</a> ·
  <a href="https://www.tractis.com/privacy_policy">Privacy Policy</a> ·
  <a href="https://www.tractis.com/help">Help</a> ·
  
  <a href="mailto:tractis@tractis.comm">Contact</a></p>
  
  
  
  <div class="clear"></div>
</div>



<script src="../javascripts/tractis/en.js%3F1502104086" type="text/javascript"></script>





<script src="../javascripts/certificate_hunter.js%3F1521105588" type="text/javascript"></script>
<div id="alerts"><input id="alerts-shown" name="alerts-shown" type="hidden" value="false" /><script type="text/javascript">
//<![CDATA[
Alerts.initial(function(){
  
});
//]]>
</script></div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-128262-1");
pageTracker._setDomainName(".tractis.com");
pageTracker._trackPageview();
} catch(err) {}</script>


  </body>
</html>