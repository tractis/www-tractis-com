var Prototype={Version:"1.6.0.3",Browser:{IE:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1),Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement("div")["__proto__"]&&document.createElement("div")["__proto__"]!==document.createElement("form")["__proto__"]},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Class={create:function(){var f=null,e=$A(arguments);if(Object.isFunction(e[0])){f=e.shift()}function a(){this.initialize.apply(this,arguments)}Object.extend(a,Class.Methods);a.superclass=f;a.subclasses=[];if(f){var b=function(){};b.prototype=f.prototype;a.prototype=new b;f.subclasses.push(a)}for(var d=0;d<e.length;d++){a.addMethods(e[d])}if(!a.prototype.initialize){a.prototype.initialize=Prototype.emptyFunction}a.prototype.constructor=a;return a}};Class.Methods={addMethods:function(h){var d=this.superclass&&this.superclass.prototype;var b=Object.keys(h);if(!Object.keys({toString:true}).length){b.push("toString","valueOf")}for(var a=0,e=b.length;a<e;a++){var g=b[a],f=h[g];if(d&&Object.isFunction(f)&&f.argumentNames().first()=="$super"){var j=f;f=(function(k){return function(){return d[k].apply(this,arguments)}})(g).wrap(j);f.valueOf=j.valueOf.bind(j);f.toString=j.toString.bind(j)}this.prototype[g]=f}return this}};var Abstract={};Object.extend=function(a,d){for(var b in d){a[b]=d[b]}return a};Object.extend(Object,{inspect:function(a){try{if(Object.isUndefined(a)){return"undefined"}if(a===null){return"null"}return a.inspect?a.inspect():String(a)}catch(b){if(b instanceof RangeError){return"..."}throw b}},toJSON:function(a){var d=typeof a;switch(d){case"undefined":case"function":case"unknown":return;case"boolean":return a.toString()}if(a===null){return"null"}if(a.toJSON){return a.toJSON()}if(Object.isElement(a)){return}var b=[];for(var f in a){var e=Object.toJSON(a[f]);if(!Object.isUndefined(e)){b.push(f.toJSON()+": "+e)}}return"{"+b.join(", ")+"}"},toQueryString:function(a){return $H(a).toQueryString()},toHTML:function(a){return a&&a.toHTML?a.toHTML():String.interpret(a)},keys:function(a){var b=[];for(var d in a){b.push(d)}return b},values:function(b){var a=[];for(var d in b){a.push(b[d])}return a},clone:function(a){return Object.extend({},a)},isElement:function(a){return !!(a&&a.nodeType==1)},isArray:function(a){return a!=null&&typeof a=="object"&&"splice" in a&&"join" in a},isHash:function(a){return a instanceof Hash},isFunction:function(a){return typeof a=="function"},isString:function(a){return typeof a=="string"},isNumber:function(a){return typeof a=="number"},isUndefined:function(a){return typeof a=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var a=this,d=$A(arguments),b=d.shift();return function(){return a.apply(b,d.concat($A(arguments)))}},bindAsEventListener:function(){var a=this,d=$A(arguments),b=d.shift();return function(e){return a.apply(b,[e||window.event].concat(d))}},curry:function(){if(!arguments.length){return this}var a=this,b=$A(arguments);return function(){return a.apply(this,b.concat($A(arguments)))}},delay:function(){var a=this,b=$A(arguments),d=b.shift()*1000;return window.setTimeout(function(){return a.apply(a,b)},d)},defer:function(){var a=[0.01].concat($A(arguments));return this.delay.apply(this,a)},wrap:function(b){var a=this;return function(){return b.apply(this,[a.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var a=this;return this._methodized=function(){return a.apply(null,[this].concat($A(arguments)))}}});Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};var Try={these:function(){var d;for(var b=0,f=arguments.length;b<f;b++){var a=arguments[b];try{d=a();break}catch(g){}}return d}};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(b,a){this.callback=b;this.frequency=a;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute()}finally{this.currentlyExecuting=false}}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(f,d){var a="",e=this,b;d=arguments.callee.prepareReplacement(d);while(e.length>0){if(b=e.match(f)){a+=e.slice(0,b.index);a+=String.interpret(d(b));e=e.slice(b.index+b[0].length)}else{a+=e;e=""}}return a},sub:function(d,a,b){a=this.gsub.prepareReplacement(a);b=Object.isUndefined(b)?1:b;return this.gsub(d,function(e){if(--b<0){return e[0]}return a(e)})},scan:function(b,a){this.gsub(b,a);return String(this)},truncate:function(b,a){b=b||30;a=Object.isUndefined(a)?"...":a;return this.length>b?this.slice(0,b-a.length)+a:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var b=new RegExp(Prototype.ScriptFragment,"img");var a=new RegExp(Prototype.ScriptFragment,"im");return(this.match(b)||[]).map(function(d){return(d.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var a=arguments.callee;a.text.data=this;return a.div.innerHTML},unescapeHTML:function(){var a=new Element("div");a.innerHTML=this.stripTags();return a.childNodes[0]?(a.childNodes.length>1?$A(a.childNodes).inject("",function(b,d){return b+d.nodeValue}):a.childNodes[0].nodeValue):""},toQueryParams:function(b){var a=this.strip().match(/([^?#]*)(#.*)?$/);if(!a){return{}}return a[1].split(b||"&").inject({},function(f,g){if((g=g.split("="))[0]){var d=decodeURIComponent(g.shift());var e=g.length>1?g.join("="):g[0];if(e!=undefined){e=decodeURIComponent(e)}if(d in f){if(!Object.isArray(f[d])){f[d]=[f[d]]}f[d].push(e)}else{f[d]=e}}return f})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return a<1?"":new Array(a+1).join(this)},camelize:function(){var e=this.split("-"),a=e.length;if(a==1){return e[0]}var d=this.charAt(0)=="-"?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0];for(var b=1;b<a;b++){d+=e[b].charAt(0).toUpperCase()+e[b].substring(1)}return d},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(b){var a=this.gsub(/[\x00-\x1f\\]/,function(d){var e=String.specialChar[d[0]];return e?e:"\\u00"+d[0].charCodeAt().toPaddedString(2,16)});if(b){return'"'+a.replace(/"/g,'\\"')+'"'}return"'"+a.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(a){return this.sub(a||Prototype.JSONFilter,"#{1}")},isJSON:function(){var a=this;if(a.blank()){return false}a=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(a)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(a){return this.indexOf(a)>-1},startsWith:function(a){return this.indexOf(a)===0},endsWith:function(a){var b=this.length-a.length;return b>=0&&this.lastIndexOf(a)===b},empty:function(){return this==""},blank:function(){return(/^\s*$/.test(this))},interpolate:function(a,b){return new Template(this,b).evaluate(a)}});if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}})}String.prototype.gsub.prepareReplacement=function(b){if(Object.isFunction(b)){return b}var a=new Template(b);return function(d){return a.evaluate(d)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(Object.isFunction(a.toTemplateReplacements)){a=a.toTemplateReplacements()}return this.template.gsub(this.pattern,function(e){if(a==null){return""}var g=e[1]||"";if(g=="\\"){return e[2]}var b=a,h=e[3];var f=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;e=f.exec(h);if(e==null){return g}while(e!=null){var d=e[1].startsWith("[")?e[2].gsub("\\\\]","]"):e[1];b=b[d];if(null==b||""==e[3]){break}h=h.substring("["==e[3]?e[1].length:e[0].length);e=f.exec(h)}return g+String.interpret(b)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(d,b){var a=0;try{this._each(function(e){d.call(b,e,a++)})}catch(f){if(f!=$break){throw f}}return this},eachSlice:function(e,d,b){var a=-e,f=[],g=this.toArray();if(e<1){return g}while((a+=e)<g.length){f.push(g.slice(a,a+e))}return f.collect(d,b)},all:function(d,b){d=d||Prototype.K;var a=true;this.each(function(f,e){a=a&&!!d.call(b,f,e);if(!a){throw $break}});return a},any:function(d,b){d=d||Prototype.K;var a=false;this.each(function(f,e){if(a=!!d.call(b,f,e)){throw $break}});return a},collect:function(d,b){d=d||Prototype.K;var a=[];this.each(function(f,e){a.push(d.call(b,f,e))});return a},detect:function(d,b){var a;this.each(function(f,e){if(d.call(b,f,e)){a=f;throw $break}});return a},findAll:function(d,b){var a=[];this.each(function(f,e){if(d.call(b,f,e)){a.push(f)}});return a},grep:function(e,d,b){d=d||Prototype.K;var a=[];if(Object.isString(e)){e=new RegExp(e)}this.each(function(g,f){if(e.match(g)){a.push(d.call(b,g,f))}});return a},include:function(a){if(Object.isFunction(this.indexOf)){if(this.indexOf(a)!=-1){return true}}var b=false;this.each(function(d){if(d==a){b=true;throw $break}});return b},inGroupsOf:function(b,a){a=Object.isUndefined(a)?null:a;return this.eachSlice(b,function(d){while(d.length<b){d.push(a)}return d})},inject:function(a,d,b){this.each(function(f,e){a=d.call(b,a,f,e)});return a},invoke:function(b){var a=$A(arguments).slice(1);return this.map(function(d){return d[b].apply(d,a)})},max:function(d,b){d=d||Prototype.K;var a;this.each(function(f,e){f=d.call(b,f,e);if(a==null||f>=a){a=f}});return a},min:function(d,b){d=d||Prototype.K;var a;this.each(function(f,e){f=d.call(b,f,e);if(a==null||f<a){a=f}});return a},partition:function(e,b){e=e||Prototype.K;var d=[],a=[];this.each(function(g,f){(e.call(b,g,f)?d:a).push(g)});return[d,a]},pluck:function(b){var a=[];this.each(function(d){a.push(d[b])});return a},reject:function(d,b){var a=[];this.each(function(f,e){if(!d.call(b,f,e)){a.push(f)}});return a},sortBy:function(b,a){return this.map(function(e,d){return{value:e,criteria:b.call(a,e,d)}}).sort(function(g,f){var e=g.criteria,d=f.criteria;return e<d?-1:e>d?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var b=Prototype.K,a=$A(arguments);if(Object.isFunction(a.last())){b=a.pop()}var d=[this].concat(a).map($A);return this.map(function(f,e){return b(d.pluck(e))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(d){if(!d){return[]}if(d.toArray){return d.toArray()}var b=d.length||0,a=new Array(b);while(b--){a[b]=d[b]}return a}if(Prototype.Browser.WebKit){$A=function(d){if(!d){return[]}if(!(typeof d==="function"&&typeof d.length==="number"&&typeof d.item==="function")&&d.toArray){return d.toArray()}var b=d.length||0,a=new Array(b);while(b--){a[b]=d[b]}return a}}Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(b){for(var a=0,d=this.length;a<d;a++){b(this[a])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(a){return a!=null})},flatten:function(){return this.inject([],function(b,a){return b.concat(Object.isArray(a)?a.flatten():[a])})},without:function(){var a=$A(arguments);return this.select(function(b){return !a.include(b)})},reverse:function(a){return(a!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(a){return this.inject([],function(e,d,b){if(0==b||(a?e.last()!=d:!e.include(d))){e.push(d)}return e})},intersect:function(a){return this.uniq().findAll(function(b){return a.detect(function(d){return b===d})})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var a=[];this.each(function(b){var d=Object.toJSON(b);if(!Object.isUndefined(d)){a.push(d)}});return"["+a.join(", ")+"]"}});if(Object.isFunction(Array.prototype.forEach)){Array.prototype._each=Array.prototype.forEach}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d,a){a||(a=0);var b=this.length;if(a<0){a=b+a}for(;a<b;a++){if(this[a]===d){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(b,a){a=isNaN(a)?this.length:(a<0?this.length+a:a)+1;var d=this.slice(0,a).reverse().indexOf(b);return(d<0)?d:a-d-1}}Array.prototype.toArray=Array.prototype.clone;function $w(a){if(!Object.isString(a)){return[]}a=a.strip();return a?a.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var f=[];for(var b=0,d=this.length;b<d;b++){f.push(this[b])}for(var b=0,d=arguments.length;b<d;b++){if(Object.isArray(arguments[b])){for(var a=0,e=arguments[b].length;a<e;a++){f.push(arguments[b][a])}}else{f.push(arguments[b])}}return f}}Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(b,a){$R(0,this,true).each(b,a);return this},toPaddedString:function(d,b){var a=this.toString(b||10);return"0".times(d-a.length)+a},toJSON:function(){return isFinite(this)?this.toString():"null"}});$w("abs round ceil floor").each(function(a){Number.prototype[a]=Math[a].methodize()});function $H(a){return new Hash(a)}var Hash=Class.create(Enumerable,(function(){function a(b,d){if(Object.isUndefined(d)){return b}return b+"="+encodeURIComponent(String.interpret(d))}return{initialize:function(b){this._object=Object.isHash(b)?b.toObject():Object.clone(b)},_each:function(d){for(var b in this._object){var e=this._object[b],f=[b,e];f.key=b;f.value=e;d(f)}},set:function(b,d){return this._object[b]=d},get:function(b){if(this._object[b]!==Object.prototype[b]){return this._object[b]}},unset:function(b){var d=this._object[b];delete this._object[b];return d},toObject:function(){return Object.clone(this._object)},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(d){var b=this.detect(function(e){return e.value===d});return b&&b.key},merge:function(b){return this.clone().update(b)},update:function(b){return new Hash(b).inject(this,function(d,e){d.set(e.key,e.value);return d})},toQueryString:function(){return this.inject([],function(e,f){var d=encodeURIComponent(f.key),b=f.value;if(b&&typeof b=="object"){if(Object.isArray(b)){return e.concat(b.map(a.curry(d)))}}else{e.push(a(d,b))}return e}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(b){return b.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}})());Hash.prototype.toTemplateReplacements=Hash.prototype.toObject;Hash.from=$H;var ObjectRange=Class.create(Enumerable,{initialize:function(d,a,b){this.start=d;this.end=a;this.exclusive=b},_each:function(a){var b=this.start;while(this.include(b)){a(b);b=b.succ()}},include:function(a){if(a<this.start){return false}if(this.exclusive){return a<this.end}return a<=this.end}});var $R=function(d,a,b){return new ObjectRange(d,a,b)};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){if(!this.include(a)){this.responders.push(a)}},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(e,b,d,a){this.each(function(f){if(Object.isFunction(f[e])){try{f[e].apply(f,[b,d,a])}catch(g){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}else{if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,a){$super(a);this.transport=Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var f=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){f._method=this.method;this.method="post"}this.parameters=f;if(f=Object.toQueryString(f)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+f}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_="}}}try{var a=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(d){this.dispatchException(d)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var f={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*","X-Referer":window.location.href};if(this.method=="post"){f["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){f.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var d=this.options.requestHeaders;if(Object.isFunction(d.push)){for(var b=0,e=d.length;b<e;b+=2){f[d[b]]=d[b+1]}}else{$H(d).each(function(g){f[g.key]=g.value})}}for(var a in f){this.transport.setRequestHeader(a,f[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var d=Ajax.Request.Events[a],b=new Ajax.Response(this);if(d=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(f){this.dispatchException(f)}var g=b.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&g&&g.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+d]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+d,this,b,b.headerJSON)}catch(f){this.dispatchException(f)}if(d=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return !a||(a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(a){try{return this.transport.getResponseHeader(a)||null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(d){this.request=d;var e=this.transport=d.transport,a=this.readyState=e.readyState;if((a>2&&!Prototype.Browser.IE)||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(e.responseText);this.headerJSON=this._getHeaderJSON()}if(a==4){var b=e.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a){return null}a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||(a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,a,d,b){this.container={success:(a.success||a),failure:(a.failure||(a.success?null:a))};b=Object.clone(b);var e=b.onComplete;b.onComplete=(function(f,g){this.updateContent(f.responseText);if(Object.isFunction(e)){e(f,g)}}).bind(this);$super(d,b)},updateContent:function(e){var d=this.container[this.success()?"success":"failure"],a=this.options;if(!a.evalScripts){e=e.stripScripts()}if(d=$(d)){if(a.insertion){if(Object.isString(a.insertion)){var b={};b[a.insertion]=e;d.insert(b)}else{a.insertion(d,e)}}else{d.update(e)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,a,d,b){$super(b);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=a;this.url=d;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){if(this.options.decay){this.decay=(a.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(b){if(arguments.length>1){for(var a=0,e=[],d=arguments.length;a<d;a++){e.push($(arguments[a]))}return e}if(Object.isString(b)){b=document.getElementById(b)}return Element.extend(b)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(g,a){var d=[];var f=document.evaluate(g,$(a)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var b=0,e=f.snapshotLength;b<e;b++){d.push(Element.extend(f.snapshotItem(b)))}return d}}if(!window.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(){var a=this.Element;this.Element=function(e,d){d=d||{};e=e.toLowerCase();var b=Element.cache;if(Prototype.Browser.IE&&d.name){e="<"+e+' name="'+d.name+'">';delete d.name;return Element.writeAttribute(document.createElement(e),d)}if(!b[e]){b[e]=Element.extend(document.createElement(e))}return Element.writeAttribute(b[e].cloneNode(false),d)};Object.extend(this.Element,a||{});if(a){this.Element.prototype=a.prototype}}).call(window);Element.cache={};Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(a,b){a=$(a);if(b&&b.toElement){b=b.toElement()}if(Object.isElement(b)){return a.update().insert(b)}b=Object.toHTML(b);a.innerHTML=b.stripScripts();b.evalScripts.bind(b).defer();return a},replace:function(b,d){b=$(b);if(d&&d.toElement){d=d.toElement()}else{if(!Object.isElement(d)){d=Object.toHTML(d);var a=b.ownerDocument.createRange();a.selectNode(b);d.evalScripts.bind(d).defer();d=a.createContextualFragment(d.stripScripts())}}b.parentNode.replaceChild(d,b);return b},insert:function(d,f){d=$(d);if(Object.isString(f)||Object.isNumber(f)||Object.isElement(f)||(f&&(f.toElement||f.toHTML))){f={bottom:f}}var e,g,b,h;for(var a in f){e=f[a];a=a.toLowerCase();g=Element._insertionTranslations[a];if(e&&e.toElement){e=e.toElement()}if(Object.isElement(e)){g(d,e);continue}e=Object.toHTML(e);b=((a=="before"||a=="after")?d.parentNode:d).tagName.toUpperCase();h=Element._getContentFromAnonymousElement(b,e.stripScripts());if(a=="top"||a=="after"){h.reverse()}h.each(g.curry(d));e.evalScripts.bind(e).defer()}return d},wrap:function(b,d,a){b=$(b);if(Object.isElement(d)){$(d).writeAttribute(a||{})}else{if(Object.isString(d)){d=new Element(d,a)}else{d=new Element("div",d)}}if(b.parentNode){b.parentNode.replaceChild(d,b)}d.appendChild(b);return d},inspect:function(b){b=$(b);var a="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(g){var f=g.first(),d=g.last();var e=(b[f]||"").toString();if(e){a+=" "+d+"="+e.inspect(true)}});return a+">"},recursivelyCollect:function(a,d){a=$(a);var b=[];while(a=a[d]){if(a.nodeType==1){b.push(Element.extend(a))}}return b},ancestors:function(a){return $(a).recursivelyCollect("parentNode")},descendants:function(a){return $(a).select("*")},firstDescendant:function(a){a=$(a).firstChild;while(a&&a.nodeType!=1){a=a.nextSibling}return $(a)},immediateDescendants:function(a){if(!(a=$(a).firstChild)){return[]}while(a&&a.nodeType!=1){a=a.nextSibling}if(a){return[a].concat($(a).nextSiblings())}return[]},previousSiblings:function(a){return $(a).recursivelyCollect("previousSibling")},nextSiblings:function(a){return $(a).recursivelyCollect("nextSibling")},siblings:function(a){a=$(a);return a.previousSiblings().reverse().concat(a.nextSiblings())},match:function(b,a){if(Object.isString(a)){a=new Selector(a)}return a.match($(b))},up:function(b,e,a){b=$(b);if(arguments.length==1){return $(b.parentNode)}var d=b.ancestors();return Object.isNumber(e)?d[e]:Selector.findElement(d,e,a)},down:function(b,d,a){b=$(b);if(arguments.length==1){return b.firstDescendant()}return Object.isNumber(d)?b.descendants()[d]:Element.select(b,d)[a||0]},previous:function(b,e,a){b=$(b);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(b))}var d=b.previousSiblings();return Object.isNumber(e)?d[e]:Selector.findElement(d,e,a)},next:function(d,e,b){d=$(d);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(d))}var a=d.nextSiblings();return Object.isNumber(e)?a[e]:Selector.findElement(a,e,b)},select:function(){var a=$A(arguments),b=$(a.shift());return Selector.findChildElements(b,a)},adjacent:function(){var a=$A(arguments),b=$(a.shift());return Selector.findChildElements(b.parentNode,a).without(b)},identify:function(b){b=$(b);var d=b.readAttribute("id"),a=arguments.callee;if(d){return d}do{d="anonymous_element_"+a.counter++}while($(d));b.writeAttribute("id",d);return d},readAttribute:function(d,a){d=$(d);if(Prototype.Browser.IE){var b=Element._attributeTranslations.read;if(b.values[a]){return b.values[a](d,a)}if(b.names[a]){a=b.names[a]}if(a.include(":")){return(!d.attributes||!d.attributes[a])?null:d.attributes[a].value}}return d.getAttribute(a)},writeAttribute:function(f,d,g){f=$(f);var b={},e=Element._attributeTranslations.write;if(typeof d=="object"){b=d}else{b[d]=Object.isUndefined(g)?true:g}for(var a in b){d=e.names[a]||a;g=b[a];if(e.values[a]){d=e.values[a](f,g)}if(g===false||g===null){f.removeAttribute(d)}else{if(g===true){f.setAttribute(d,d)}else{f.setAttribute(d,g)}}}return f},getHeight:function(a){return $(a).getDimensions().height},getWidth:function(a){return $(a).getDimensions().width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a))){return}var d=a.className;return(d.length>0&&(d==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(d)))},addClassName:function(a,b){if(!(a=$(a))){return}if(!a.hasClassName(b)){a.className+=(a.className?" ":"")+b}return a},removeClassName:function(a,b){if(!(a=$(a))){return}a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a},toggleClassName:function(a,b){if(!(a=$(a))){return}return a[a.hasClassName(b)?"removeClassName":"addClassName"](b)},cleanWhitespace:function(b){b=$(b);var d=b.firstChild;while(d){var a=d.nextSibling;if(d.nodeType==3&&!(/\S/.test(d.nodeValue))){b.removeChild(d)}d=a}return b},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(b,a){b=$(b);a=$(a);if(b.compareDocumentPosition){return(b.compareDocumentPosition(a)&8)===8}if(a.contains){return a.contains(b)&&a!==b}while(b=b.parentNode){if(b==a){return true}}return false},scrollTo:function(a){a=$(a);var b=a.cumulativeOffset();window.scrollTo(b[0],b[1]);return a},getStyle:function(b,d){b=$(b);d=d=="float"?"cssFloat":d.camelize();var e=b.style[d];if(!e||e=="auto"){var a=document.defaultView.getComputedStyle(b,null);e=a?a[d]:null}if(d=="opacity"){return e?parseFloat(e):1}return e=="auto"?null:e},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(b,d){b=$(b);var f=b.style,a;if(Object.isString(d)){b.style.cssText+=";"+d;return d.include("opacity")?b.setOpacity(d.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var e in d){if(e=="opacity"){b.setOpacity(d[e])}else{f[(e=="float"||e=="cssFloat")?(Object.isUndefined(f.styleFloat)?"cssFloat":"styleFloat"):e]=d[e]}}return b},setOpacity:function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;return a},getDimensions:function(d){d=$(d);var h=d.getStyle("display");if(h!="none"&&h!=null){return{width:d.offsetWidth,height:d.offsetHeight}}var b=d.style;var g=b.visibility;var e=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="block";var j=d.clientWidth;var f=d.clientHeight;b.display=a;b.position=e;b.visibility=g;return{width:j,height:f}},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow){return a}a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden"){a.style.overflow="hidden"}return a},undoClipping:function(a){a=$(a);if(!a._overflow){return a}a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},cumulativeOffset:function(b){var a=0,d=0;do{a+=b.offsetTop||0;d+=b.offsetLeft||0;b=b.offsetParent}while(b);return Element._returnOffset(d,a)},positionedOffset:function(b){var a=0,e=0;do{a+=b.offsetTop||0;e+=b.offsetLeft||0;b=b.offsetParent;if(b){if(b.tagName.toUpperCase()=="BODY"){break}var d=Element.getStyle(b,"position");if(d!=="static"){break}}}while(b);return Element._returnOffset(e,a)},absolutize:function(b){b=$(b);if(b.getStyle("position")=="absolute"){return b}var e=b.positionedOffset();var g=e[1];var f=e[0];var d=b.clientWidth;var a=b.clientHeight;b._originalLeft=f-parseFloat(b.style.left||0);b._originalTop=g-parseFloat(b.style.top||0);b._originalWidth=b.style.width;b._originalHeight=b.style.height;b.style.position="absolute";b.style.top=g+"px";b.style.left=f+"px";b.style.width=d+"px";b.style.height=a+"px";return b},relativize:function(a){a=$(a);if(a.getStyle("position")=="relative"){return a}a.style.position="relative";var d=parseFloat(a.style.top||0)-(a._originalTop||0);var b=parseFloat(a.style.left||0)-(a._originalLeft||0);a.style.top=d+"px";a.style.left=b+"px";a.style.height=a._originalHeight;a.style.width=a._originalWidth;return a},cumulativeScrollOffset:function(b){var a=0,d=0;do{a+=b.scrollTop||0;d+=b.scrollLeft||0;b=b.parentNode}while(b);return Element._returnOffset(d,a)},getOffsetParent:function(a){if(a.offsetParent){return $(a.offsetParent)}if(a==document.body){return $(a)}while((a=a.parentNode)&&a!=document.body){if(Element.getStyle(a,"position")!="static"){return $(a)}}return $(document.body)},viewportOffset:function(e){var a=0,d=0;var b=e;do{a+=b.offsetTop||0;d+=b.offsetLeft||0;if(b.offsetParent==document.body&&Element.getStyle(b,"position")=="absolute"){break}}while(b=b.offsetParent);b=e;do{if(!Prototype.Browser.Opera||(b.tagName&&(b.tagName.toUpperCase()=="BODY"))){a-=b.scrollTop||0;d-=b.scrollLeft||0}}while(b=b.parentNode);return Element._returnOffset(d,a)},clonePosition:function(b,e){var a=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});e=$(e);var f=e.viewportOffset();b=$(b);var g=[0,0];var d=null;if(Element.getStyle(b,"position")=="absolute"){d=b.getOffsetParent();g=d.viewportOffset()}if(d==document.body){g[0]-=document.body.offsetLeft;g[1]-=document.body.offsetTop}if(a.setLeft){b.style.left=(f[0]-g[0]+a.offsetLeft)+"px"}if(a.setTop){b.style.top=(f[1]-g[1]+a.offsetTop)+"px"}if(a.setWidth){b.style.width=e.offsetWidth+"px"}if(a.setHeight){b.style.height=e.offsetHeight+"px"}return b}};Element.Methods.identify.counter=1;Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(e,b,d){switch(d){case"left":case"top":case"right":case"bottom":if(e(b,"position")==="static"){return null}case"height":case"width":if(!Element.visible(b)){return null}var f=parseInt(e(b,d),10);if(f!==b["offset"+d.capitalize()]){return f+"px"}var a;if(d==="height"){a=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{a=["border-left-width","padding-left","padding-right","border-right-width"]}return a.inject(f,function(g,h){var j=e(b,h);return j===null?g:g-parseInt(j,10)})+"px";default:return e(b,d)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(d,a,b){if(b==="title"){return a.title}return d(a,b)})}else{if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(d,b){b=$(b);try{b.offsetParent}catch(g){return $(document.body)}var a=b.getStyle("position");if(a!=="static"){return d(b)}b.setStyle({position:"relative"});var f=d(b);b.setStyle({position:a});return f});$w("positionedOffset viewportOffset").each(function(a){Element.Methods[a]=Element.Methods[a].wrap(function(g,d){d=$(d);try{d.offsetParent}catch(j){return Element._returnOffset(0,0)}var b=d.getStyle("position");if(b!=="static"){return g(d)}var f=d.getOffsetParent();if(f&&f.getStyle("position")==="fixed"){f.setStyle({zoom:1})}d.setStyle({position:"relative"});var h=g(d);d.setStyle({position:b});return h})});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(b,a){try{a.offsetParent}catch(d){return Element._returnOffset(0,0)}return b(a)});Element.Methods.getStyle=function(a,b){a=$(a);b=(b=="float"||b=="cssFloat")?"styleFloat":b.camelize();var d=a.style[b];if(!d&&a.currentStyle){d=a.currentStyle[b]}if(b=="opacity"){if(d=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(d[1]){return parseFloat(d[1])/100}}return 1}if(d=="auto"){if((b=="width"||b=="height")&&(a.getStyle("display")!="none")){return a["offset"+b.capitalize()]+"px"}return null}return d};Element.Methods.setOpacity=function(b,f){function g(h){return h.replace(/alpha\([^\)]*\)/gi,"")}b=$(b);var a=b.currentStyle;if((a&&!a.hasLayout)||(!a&&b.style.zoom=="normal")){b.style.zoom=1}var e=b.getStyle("filter"),d=b.style;if(f==1||f===""){(e=g(e))?d.filter=e:d.removeAttribute("filter");return b}else{if(f<0.00001){f=0}}d.filter=g(e)+"alpha(opacity="+(f*100)+")";return b};Element._attributeTranslations={read:{names:{"class":"className","for":"htmlFor"},values:{_getAttr:function(a,b){return a.getAttribute(b,2)},_getAttrNode:function(a,d){var b=a.getAttributeNode(d);return b?b.value:""},_getEv:function(a,b){b=a.getAttribute(b);return b?b.toString().slice(23,-2):null},_flag:function(a,b){return $(a).hasAttribute(b)?b:null},style:function(a){return a.style.cssText.toLowerCase()},title:function(a){return a.title}}}};Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr,src:a._getAttr,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values)}else{if(Prototype.Browser.Gecko&&(/rv:1\.8\.0/.test(navigator.userAgent))){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1)?0.999999:(b==="")?"":(b<0.00001)?0:b;return a}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;if(b==1){if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else{try{var f=document.createTextNode(" ");a.appendChild(f);a.removeChild(f)}catch(d){}}}return a};Element.Methods.cumulativeOffset=function(b){var a=0,d=0;do{a+=b.offsetTop||0;d+=b.offsetLeft||0;if(b.offsetParent==document.body){if(Element.getStyle(b,"position")=="absolute"){break}}b=b.offsetParent}while(b);return Element._returnOffset(d,a)}}}}}if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(b,d){b=$(b);if(d&&d.toElement){d=d.toElement()}if(Object.isElement(d)){return b.update().insert(d)}d=Object.toHTML(d);var a=b.tagName.toUpperCase();if(a in Element._insertionTranslations.tags){$A(b.childNodes).each(function(e){b.removeChild(e)});Element._getContentFromAnonymousElement(a,d.stripScripts()).each(function(e){b.appendChild(e)})}else{b.innerHTML=d.stripScripts()}d.evalScripts.bind(d).defer();return b}}if("outerHTML" in document.createElement("div")){Element.Methods.replace=function(d,f){d=$(d);if(f&&f.toElement){f=f.toElement()}if(Object.isElement(f)){d.parentNode.replaceChild(f,d);return d}f=Object.toHTML(f);var e=d.parentNode,b=e.tagName.toUpperCase();if(Element._insertionTranslations.tags[b]){var g=d.next();var a=Element._getContentFromAnonymousElement(b,f.stripScripts());e.removeChild(d);if(g){a.each(function(h){e.insertBefore(h,g)})}else{a.each(function(h){e.appendChild(h)})}}else{d.outerHTML=f.stripScripts()}f.evalScripts.bind(f).defer();return d}}Element._returnOffset=function(b,d){var a=[b,d];a.left=b;a.top=d;return a};Element._getContentFromAnonymousElement=function(d,b){var e=new Element("div"),a=Element._insertionTranslations.tags[d];if(a){e.innerHTML=a[0]+b+a[1];a[2].times(function(){e=e.firstChild})}else{e.innerHTML=b}return $A(e.childNodes)};Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD})}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(a,d){d=Element._attributeTranslations.has[d]||d;var b=$(a).getAttributeNode(d);return !!(b&&b.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div")["__proto__"]){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div")["__proto__"];Prototype.BrowserFeatures.ElementExtensions=true}Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions){return Prototype.K}var a={},b=Element.Methods.ByTag;var d=Object.extend(function(g){if(!g||g._extendedByPrototype||g.nodeType!=1||g==window){return g}var e=Object.clone(a),f=g.tagName.toUpperCase(),j,h;if(b[f]){Object.extend(e,b[f])}for(j in e){h=e[j];if(Object.isFunction(h)&&!(j in g)){g[j]=h.methodize()}}g._extendedByPrototype=Prototype.emptyFunction;return g},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(a,Element.Methods);Object.extend(a,Element.Methods.Simulated)}}});d.refresh();return d})();Element.hasAttribute=function(a,b){if(a.hasAttribute){return a.hasAttribute(b)}return Element.Methods.Simulated.hasAttribute(a,b)};Element.addMethods=function(d){var j=Prototype.BrowserFeatures,e=Element.Methods.ByTag;if(!d){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var b=d;d=arguments[1]}if(!b){Object.extend(Element.Methods,d||{})}else{if(Object.isArray(b)){b.each(h)}else{h(b)}}function h(l){l=l.toUpperCase();if(!Element.Methods.ByTag[l]){Element.Methods.ByTag[l]={}}Object.extend(Element.Methods.ByTag[l],d)}function a(n,m,l){l=l||false;for(var p in n){var o=n[p];if(!Object.isFunction(o)){continue}if(!l||!(p in m)){m[p]=o.methodize()}}}function f(n){var l;var m={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(m[n]){l="HTML"+m[n]+"Element"}if(window[l]){return window[l]}l="HTML"+n+"Element";if(window[l]){return window[l]}l="HTML"+n.capitalize()+"Element";if(window[l]){return window[l]}window[l]={};window[l].prototype=document.createElement(n)["__proto__"];return window[l]}if(j.ElementExtensions){a(Element.Methods,HTMLElement.prototype);a(Element.Methods.Simulated,HTMLElement.prototype,true)}if(j.SpecificElementExtensions){for(var k in Element.Methods.ByTag){var g=f(k);if(Object.isUndefined(g)){continue}a(e[k],g.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){var a={},b=Prototype.Browser;$w("width height").each(function(f){var e=f.capitalize();if(b.WebKit&&!document.evaluate){a[f]=self["inner"+e]}else{if(b.Opera&&parseFloat(window.opera.version())<9.5){a[f]=document.body["client"+e]}else{a[f]=document.documentElement["client"+e]}}});return a},getWidth:function(){return this.getDimensions().width},getHeight:function(){return this.getDimensions().height},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};var Selector=Class.create({initialize:function(a){this.expression=a.strip();if(this.shouldUseSelectorsAPI()){this.mode="selectorsAPI"}else{if(this.shouldUseXPath()){this.mode="xpath";this.compileXPathMatcher()}else{this.mode="normal";this.compileMatcher()}}},shouldUseXPath:function(){if(!Prototype.BrowserFeatures.XPath){return false}var a=this.expression;if(Prototype.Browser.WebKit&&(a.include("-of-type")||a.include(":empty"))){return false}if((/(\[[\w-]*?:|:checked)/).test(a)){return false}return true},shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI){return false}if(!Selector._div){Selector._div=new Element("div")}try{Selector._div.querySelector(this.expression)}catch(a){return false}return true},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return}this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var g=this.expression,h=Selector.patterns,b=Selector.xpath,f,a;if(Selector._cache[g]){this.xpath=Selector._cache[g];return}this.matcher=[".//*"];while(g&&f!=g&&(/\S/).test(g)){f=g;for(var d in h){if(a=g.match(h[d])){this.matcher.push(Object.isFunction(b[d])?b[d](a):new Template(b[d]).evaluate(a));g=g.replace(a[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(a){a=a||document;var d=this.expression,b;switch(this.mode){case"selectorsAPI":if(a!==document){var f=a.id,g=$(a).identify();d="#"+g+" "+d}b=$A(a.querySelectorAll(d)).map(Element.extend);a.id=f;return b;case"xpath":return document._getElementsByXPath(this.xpath,a);default:return this.matcher(a)}},match:function(k){this.tokens=[];var q=this.expression,a=Selector.patterns,g=Selector.assertions;var b,f,h;while(q&&b!==q&&(/\S/).test(q)){b=q;for(var l in a){f=a[l];if(h=q.match(f)){if(g[l]){this.tokens.push([l,Object.clone(h)]);q=q.replace(h[0],"")}else{return this.findElements(document).include(k)}}}}var o=true,d,n;for(var l=0,j;j=this.tokens[l];l++){d=j[0];n=j[1];if(!Selector.assertions[d](k,n)){o=false;break}}return o},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(a){if(a[1]=="*"){return""}return"[local-name()='"+a[1].toLowerCase()+"' or local-name()='"+a[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(a){a[1]=a[1].toLowerCase();return new Template("[@#{1}]").evaluate(a)},attr:function(a){a[1]=a[1].toLowerCase();a[3]=a[5]||a[6];return new Template(Selector.xpath.operators[a[2]]).evaluate(a)},pseudo:function(a){var b=Selector.xpath.pseudos[a[1]];if(!b){return""}if(Object.isFunction(b)){return b(a)}return new Template(Selector.xpath.pseudos[a[1]]).evaluate(a)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0)]",checked:"[@checked]",disabled:"[(@disabled) and (@type!='hidden')]",enabled:"[not(@disabled) and (@type!='hidden')]",not:function(b){var k=b[6],j=Selector.patterns,a=Selector.xpath,g,d;var h=[];while(k&&g!=k&&(/\S/).test(k)){g=k;for(var f in j){if(b=k.match(j[f])){d=Object.isFunction(a[f])?a[f](b):new Template(a[f]).evaluate(b);h.push("("+d.substring(1,d.length-1)+")");k=k.replace(b[0],"");break}}}return"[not("+h.join(" and ")+")]"},"nth-child":function(a){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",a)},"nth-last-child":function(a){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",a)},"nth-of-type":function(a){return Selector.xpath.pseudos.nth("position() ",a)},"nth-last-of-type":function(a){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",a)},"first-of-type":function(a){a[6]="1";return Selector.xpath.pseudos["nth-of-type"](a)},"last-of-type":function(a){a[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](a)},"only-of-type":function(a){var b=Selector.xpath.pseudos;return b["first-of-type"](a)+b["last-of-type"](a)},nth:function(h,f){var j,k=f[6],e;if(k=="even"){k="2n+0"}if(k=="odd"){k="2n+1"}if(j=k.match(/^(\d+)$/)){return"["+h+"= "+j[1]+"]"}if(j=k.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(j[1]=="-"){j[1]=-1}var g=j[1]?Number(j[1]):1;var d=j[2]?Number(j[2]):0;e="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(e).evaluate({fragment:h,a:g,b:d})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(a){a[3]=(a[5]||a[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(a)},pseudo:function(a){if(a[6]){a[6]=a[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(a)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/,attrPresence:/^\[((?:[\w]+:)?[\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(a,b){return b[1].toUpperCase()==a.tagName.toUpperCase()},className:function(a,b){return Element.hasClassName(a,b[1])},id:function(a,b){return a.id===b[1]},attrPresence:function(a,b){return Element.hasAttribute(a,b[1])},attr:function(b,d){var a=Element.readAttribute(b,d[1]);return a&&Selector.operators[d[2]](a,d[5]||d[6])}},handlers:{concat:function(e,d){for(var f=0,g;g=d[f];f++){e.push(g)}return e},mark:function(a){var e=Prototype.emptyFunction;for(var b=0,d;d=a[b];b++){d._countedByPrototype=e}return a},unmark:function(a){for(var b=0,d;d=a[b];b++){d._countedByPrototype=undefined}return a},index:function(a,e,h){a._countedByPrototype=Prototype.emptyFunction;if(e){for(var b=a.childNodes,f=b.length-1,d=1;f>=0;f--){var g=b[f];if(g.nodeType==1&&(!h||g._countedByPrototype)){g.nodeIndex=d++}}}else{for(var f=0,d=1,b=a.childNodes;g=b[f];f++){if(g.nodeType==1&&(!h||g._countedByPrototype)){g.nodeIndex=d++}}}},unique:function(b){if(b.length==0){return b}var e=[],f;for(var d=0,a=b.length;d<a;d++){if(!(f=b[d])._countedByPrototype){f._countedByPrototype=Prototype.emptyFunction;e.push(Element.extend(f))}}return Selector.handlers.unmark(e)},descendant:function(a){var e=Selector.handlers;for(var d=0,b=[],f;f=a[d];d++){e.concat(b,f.getElementsByTagName("*"))}return b},child:function(a){var f=Selector.handlers;for(var e=0,d=[],g;g=a[e];e++){for(var b=0,k;k=g.childNodes[b];b++){if(k.nodeType==1&&k.tagName!="!"){d.push(k)}}}return d},adjacent:function(a){for(var d=0,b=[],f;f=a[d];d++){var e=this.nextElementSibling(f);if(e){b.push(e)}}return b},laterSibling:function(a){var e=Selector.handlers;for(var d=0,b=[],f;f=a[d];d++){e.concat(b,Element.nextSiblings(f))}return b},nextElementSibling:function(a){while(a=a.nextSibling){if(a.nodeType==1){return a}}return null},previousElementSibling:function(a){while(a=a.previousSibling){if(a.nodeType==1){return a}}return null},tagName:function(a,k,d,b){var l=d.toUpperCase();var f=[],j=Selector.handlers;if(a){if(b){if(b=="descendant"){for(var g=0,e;e=a[g];g++){j.concat(f,e.getElementsByTagName(d))}return f}else{a=this[b](a)}if(d=="*"){return a}}for(var g=0,e;e=a[g];g++){if(e.tagName.toUpperCase()===l){f.push(e)}}return f}else{return k.getElementsByTagName(d)}},id:function(b,a,k,g){var j=$(k),e=Selector.handlers;if(!j){return[]}if(!b&&a==document){return[j]}if(b){if(g){if(g=="child"){for(var d=0,f;f=b[d];d++){if(j.parentNode==f){return[j]}}}else{if(g=="descendant"){for(var d=0,f;f=b[d];d++){if(Element.descendantOf(j,f)){return[j]}}}else{if(g=="adjacent"){for(var d=0,f;f=b[d];d++){if(Selector.handlers.previousElementSibling(j)==f){return[j]}}}else{b=e[g](b)}}}}for(var d=0,f;f=b[d];d++){if(f==j){return[j]}}return[]}return(j&&Element.descendantOf(j,a))?[j]:[]},className:function(b,a,d,e){if(b&&e){b=this[e](b)}return Selector.handlers.byClassName(b,a,d)},byClassName:function(d,b,g){if(!d){d=Selector.handlers.descendant([b])}var j=" "+g+" ";for(var f=0,e=[],h,a;h=d[f];f++){a=h.className;if(a.length==0){continue}if(a==g||(" "+a+" ").include(j)){e.push(h)}}return e},attrPresence:function(d,b,a,h){if(!d){d=b.getElementsByTagName("*")}if(d&&h){d=this[h](d)}var f=[];for(var e=0,g;g=d[e];e++){if(Element.hasAttribute(g,a)){f.push(g)}}return f},attr:function(a,k,j,l,d,b){if(!a){a=k.getElementsByTagName("*")}if(a&&b){a=this[b](a)}var m=Selector.operators[d],g=[];for(var f=0,e;e=a[f];f++){var h=Element.readAttribute(e,j);if(h===null){continue}if(m(h,l)){g.push(e)}}return g},pseudo:function(b,d,f,a,e){if(b&&e){b=this[e](b)}if(!b){b=a.getElementsByTagName("*")}return Selector.pseudos[d](b,f,a)}},pseudos:{"first-child":function(b,g,a){for(var e=0,d=[],f;f=b[e];e++){if(Selector.handlers.previousElementSibling(f)){continue}d.push(f)}return d},"last-child":function(b,g,a){for(var e=0,d=[],f;f=b[e];e++){if(Selector.handlers.nextElementSibling(f)){continue}d.push(f)}return d},"only-child":function(b,j,a){var f=Selector.handlers;for(var e=0,d=[],g;g=b[e];e++){if(!f.previousElementSibling(g)&&!f.nextElementSibling(g)){d.push(g)}}return d},"nth-child":function(b,d,a){return Selector.pseudos.nth(b,d,a)},"nth-last-child":function(b,d,a){return Selector.pseudos.nth(b,d,a,true)},"nth-of-type":function(b,d,a){return Selector.pseudos.nth(b,d,a,false,true)},"nth-last-of-type":function(b,d,a){return Selector.pseudos.nth(b,d,a,true,true)},"first-of-type":function(b,d,a){return Selector.pseudos.nth(b,"1",a,false,true)},"last-of-type":function(b,d,a){return Selector.pseudos.nth(b,"1",a,true,true)},"only-of-type":function(b,e,a){var d=Selector.pseudos;return d["last-of-type"](d["first-of-type"](b,e,a),e,a)},getIndices:function(e,d,f){if(e==0){return d>0?[d]:[]}return $R(1,f).inject([],function(a,b){if(0==(b-d)%e&&(b-d)/e>=0){a.push(b)}return a})},nth:function(d,t,v,s,f){if(d.length==0){return[]}if(t=="even"){t="2n+0"}if(t=="odd"){t="2n+1"}var r=Selector.handlers,q=[],e=[],k;r.mark(d);for(var p=0,g;g=d[p];p++){if(!g.parentNode._countedByPrototype){r.index(g.parentNode,s,f);e.push(g.parentNode)}}if(t.match(/^\d+$/)){t=Number(t);for(var p=0,g;g=d[p];p++){if(g.nodeIndex==t){q.push(g)}}}else{if(k=t.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(k[1]=="-"){k[1]=-1}var w=k[1]?Number(k[1]):1;var u=k[2]?Number(k[2]):0;var x=Selector.pseudos.getIndices(w,u,d.length);for(var p=0,g,n=x.length;g=d[p];p++){for(var o=0;o<n;o++){if(g.nodeIndex==x[o]){q.push(g)}}}}}r.unmark(d);r.unmark(e);return q},empty:function(b,g,a){for(var e=0,d=[],f;f=b[e];e++){if(f.tagName=="!"||f.firstChild){continue}d.push(f)}return d},not:function(a,e,l){var j=Selector.handlers,n,d;var k=new Selector(e).findElements(l);j.mark(k);for(var g=0,f=[],b;b=a[g];g++){if(!b._countedByPrototype){f.push(b)}}j.unmark(k);return f},enabled:function(b,g,a){for(var e=0,d=[],f;f=b[e];e++){if(!f.disabled&&(!f.type||f.type!=="hidden")){d.push(f)}}return d},disabled:function(b,g,a){for(var e=0,d=[],f;f=b[e];e++){if(f.disabled){d.push(f)}}return d},checked:function(b,g,a){for(var e=0,d=[],f;f=b[e];e++){if(f.checked){d.push(f)}}return d}},operators:{"=":function(b,a){return b==a},"!=":function(b,a){return b!=a},"^=":function(b,a){return b==a||b&&b.startsWith(a)},"$=":function(b,a){return b==a||b&&b.endsWith(a)},"*=":function(b,a){return b==a||b&&b.include(a)},"$=":function(b,a){return b.endsWith(a)},"*=":function(b,a){return b.include(a)},"~=":function(b,a){return(" "+b+" ").include(" "+a+" ")},"|=":function(b,a){return("-"+(b||"").toUpperCase()+"-").include("-"+(a||"").toUpperCase()+"-")}},split:function(b){var a=[];b.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(d){a.push(d[1].strip())});return a},matchElements:function(g,j){var f=$$(j),e=Selector.handlers;e.mark(f);for(var d=0,b=[],a;a=g[d];d++){if(a._countedByPrototype){b.push(a)}}e.unmark(f);return b},findElement:function(b,d,a){if(Object.isNumber(d)){a=d;d=false}return Selector.matchElements(b,d||"*")[a||0]},findChildElements:function(f,j){j=Selector.split(j.join(","));var e=[],g=Selector.handlers;for(var d=0,b=j.length,a;d<b;d++){a=new Selector(j[d].strip());g.concat(e,a.findElements(f))}return(b>1)?g.unique(e):e}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(e,d){for(var f=0,g;g=d[f];f++){if(g.tagName!=="!"){e.push(g)}}return e},unmark:function(a){for(var b=0,d;d=a[b];b++){d.removeAttribute("_countedByPrototype")}return a}})}function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(a){$(a).reset();return a},serializeElements:function(h,b){if(typeof b!="object"){b={hash:!!b}}else{if(Object.isUndefined(b.hash)){b.hash=true}}var d,g,a=false,f=b.submit;var e=h.inject({},function(j,k){if(!k.disabled&&k.name){d=k.name;g=$(k).getValue();if(g!=null&&k.type!="file"&&(k.type!="submit"||(!a&&f!==false&&(!f||d==f)&&(a=true)))){if(d in j){if(!Object.isArray(j[d])){j[d]=[j[d]]}j[d].push(g)}else{j[d]=g}}}return j});return b.hash?e:Object.toQueryString(e)}};Form.Methods={serialize:function(b,a){return Form.serializeElements(Form.getElements(b),a)},getElements:function(a){return $A($(a).getElementsByTagName("*")).inject([],function(b,d){if(Form.Element.Serializers[d.tagName.toLowerCase()]){b.push(Element.extend(d))}return b})},getInputs:function(h,d,e){h=$(h);var a=h.getElementsByTagName("input");if(!d&&!e){return $A(a).map(Element.extend)}for(var f=0,j=[],g=a.length;f<g;f++){var b=a[f];if((d&&b.type!=d)||(e&&b.name!=e)){continue}j.push(Element.extend(b))}return j},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(b){var d=$(b).getElements().findAll(function(e){return"hidden"!=e.type&&!e.disabled});var a=d.findAll(function(e){return e.hasAttribute("tabIndex")&&e.tabIndex>=0}).sortBy(function(e){return e.tabIndex}).first();return a?a:d.find(function(e){return["input","select","textarea"].include(e.tagName.toLowerCase())})},focusFirstElement:function(a){a=$(a);a.findFirstElement().activate();return a},request:function(b,a){b=$(b);a=Object.clone(a||{});var e=a.parameters,d=b.readAttribute("action")||"";if(d.blank()){d=window.location.href}a.parameters=b.serialize(true);if(e){if(Object.isString(e)){e=e.toQueryParams()}Object.extend(a.parameters,e)}if(b.hasAttribute("method")&&!a.method){a.method=b.method}return new Ajax.Request(d,a)}};Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var d={};d[a.name]=b;return Object.toQueryString(d)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var d=a.tagName.toLowerCase();Form.Element.Serializers[d](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();if(a.select&&(a.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(a.type))){a.select()}}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(a,b){switch(a.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(a,b);default:return Form.Element.Serializers.textarea(a,b)}},inputSelector:function(a,b){if(Object.isUndefined(b)){return a.checked?a.value:null}else{a.checked=!!b}},textarea:function(a,b){if(Object.isUndefined(b)){return a.value}else{a.value=b}},select:function(d,g){if(Object.isUndefined(g)){return this[d.type=="select-one"?"selectOne":"selectMany"](d)}else{var b,e,h=!Object.isArray(g);for(var a=0,f=d.length;a<f;a++){b=d.options[a];e=this.optionValue(b);if(h){if(e==g){b.selected=true;return}}else{b.selected=g.include(e)}}}},selectOne:function(b){var a=b.selectedIndex;return a>=0?this.optionValue(b.options[a]):null},selectMany:function(e){var a,f=e.length;if(!f){return null}for(var d=0,a=[];d<f;d++){var b=e.options[d];if(b.selected){a.push(this.optionValue(b))}}return a},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,a,b,d){$super(d,b);this.element=$(a);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type){switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event={}}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(b){var a;switch(b.type){case"mouseover":a=b.fromElement;break;case"mouseout":a=b.toElement;break;default:return null}return Element.extend(a)}});Event.Methods=(function(){var a;if(Prototype.Browser.IE){var b={0:1,1:4,2:2};a=function(e,d){return e.button==b[d]}}else{if(Prototype.Browser.WebKit){a=function(e,d){switch(d){case 0:return e.which==1&&!e.metaKey;case 1:return e.which==1&&e.metaKey;default:return false}}}else{a=function(e,d){return e.which?(e.which===d+1):(e.button===d)}}}return{isLeftClick:function(d){return a(d,0)},isMiddleClick:function(d){return a(d,1)},isRightClick:function(d){return a(d,2)},element:function(f){f=Event.extend(f);var e=f.target,d=f.type,g=f.currentTarget;if(g&&g.tagName){if(d==="load"||d==="error"||(d==="click"&&g.tagName.toLowerCase()==="input"&&g.type==="radio")){e=g}}if(e.nodeType==Node.TEXT_NODE){e=e.parentNode}return Element.extend(e)},findElement:function(e,g){var d=Event.element(e);if(!g){return d}var f=[d].concat(d.ancestors());return Selector.findElement(f,g,0)},pointer:function(f){var e=document.documentElement,d=document.body||{scrollLeft:0,scrollTop:0};return{x:f.pageX||(f.clientX+(e.scrollLeft||d.scrollLeft)-(e.clientLeft||0)),y:f.pageY||(f.clientY+(e.scrollTop||d.scrollTop)-(e.clientTop||0))}},pointerX:function(d){return Event.pointer(d).x},pointerY:function(d){return Event.pointer(d).y},stop:function(d){Event.extend(d);d.preventDefault();d.stopPropagation();d.stopped=true}}})();Event.extend=(function(){var a=Object.keys(Event.Methods).inject({},function(b,d){b[d]=Event.Methods[d].methodize();return b});if(Prototype.Browser.IE){Object.extend(a,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});return function(b){if(!b){return false}if(b._extendedByPrototype){return b}b._extendedByPrototype=Prototype.emptyFunction;var d=Event.pointer(b);Object.extend(b,{target:b.srcElement,relatedTarget:Event.relatedTarget(b),pageX:d.x,pageY:d.y});return Object.extend(b,a)}}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents")["__proto__"];Object.extend(Event.prototype,a);return Prototype.K}})();Object.extend(Event,(function(){var b=Event.cache;function d(l){if(l._prototypeEventID){return l._prototypeEventID[0]}arguments.callee.id=arguments.callee.id||1;return l._prototypeEventID=[++arguments.callee.id]}function h(l){if(l&&l.include(":")){return"dataavailable"}return l}function a(l){return b[l]=b[l]||{}}function g(n,l){var m=a(n);return m[l]=m[l]||[]}function j(m,l,n){var q=d(m);var p=g(q,l);if(p.pluck("handler").include(n)){return false}var o=function(r){if(!Event||!Event.extend||(r.eventName&&r.eventName!=l)){return false}Event.extend(r);n.call(m,r)};o.handler=n;p.push(o);return o}function k(o,l,m){var n=g(o,l);return n.find(function(p){return p.handler==m})}function e(o,l,m){var n=a(o);if(!n[l]){return false}n[l]=n[l].without(k(o,l,m))}function f(){for(var m in b){for(var l in b[m]){b[m][l]=null}}}if(window.attachEvent){window.attachEvent("onunload",f)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}return{observe:function(n,l,o){n=$(n);var m=h(l);var p=j(n,l,o);if(!p){return n}if(n.addEventListener){n.addEventListener(m,p,false)}else{n.attachEvent("on"+m,p)}return n},stopObserving:function(n,l,o){n=$(n);var q=d(n),m=h(l);if(!o&&l){g(q,l).each(function(r){n.stopObserving(l,r.handler)});return n}else{if(!l){Object.keys(a(q)).each(function(r){n.stopObserving(r)});return n}}var p=k(q,l,o);if(!p){return n}if(n.removeEventListener){n.removeEventListener(m,p,false)}else{n.detachEvent("on"+m,p)}e(q,l,o);return n},fire:function(n,m,l){n=$(n);if(n==document&&document.createEvent&&!n.dispatchEvent){n=document.documentElement}var o;if(document.createEvent){o=document.createEvent("HTMLEvents");o.initEvent("dataavailable",true,true)}else{o=document.createEventObject();o.eventType="ondataavailable"}o.eventName=m;o.memo=l||{};if(document.createEvent){n.dispatchEvent(o)}else{n.fireEvent(o.eventType,o)}return Event.extend(o)}}})());Object.extend(Event,Event.Methods);Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize(),loaded:false});(function(){var b;function a(){if(document.loaded){return}if(b){window.clearInterval(b)}document.fire("dom:loaded");document.loaded=true}if(document.addEventListener){if(Prototype.Browser.WebKit){b=window.setInterval(function(){if(/loaded|complete/.test(document.readyState)){a()}},0);Event.observe(window,"load",a)}else{document.addEventListener("DOMContentLoaded",a,false)}}else{document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>");$("__onDOMContentLoaded").onreadystatechange=function(){if(this.readyState=="complete"){this.onreadystatechange=null;a()}}}})();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(b,a,d){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(b,a,d)}this.xcomp=a;this.ycomp=d;this.offset=Element.cumulativeOffset(b);return(d>=this.offset[1]&&d<this.offset[1]+b.offsetHeight&&a>=this.offset[0]&&a<this.offset[0]+b.offsetWidth)},withinIncludingScrolloffsets:function(b,a,e){var d=Element.cumulativeScrollOffset(b);this.xcomp=a+d[0]-this.deltaX;this.ycomp=e+d[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth)},overlap:function(b,a){if(!b){return 0}if(b=="vertical"){return((this.offset[1]+a.offsetHeight)-this.ycomp)/a.offsetHeight}if(b=="horizontal"){return((this.offset[0]+a.offsetWidth)-this.xcomp)/a.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,d,a){a=a||{};return Element.clonePosition(d,b,a)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(b){function a(d){return d.blank()?null:"[contains(concat(' ', @class, ' '), ' "+d+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(d,f){f=f.toString().strip();var e=/\s/.test(f)?$w(f).map(a).join(""):a(f);return e?document._getElementsByXPath(".//*"+e,d):[]}:function(f,g){g=g.toString().strip();var h=[],j=(/\s/.test(g)?$w(g):null);if(!j&&!g){return h}var d=$(f).getElementsByTagName("*");g=" "+g+" ";for(var e=0,l,k;l=d[e];e++){if(l.className&&(k=" "+l.className+" ")&&(k.include(g)||(j&&j.all(function(m){return !m.toString().blank()&&k.include(" "+m+" ")})))){h.push(Element.extend(l))}}return h};return function(e,d){return $(d||document.body).getElementsByClassName(e)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a)){return}this.set($A(this).concat(a).join(" "))},remove:function(a){if(!this.include(a)){return}this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var d=this.slice(4,this.length-1).split(",");var b=0;do{a+=parseInt(d[b],10).toColorPart()}while(++b<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var b=1;b<4;b++){a+=(this.charAt(b)+this.charAt(b)).toLowerCase()}}if(this.length==7){a=this.toLowerCase()}}}return(a.length==7?a:(arguments[0]||this))};Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(d){return(d.nodeType==3?d.nodeValue:((d.hasChildNodes()&&!Element.hasClassName(d,b))?Element.collectTextNodesIgnoreClass(d,b):""))}).flatten().join("")};Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:(b/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var d=document.createTextNode(" ");a.appendChild(d);a.removeChild(d)}catch(b){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return(-Math.cos(a*Math.PI)/2)+0.5},reverse:function(a){return 1-a},flicker:function(a){var a=((-Math.cos(a*Math.PI)/4)+0.75)+Math.random()/4;return a>1?1:a},wobble:function(a){return(-Math.cos(a*Math.PI*(9*a))/2)+0.5},pulse:function(b,a){return(-Math.cos((b*((a||5)-0.5)*2)*Math.PI)/2)+0.5},spring:function(a){return 1-(Math.cos(a*4.5*Math.PI)*Math.exp(-a*6))},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE){b+=";zoom:1"}a=$(a);$A(a.childNodes).each(function(d){if(d.nodeType==3){d.nodeValue.toArray().each(function(e){a.insertBefore(new Element("span",{style:b}).update(e==" "?String.fromCharCode(160):e),d)});Element.remove(d)}})},multiple:function(b,d){var f;if(((typeof b=="object")||Object.isFunction(b))&&(b.length)){f=b}else{f=$(b).childNodes}var a=Object.extend({speed:0.1,delay:0},arguments[2]||{});var e=a.delay;$A(f).each(function(h,g){new d(h,Object.extend(a,{delay:g*a.speed+e}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(b,d){b=$(b);d=(d||"appear").toLowerCase();var a=Object.extend({queue:{position:"end",scope:(b.id||"global"),limit:1}},arguments[2]||{});Effect[b.visible()?Effect.PAIRS[d][1]:Effect.PAIRS[d][0]](b,a)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(b){var d=new Date().getTime();var a=Object.isString(b.options.queue)?b.options.queue:b.options.queue.position;switch(a){case"front":this.effects.findAll(function(f){return f.state=="idle"}).each(function(f){f.startOn+=b.finishOn;f.finishOn+=b.finishOn});break;case"with-last":d=this.effects.pluck("startOn").max()||d;break;case"end":d=this.effects.pluck("finishOn").max()||d;break}b.startOn+=d;b.finishOn+=d;if(!b.options.queue.limit||(this.effects.length<b.options.queue.limit)){this.effects.push(b)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var d=new Date().getTime();for(var b=0,a=this.effects.length;b<a;b++){this.effects[b]&&this.effects[b].loop(d)}}});Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a)){return a}return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(a){function b(e,d){return((e[d+"Internal"]?"this.options."+d+"Internal(this);":"")+(e[d]?"this.options."+d+"(this);":""))}if(a&&a.transition===false){a.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function d(f,e){if(f.options[e+"Internal"]){f.options[e+"Internal"](f)}if(f.options[e]){f.options[e](f)}}return function(e){if(this.state==="idle"){this.state="running";d(this,"beforeSetup");if(this.setup){this.setup()}d(this,"afterSetup")}if(this.state==="running"){e=(this.options.transition(e)*this.fromToDelta)+this.options.from;this.position=e;d(this,"beforeUpdate");if(this.update){this.update(e)}d(this,"afterUpdate")}}})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(d){if(d>=this.startOn){if(d>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var b=(d-this.startOn)/this.totalTime,a=(b*this.totalFrames).round();if(a>this.currentFrame){this.render(b);this.currentFrame=a}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(a){if(this.options[a+"Internal"]){this.options[a+"Internal"](this)}if(this.options[a]){this.options[a](this)}},inspect:function(){var a=$H();for(property in this){if(!Object.isFunction(this[property])){a.set(property,this[property])}}return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[];this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");if(b.finish){b.finish(a)}b.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(d,g,f){d=Object.isString(d)?$(d):d;var b=$A(arguments),e=b.last(),a=b.length==5?b[3]:null;this.method=Object.isFunction(e)?e.bind(d):Object.isFunction(d[e])?d[e].bind(d):function(h){d[e]=h};this.start(Object.extend({from:g,to:f},a||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var a=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(a)},update:function(a){this.element.setOpacity(a)}});Effect.Move=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(b,a,d){return new Effect.Move(b,Object.extend({x:d,y:a},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(b,d){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:d},arguments[2]||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(a){var b=(this.options.scaleFrom/100)+(this.factor*a);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(a,f){var g={};if(this.options.scaleX){g.width=f.round()+"px"}if(this.options.scaleY){g.height=a.round()+"px"}if(this.options.scaleFromCenter){var e=(a-this.dims[0])/2;var b=(f-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){g.top=this.originalTop-e+"px"}if(this.options.scaleX){g.left=this.originalLeft-b+"px"}}else{if(this.options.scaleY){g.top=-e+"px"}if(this.options.scaleX){g.left=-b+"px"}}}this.element.setStyle(g)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(a)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,d,e){return b+((this._base[e]+(this._delta[e]*a)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(d){var b=arguments[1]||{},a=document.viewport.getScrollOffsets(),e=Element.cumulativeOffset(d);if(b.offset){e[1]+=b.offset}return new Effect.Tween(null,a.top,e[1],b,function(f){scrollTo(a.left,f.round())})};Effect.Fade=function(d){d=$(d);var a=d.getInlineOpacity();var b=Object.extend({from:d.getOpacity()||1,to:0,afterFinishInternal:function(e){if(e.options.to!=0){return}e.element.hide().setStyle({opacity:a})}},arguments[1]||{});return new Effect.Opacity(d,b)};Effect.Appear=function(b){b=$(b);var a=Object.extend({from:(b.getStyle("display")=="none"?0:b.getOpacity()||0),to:1,afterFinishInternal:function(d){d.element.forceRerendering()},beforeSetup:function(d){d.element.setOpacity(d.options.from).show()}},arguments[1]||{});return new Effect.Opacity(b,a)};Effect.Puff=function(b){b=$(b);var a={opacity:b.getInlineOpacity(),position:b.getStyle("position"),top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};return new Effect.Parallel([new Effect.Scale(b,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(d){Position.absolutize(d.effects[0].element)},afterFinishInternal:function(d){d.effects[0].element.hide().setStyle(a)}},arguments[1]||{}))};Effect.BlindUp=function(a){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(b){b=$(b);var a=b.getDimensions();return new Effect.Scale(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(d){d.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(b){b=$(b);var a=b.getInlineOpacity();return new Effect.Appear(b,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(d){new Effect.Scale(d.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(e){e.element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned().setStyle({opacity:a})}})}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(b,{x:0,y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(d){d.effects[0].element.makePositioned()},afterFinishInternal:function(d){d.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.Shake=function(e){e=$(e);var b=Object.extend({distance:20,duration:0.5},arguments[1]||{});var f=parseFloat(b.distance);var d=parseFloat(b.duration)/10;var a={top:e.getStyle("top"),left:e.getStyle("left")};return new Effect.Move(e,{x:f,y:0,duration:d,afterFinishInternal:function(g){new Effect.Move(g.element,{x:-f*2,y:0,duration:d*2,afterFinishInternal:function(h){new Effect.Move(h.element,{x:f*2,y:0,duration:d*2,afterFinishInternal:function(j){new Effect.Move(j.element,{x:-f*2,y:0,duration:d*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:f*2,y:0,duration:d*2,afterFinishInternal:function(l){new Effect.Move(l.element,{x:-f,y:0,duration:d,afterFinishInternal:function(m){m.element.undoPositioned().setStyle(a)}})}})}})}})}})}})};Effect.SlideDown=function(d){d=$(d).cleanWhitespace();var a=d.down().getStyle("bottom");var b=d.getDimensions();return new Effect.Scale(d,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(e){e.element.makePositioned();e.element.down().makePositioned();if(window.opera){e.element.setStyle({top:""})}e.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:(e.dims[0]-e.element.clientHeight)+"px"})},afterFinishInternal:function(e){e.element.undoClipping().undoPositioned();e.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.SlideUp=function(d){d=$(d).cleanWhitespace();var a=d.down().getStyle("bottom");var b=d.getDimensions();return new Effect.Scale(d,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(e){e.element.makePositioned();e.element.down().makePositioned();if(window.opera){e.element.setStyle({top:""})}e.element.makeClipping().show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:(e.dims[0]-e.element.clientHeight)+"px"})},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned();e.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};Effect.Grow=function(d){d=$(d);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var a={top:d.style.top,left:d.style.left,height:d.style.height,width:d.style.width,opacity:d.getInlineOpacity()};var h=d.getDimensions();var j,g;var f,e;switch(b.direction){case"top-left":j=g=f=e=0;break;case"top-right":j=h.width;g=e=0;f=-h.width;break;case"bottom-left":j=f=0;g=h.height;e=-h.height;break;case"bottom-right":j=h.width;g=h.height;f=-h.width;e=-h.height;break;case"center":j=h.width/2;g=h.height/2;f=-h.width/2;e=-h.height/2;break}return new Effect.Move(d,{x:j,y:g,duration:0.01,beforeSetup:function(k){k.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(k){new Effect.Parallel([new Effect.Opacity(k.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(k.element,{x:f,y:e,sync:true,transition:b.moveTransition}),new Effect.Scale(k.element,100,{scaleMode:{originalHeight:h.height,originalWidth:h.width},sync:true,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(l){l.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(l){l.effects[0].element.undoClipping().undoPositioned().setStyle(a)}},b))}})};Effect.Shrink=function(d){d=$(d);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var a={top:d.style.top,left:d.style.left,height:d.style.height,width:d.style.width,opacity:d.getInlineOpacity()};var g=d.getDimensions();var f,e;switch(b.direction){case"top-left":f=e=0;break;case"top-right":f=g.width;e=0;break;case"bottom-left":f=0;e=g.height;break;case"bottom-right":f=g.width;e=g.height;break;case"center":f=g.width/2;e=g.height/2;break}return new Effect.Parallel([new Effect.Opacity(d,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(d,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(d,{x:f,y:e,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(h){h.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(h){h.effects[0].element.hide().undoClipping().undoPositioned().setStyle(a)}},b))};Effect.Pulsate=function(d){d=$(d);var b=arguments[1]||{},a=d.getInlineOpacity(),f=b.transition||Effect.Transitions.linear,e=function(g){return 1-f((-Math.cos((g*(b.pulses||5)*2)*Math.PI)/2)+0.5)};return new Effect.Opacity(d,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(g){g.element.setStyle({opacity:a})}},b),{transition:e}))};Effect.Fold=function(b){b=$(b);var a={top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};b.makeClipping();return new Effect.Scale(b,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(d){new Effect.Scale(b,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(a)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(d){this.element=$(d);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(a.style)){this.style=$H(a.style)}else{if(a.style.include(":")){this.style=a.style.parseStyle()}else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var b=this.element.getStyles();this.style=this.style.reject(function(e){return e.value==b[e.key]});a.afterFinishInternal=function(e){e.element.addClassName(e.options.style);e.transforms.each(function(f){e.element.style[f.style]=""})}}}this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b)){b="#ffffff"}b=b.parseColor();return $R(0,2).map(function(d){return parseInt(b.slice(d*2+1,d*2+3),16)})}this.transforms=this.style.map(function(h){var g=h[0],f=h[1],e=null;if(f.parseColor("#zzzzzz")!="#zzzzzz"){f=f.parseColor();e="color"}else{if(g=="opacity"){f=parseFloat(f);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(f)){var d=f.match(/^([\+\-]?[0-9\.]+)(.*)$/);f=parseFloat(d[1]);e=(d.length==3)?d[2]:null}}}var b=this.element.getStyle(g);return{style:g.camelize(),originalValue:e=="color"?a(b):parseFloat(b||0),targetValue:e=="color"?a(f):f,unit:e}}.bind(this)).reject(function(b){return((b.originalValue==b.targetValue)||(b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))))})},update:function(a){var e={},b,d=this.transforms.length;while(d--){e[(b=this.transforms[d]).style]=b.unit=="color"?"#"+(Math.round(b.originalValue[0]+(b.targetValue[0]-b.originalValue[0])*a)).toColorPart()+(Math.round(b.originalValue[1]+(b.targetValue[1]-b.originalValue[1])*a)).toColorPart()+(Math.round(b.originalValue[2]+(b.targetValue[2]-b.originalValue[2])*a)).toColorPart():(b.originalValue+(b.targetValue-b.originalValue)*a).toFixed(3)+(b.unit===null?"":b.unit)}this.element.setStyle(e,true)}});Effect.Transform=Class.create({initialize:function(a){this.tracks=[];this.options=arguments[1]||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var d=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:d}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var e=a.get("ids"),d=a.get("effect"),b=a.get("options");var f=[$(e)||$$(e)].flatten();return f.map(function(g){return new d(g,Object.extend({sync:true},b))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var b,a=$H();if(Prototype.Browser.WebKit){b=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';b=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(d){if(b[d]){a.set(d,b[d])}});if(Prototype.Browser.IE&&this.include("opacity")){a.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return a};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(b){var a=document.defaultView.getComputedStyle($(b),null);return Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=a[e];return d})}}else{Element.getStyles=function(b){b=$(b);var a=b.currentStyle,d;d=Element.CSS_PROPERTIES.inject({},function(e,f){e[f]=a[f];return e});if(!d.opacity){d.opacity=b.getOpacity()}return d}}Effect.Methods={morph:function(a,b){a=$(a);new Effect.Morph(a,Object.extend({style:b},arguments[2]||{}));return a},visualEffect:function(d,f,b){d=$(d);var e=f.dasherize().camelize(),a=e.charAt(0).toUpperCase()+e.substring(1);new Effect[a](d,b);return d},highlight:function(b,a){b=$(b);new Effect.Highlight(b,a);return b}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(d,b){d=$(d);Effect[a.charAt(0).toUpperCase()+a.substring(1)](d,b);return d}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,d,a){b=$(b);this.element=b;this.update=$(d);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(e,f){if(!f.style.position||f.style.position=="absolute"){f.style.position="absolute";Position.clone(e,f,{setHeight:false,offsetTop:e.offsetHeight})}Effect.Appear(f,{duration:0.15})};this.options.onHide=this.options.onHide||function(e,f){new Effect.Fade(f,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(g){if(this.options.updateElement){this.options.updateElement(g);return}var e="";if(this.options.select){var a=$(g).select("."+this.options.select)||[];if(a.length>0){e=Element.collectTextNodes(a[0],this.options.select)}}else{e=Element.collectTextNodesIgnoreClass(g,"informal")}var d=this.getTokenBounds();if(d[0]!=-1){var f=this.element.value.substr(0,d[0]);var b=this.element.value.substr(d[0]).match(/^\s+/);if(b){f+=b[0]}this.element.value=f+e+this.element.value.substr(d[1])}else{this.element.value=e}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,g)}},updateChoices:function(d){if(!this.changed&&this.hasFocus){this.update.innerHTML=d;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var f=this.element.value;if(f.strip().empty()){return[-1,0]}var g=arguments.callee.getFirstDifferencePos(f,this.oldElementValue);var j=(g==this.oldElementValue.length?1:0);var e=-1,d=f.length;var h;for(var b=0,a=this.options.tokens.length;b<a;++b){h=f.lastIndexOf(this.options.tokens[b],g+j-1);if(h>e){e=h}h=f.indexOf(this.options.tokens[b],g+j);if(-1!=h&&h<d){d=h}}return(this.tokenBounds=[e+1,d])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(d,a){var e=Math.min(d.length,a.length);for(var b=0;b<e;++b){if(d[b]!=a[b]){return b}}return e};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(d,e,b,a){this.baseInitialize(d,e,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,e,d,a){this.baseInitialize(b,e,a);this.options.array=d},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var e=[];var d=[];var j=b.getToken();var h=0;for(var f=0;f<b.options.array.length&&e.length<b.options.choices;f++){var g=b.options.array[f];var k=b.options.ignoreCase?g.toLowerCase().indexOf(j.toLowerCase()):g.indexOf(j);while(k!=-1){if(k==0&&g.length!=j.length){e.push("<li><strong>"+g.substr(0,j.length)+"</strong>"+g.substr(j.length)+"</li>");break}else{if(j.length>=b.options.partialChars&&b.options.partialSearch&&k!=-1){if(b.options.fullSearch||(/\s/.test(g.substr(k-1,1)))){d.push("<li>"+g.substr(0,k)+"<strong>"+g.substr(k,j.length)+"</strong>"+g.substr(k+j.length)+"</li>");break}}}k=b.options.ignoreCase?g.toLowerCase().indexOf(j.toLowerCase(),k+1):g.indexOf(j,k+1)}}if(d.length){e=e.concat(d.slice(0,b.options.choices-e.length))}return"<ul>"+e.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(d,b,a){this.url=b;this.element=d=$(d);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(h,d,b){var f=this.options[h+"Control"];var g=this.options[h+"Text"];if("button"==f){var a=document.createElement("input");a.type="submit";a.value=g;a.className="editor_"+h+"_button";if("cancel"==h){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[h]=a}else{if("link"==f){var e=document.createElement("a");e.href="#";e.appendChild(document.createTextNode(g));e.onclick="cancel"==h?this._boundCancelHandler:this._boundSubmitHandler;e.className="editor_"+h+"_link";if(b){e.className+=" "+b}this._form.appendChild(e);this._controls[h]=e}}},createEditField:function(){var d=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!(/\r|\n/.test(this.getText()))){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=d;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(e,f){var d=b.options["text"+e+"Controls"];if(!d||f===false){return}b._form.appendChild(document.createTextNode(d))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();if(a){Event.stop(a)}},handleFormSubmission:function(f){var b=this._form;var d=$F(this._controls.editor);this.prepareSubmission();var g=this.options.callback(b,d)||"";if(Object.isString(g)){g=g.toQueryParams()}g.editorId=this.element.id;if(this.options.htmlResponse){var a=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(a,{parameters:g,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,a)}else{var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:g,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,a)}if(f){Event.stop(f)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(d){this._form.removeClassName(this.options.loadingClassName);var b=d.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,d,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(d,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!(/^\[.*\]$/.test(js))){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(e){return 2===e.length?e:[e,e].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(e){return e[0]==b}.bind(this));this._controls.editor.update("");var d;this._collection.each(function(f,e){d=document.createElement("option");d.value=f[0];d.selected=a?f[0]==b:0==e;d.appendChild(document.createTextNode(f[1]));this._controls.editor.appendChild(d)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(d,e){if(d in a||e===undefined){return}a[d]=e}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,d){this.delay=a||0.5;this.element=$(b);this.callback=d;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});var GetText={init:function(){if(!this.strings){this.strings={}}},set:function(a,b){this.init();if(a!=b){this.strings[a]=b}},get:function(a){this.init();translated=this.strings[a];if(translated){return translated}else{return a}}};function _(a){return GetText.get(a)}GetText.set("Loading","Loading");GetText.set("SMS alerts are disabled","SMS alerts are disabled");GetText.set('You need to <a href="%{url}">configure your mobile phone</a> in order to enable SMS alerts.','You need to <a href="%{url}">configure your mobile phone</a> in order to enable SMS alerts.');GetText.set("... is created","... is created");GetText.set("... receives a signature","... receives a signature");GetText.set('... just before it changes to "Signed"','... just before it changes to "Signed"');GetText.set('... changes from "Draft" to "Signed"','... changes from "Draft" to "Signed"');GetText.set("Invite a new participant","Invite a new participant");GetText.set("Send an email","Send an email");GetText.set("Redirect user to this web page","Redirect user to this web page");GetText.set("E-mail:","E-mail:");GetText.set("Team name:","Team name:");GetText.set("Administrator","Administrator");GetText.set("Editor","Editor");GetText.set("Reader","Reader");GetText.set("Visible","Visible");GetText.set("Signer","Signer");GetText.set("Subject:","Subject:");GetText.set("Body:","Body:");GetText.set("Web Address:","Web Address:");GetText.set("<strong>E-mail:</strong> #{email}<br /><strong>Team name:</strong> #{team}<br /><strong>Permissions:</strong> #{role}<br /><strong>Visible:</strong> #{visible}<br /><strong>Signer:</strong> #{sign}","<strong>E-mail:</strong> #{email}<br /><strong>Team name:</strong> #{team}<br /><strong>Permissions:</strong> #{role}<br /><strong>Visible:</strong> #{visible}<br /><strong>Signer:</strong> #{sign}");GetText.set("<strong>E-mail:</strong> #{email}<br /><strong>Subject:</strong> #{subject}<br /><strong>Body:</strong> #{body}","<strong>E-mail:</strong> #{email}<br /><strong>Subject:</strong> #{subject}<br /><strong>Body:</strong> #{body}");GetText.set("<strong>Web Address:</strong> #{url}","<strong>Web Address:</strong> #{url}");GetText.set("When the contract...","When the contract...");GetText.set("Save","Save");GetText.set("Cancel","Cancel");GetText.set("Perform this action...","Perform this action...");GetText.set("remove","remove");GetText.set("Yes","Yes");GetText.set("No","No");GetText.set("ID","ID");GetText.set("Payroll","Payroll");GetText.set("Appraisal","Appraisal");GetText.set("i.e. I want Tractis to verify that the name on the ID matches the name on the contract","i.e. I want Tractis to verify that the name on the ID matches the name on the contract");GetText.set("i.e. I want Tractis to verify that the date on the payroll is no more than a month old","i.e. I want Tractis to verify that the date on the payroll is no more than a month old");GetText.set("i.e. I want Tractis to verify that the total valuation on the appraisal matches the one on the contract","i.e. I want Tractis to verify that the total valuation on the appraisal matches the one on the contract");GetText.set("<strong>Verification:</strong> #{verification}","<strong>Verification:</strong> #{verification}");GetText.set("Choose","Choose");GetText.set("Write here the document description you want the user to see","Write here the document description you want the user to see");GetText.set("Confirm your action","Confirm your action");GetText.set("Ok","Ok");GetText.set("This is a non-accepted certificate.","This is a non-accepted certificate.");GetText.set("Please, select an accepted certificate to authenticate.","Please, select an accepted certificate to authenticate.");GetText.set("We were unable to access the certificate.","We were unable to access the certificate.");GetText.set("Please, ensure that the device (Smart card or USB) is connected.","Please, ensure that the device (Smart card or USB) is connected.");GetText.set("Required","Required");GetText.set("Already in use","Already in use");GetText.set("Invalid e-mail address","Invalid e-mail address");GetText.set("Confirmation doesn't match","Confirmation doesn't match");GetText.set("Enter at least {0} characters.","Enter at least {0} characters.");GetText.set("Sending certificate","Sending certificate");GetText.set("Uploading the signature","Uploading the signature");GetText.set("You must accept the conditions before processing your request.","You must accept the conditions before processing your request.");GetText.set("Please, check the box to indicate you agree to these conditions.","Please, check the box to indicate you agree to these conditions.");GetText.set("less than a minute ago","less than a minute ago");GetText.set("a minute ago","a minute ago");GetText.set("%{minutes} minutes ago","%{minutes} minutes ago");GetText.set("about 1 hour ago","about 1 hour ago");GetText.set("about %{hours} hours ago","about %{hours} hours ago");GetText.set("1 day ago","1 day ago");GetText.set("%{days} days ago","%{days} days ago");GetText.set("about 1 month ago","about 1 month ago");GetText.set("%{months} months ago","%{months} months ago");GetText.set("about 1 year ago","about 1 year ago");GetText.set("over %{years} years ago","over %{years} years ago");GetText.set("Paragraph","Paragraph");GetText.set("Title 1","Title 1");GetText.set("Title 2","Title 2");GetText.set("Title 3","Title 3");GetText.set("Title 4","Title 4");GetText.set("Title 5","Title 5");GetText.set("Title 6","Title 6");GetText.set("Tools","Tools");GetText.set("Strong","Strong");GetText.set("Emphasis","Emphasis");GetText.set("Numeric list","Numeric list");GetText.set("Bulleted list","Bulleted list");GetText.set("Outdent","Outdent");GetText.set("Indent","Indent");GetText.set("Undo","Undo");GetText.set("Redo","Redo");GetText.set("Create link","Create link");GetText.set("Delete link","Delete link");GetText.set("Source_Code","Source_Code");GetText.set("Status","Status");GetText.set("URL","URL");GetText.set("Title","Title");GetText.set("Submit","Submit");GetText.set("Lock","Lock");GetText.set("Unlock","Unlock");GetText.set("Sign","Sign");GetText.set("Export","Export");GetText.set("Print","Print");GetText.set("Upload attachment","Upload attachment");GetText.set("Table","Table");GetText.set("Close this window","Close this window");GetText.set("Create table","Create table");GetText.set("Please use this form to define your table","Please use this form to define your table");GetText.set("Caption","Caption");GetText.set("Summary","Summary");GetText.set("Write here a description for this table","Write here a description for this table");GetText.set("Rows","Rows");GetText.set("Columns","Columns");GetText.set("Your changes won't be saved if you quit the page now.","Your changes won't be saved if you quit the page now.");GetText.set("Your comment will be lost if you leave now.","Your comment will be lost if you leave now.");GetText.set("Formatting text, please wait","Formatting text, please wait");GetText.set("Pasted content has been formatted","Pasted content has been formatted");GetText.set("We were unable to save this contract version.","We were unable to save this contract version.");GetText.set("Please, refresh the page. If this error persists, contact us.","Please, refresh the page. If this error persists, contact us.");GetText.set("Browser not supported","Browser not supported");GetText.set("Please contact support","Please contact support");GetText.set("Error","Error");GetText.set("We can connect to our certificate client","We can connect to our certificate client");GetText.set("Error loading certificates","Error loading certificates");GetText.set("Signing...","Signing...");GetText.set("Validating the signature","Validating the signature");GetText.set("Signature Error","Signature Error");GetText.set("We had a problem generating the signature, please contact support","We had a problem generating the signature, please contact support");GetText.set("Authenticating","Authenticating");GetText.set("You can use these certificates","You can use these certificates");GetText.set("You cannot use these certificates","You cannot use these certificates");GetText.set("Header 1","Header 1");GetText.set("Header 2","Header 2");GetText.set("Header 3","Header 3");GetText.set("Header 4","Header 4");GetText.set("Header 5","Header 5");GetText.set("Header 6","Header 6");GetText.set("Insert destination URL","Insert destination URL");GetText.set("Your browser doesn't support Tractis editor","Your browser doesn't support Tractis editor");GetText.set("We were unable to initialize the signature service on your computer. ","We were unable to initialize the signature service on your computer. ");GetText.set("Please, try to sign again and, if the problem persists, contact us.","Please, try to sign again and, if the problem persists, contact us.");GetText.set("Please, ensure that you have selected the right and that the password is correct.","Please, ensure that you have selected the right and that the password is correct.");GetText.set("Cannot find signature device drivers, they where expected to be found at ","Cannot find signature device drivers, they where expected to be found at ");GetText.set("An error raised detecting signature device drivers, please try again and if the error persist contact your certificate provider","An error raised detecting signature device drivers, please try again and if the error persist contact your certificate provider");GetText.set("The certificate doesn't belong to a supported CA","The certificate doesn't belong to a supported CA");GetText.set("The certificate doesn't support digital signature","The certificate doesn't support digital signature");GetText.set("The certificate is out of date","The certificate is out of date");GetText.set("This certificate doesn't contain a supported policy","This certificate doesn't contain a supported policy");GetText.set("No certificate drivers have been found on the system","No certificate drivers have been found on the system");GetText.set("Creating the signature","Creating the signature");GetText.set("We cannot create a signature.","We cannot create a signature.");GetText.set("Signature has been canceled.","Signature has been canceled.");GetText.set("No signature has been performed.","No signature has been performed.");GetText.set("Signature created","Signature created");GetText.set("Cannot load signature component, please ensure that you have Java 1.6 installed and working and retry again","Cannot load signature component, please ensure that you have Java 1.6 installed and working and retry again");GetText.set("Select other certificate","Select other certificate");GetText.set("No card reader present","No card reader present");GetText.set("Please, select an accepted certificate to sign the contract.","Please, select an accepted certificate to sign the contract.");GetText.set("The certificate doesn't belong to a Tractis CA supported","This certificate doesn't belong to a CA supported by Tractis");GetText.set("This certificate doesn't contain a policy supported by Tractis","This certificate doesn't contain a policy supported by Tractis");GetText.set("An error has happened with this file","An error has happened with this file");GetText.set("ensure the password is correct","ensure the password is correct");GetText.set("Current time reported by the server is %{time}","Current time reported by the server is %{time}");GetText.set("Your computer's time is in the future","Your computer's time is in the future");GetText.set("This time will be used as signature creation time","This time will be used as signature creation time");GetText.set("Using your computers time as signature creation time ","Using your computers time as signature creation time ");GetText.set("You need Java 1.6 to sign the document","You need Java 1.6 to sign the document");GetText.set("You can't select signature methods with a Tractis Score lower than %{score}","You can't select signature methods with a Tractis Score lower than %{score}");GetText.set("In order to allow %{method} as a valid signature method, you must first lower your Tractis Score preferences.","In order to allow %{method} as a valid signature method, you must first lower your Tractis Score preferences.");GetText.set("You can't use %{method} to sign this contract","You can't use %{method} to sign this contract");GetText.set("The administrator of the %{account} Business account has forbidden to use %{method} as a signature method. If you have any doubt or comment, please, <a %{contact_your_admin_link}>contact your administrator</a>.","The administrator of the %{account} Business account has forbidden to use %{method} as a signature method. If you have any doubt or comment, please, <a %{contact_your_admin_link}>contact your administrator</a>.");GetText.set("You can't select a Tractis Score lower than %{score}","You can't select a Tractis Score lower than %{score}");GetText.set("The administrator of the %{account} Business account has forbidden to use signature methods with a Tractis Score lower than %{score}. For any doubt or comment, please, <a %{contact_your_admin_link}>contact your administrator</a>.","The administrator of the %{account} Business account has forbidden to use signature methods with a Tractis Score lower than %{score}. For any doubt or comment, please, <a %{contact_your_admin_link}>contact your administrator</a>.");GetText.set("You can't select Tractis Score %{score}","You can't select Tractis Score %{score}");GetText.set("You must have at least one signature method allowed.","You must have at least one signature method allowed.");GetText.set("Please, select a signature method with a higher score before updating your Tractis Score.","Please, select a signature method with a higher score before updating your Tractis Score.");GetText.set("1 - Assurance level: Minimum","1 - Assurance level: Minimum");GetText.set("2 - Assurance level: Low","2 - Assurance level: Low");GetText.set("3 - Assurance level: Substantial","3 - Assurance level: Substantial");GetText.set("4 - Assurance level: High","4 - Assurance level: High");GetText.set("Invalid Tractis Score","Invalid Tractis Score");GetText.set("Show allowed certificates only","Show allowed certificates only");GetText.set("Show all certificates","Show all certificates");GetText.set("Certificate policy with OID: %{oid}","Certificate policy with OID: %{oid}");GetText.set("All (%{amount})","All (%{amount})");GetText.set("<strong>%{amount}</strong> allowed certificates","<strong>%{amount}</strong> allowed certificates");var DateHelper={time_ago_in_words_with_parsing:function(b){var a=new Date;a.setTime(Date.parse(b));return this.time_ago_in_words(a)},time_ago_in_words:function(a){return this.distance_of_time_in_words(new Date,a)},distance_of_time_in_words:function(e,d){var b=((e-d)/1000);var a=(b/60).floor();if(a==0){return _("less than a minute ago")}if(a==1){return _("a minute ago")}if(a<45){return _("%{minutes} minutes ago").replace(/%\{minutes\}/,a)}if(a<90){return _("about 1 hour ago")}if(a<1440){return _("about %{hours} hours ago").replace(/%\{hours\}/,(a/60).floor())}if(a<2880){return _("1 day ago")}if(a<43200){return _("%{days} days ago").replace(/%\{days\}/,(a/1440).floor())}if(a<86400){return _("about 1 month ago")}if(a<525960){return _("%{months} months ago").replace(/%\{months\}/,(a/43200).floor())}if(a<1051199){return _("about 1 year ago")}return _("over %{years} years ago").replace(/%\{years\}/,(a/525960).floor())},convert_all_times_from_today_to_words:function(){$$("span.convert_time").each(function(a){a.innerHTML=this.time_ago_in_words_with_parsing(a.getAttribute("time").replace(/\-/g,"/"));a.setAttribute("title",a.getAttribute("time"))},this)}};function template_selector(a,b,d){if(b){if(b=="new_template"){location=d+"new"}else{a.action=d+b+"/use_template";$("create_contract_from_template").enable();$("create_contract_from_template").setStyle({color:"#333333"})}}else{$("create_contract_from_template").disable();$("create_contract_from_template").setStyle({color:"#aaa"})}}function toggleLink(b){b=$(b);var d=b["neg:inactiveText"]||b.getAttribute("neg:inactiveText");if(!d){b["neg:inactiveText"]=b.innerHTML;d=b.innerHTML}var a=b.getAttribute("neg:activeText");if(b["neg:active"]){b.innerHTML=d;b["neg:active"]=false}else{b.innerHTML=a;b["neg:active"]=true}}function frame_element(b){var b=$(b);var f=b.cumulativeOffset();var a=b.getHeight()+20;var d=document.viewport.getHeight();if(f.top+a>document.viewport.getScrollOffsets().top+d){var e=0;if(d<(a-20)){e=20}else{e=(d-a)}window.scrollTo(f.left,f.top-e)}}function showElement(b,a){try{if($(b)&&!Element.visible(b)){a=a||{};new Effect.BlindDown(b,{duration:0.3,afterFinish:function(){$(b).style.width="auto";$(b).style.height="auto";var e=b;if(a.framedElement){e=a.framedElement}frame_element(e);if(a.afterFinish){a.afterFinish()}}})}}catch(d){}}function hideElement(b,a){try{if($(b)&&Element.visible(b)){a=a||{};new Effect.BlindUp(b,{duration:0.3,afterFinish:function(){Element.hide(b);if(a.afterFinish){a.afterFinish()}}})}}catch(d){}}function getOperatingSystem(){var b="Unknown OS";var a=navigator.platform;if(a.indexOf("Win")!=-1){b="Windows"}if(a.indexOf("Mac")!=-1){b="MacOS"}if(a.indexOf("X11")!=-1){b="UNIX"}if(a.indexOf("Linux")!=-1){b="Linux"}return b}Object.extend(Ajax.InPlaceEditor.prototype,{getText:function(){return this.element.innerHTML.gsub(/&amp;/,"&").gsub(/&lt;/,"<").gsub(/&gt;/,">")},handleFormSubmission:function(g){var d=this._form;var f=$F(this._controls.editor);var a=false;if(this.options.evalOnChange){if(this._controls.editor.tagName=="SELECT"){if(this._controls.editor[f].innerHTML==this.element.innerHTML){a=true}}else{if(f==this.getText()){a=true}}}if(a||this._saving){this._boundWrapperHandler();this.leaveEditMode();return false}this.prepareSubmission();var h=this.options.callback(d,f)||"";if(Object.isString(h)){h=h.toQueryParams()}h.editorId=this.element.id;if(this.options.htmlResponse){var b=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,b)}else{var b=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,b)}if(g){Event.stop(g)}},onEnterEditMode:function(){Element.addClassName("menus","links-lock")},onLeaveEditMode:function(){Element.removeClassName("menus","links-lock")}});if(Ajax.InPlaceEditor.DefaultOptions){Ajax.InPlaceEditor.DefaultOptions.ajaxOptions={evalScripts:false}}Object.extend(Ajax.InPlaceCollectionEditor.prototype,{buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(e){return 2===e.length?e:[e,e].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(e){return e[0]==b}.bind(this));this._controls.editor.update("");var d;this._collection.each(function(f,e){d=document.createElement("option");d.value=f[0];d.selected=a?f[0]==b:0==e;d.selected=d.selected||f[1]==b;d.appendChild(document.createTextNode(f[1]));this._controls.editor.appendChild(d)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor);if(this.options.submitOnBlur){this._controls.editor.onchange=this.handleFormSubmission.bind(this);this._controls.editor.onblur=this.handleFormSubmission.bind(this)}}});var editable_crumb={init:function(a){this.input=$("editable_crumb");this.path=a;this.input.onkeyup=function(){editable_crumb.update_width()};this.input.form.onsubmit=function(){return editable_crumb.onsubmit()};this.update_width()},update_width:function(){this.input.style.width=this.input.value.length+1.5+"em"},onsubmit:function(){window.location.href=this.path+"/"+this.input.value.toLowerCase();return false}};var ListUtils={addOption:function(d,a,b){newOption=document.createElement("option");newOption.appendChild(document.createTextNode(a));newOption.setAttribute("value",b);d.appendChild(newOption)},addOptionObj:function(b,a){b.appendChild(a)},selectOption:function(b,a){if(b.options.length>0){for(i=0;i<b.options.length;i++){if(b.options[i].value==a){b.options[i].selected=true;break}}}},getSelectedOption:function(a){if(a.options&&a.options.length>0){return a.options[a.selectedIndex].value}else{return""}},existsOption:function(b,a){exists=false;if(b.options.length>0){for(i=0;i<b.options.length;i++){if(b.options[i].value==a){exists=true;break}}}return exists},removeOption:function(b,a){b.remove(a)},removeLastOption:function(a){a.remove(a.options.length-1)},clearList:function(b){for(var a=b.options.length-1;a>=0;a--){b.remove(a)}},getOption:function(b,a){return b.options[a]},getLastOption:function(a){return a.options[a.options.length-1]},getSize:function(a){return a.options.length}};function highlightRow(b,a){row=$(b);if(a){Element.addClassName(row,"checked")}else{Element.removeClassName(row,"checked")}}function all(a){$$("table#"+a+" input").each(function(d,b){d.checked=true;d.onclick()})}function none(a){$$("table#"+a+" input").each(function(d,b){d.checked=false;d.onclick()})}function select_all(a){$(a).up("table").select('input[type="checkbox"]').each(function(b){b.checked=true})}function select_none(a){$(a).up("table").select('input[type="checkbox"]').each(function(b){b.checked=false})}var Alerts=Class.create();Alerts={show_alert:function(d,g,e){Alerts.container=$("alerts");Event.observe(Alerts.container,"click",Alerts.hide);Alerts.remove();if(Alerts.timer){clearTimeout(Alerts.timer)}Alerts.container.show();var a=$(document.createElement("div"));Element.addClassName(a,"flash");Element.addClassName(a,"action-alerts");Element.addClassName(a,d);var f,b=$(document.createElement("h4"));b.update(g);Element.insert(a,b);$A(e).each(function(j){f=$(document.createElement("p"));f.update(j);Element.insert(a,f)});var h=a.wrap("div",{"class":"shader"});Element.insert(Alerts.container,h);center=Alerts.container.getWidth()/2;Alerts.container.setStyle({marginLeft:"-"+center+"px"});Alerts.timer=setTimeout(Alerts.hide,15000)},initial:function(a){shown=$("alerts-shown");if($F(shown)=="true"){return}shown.value="true";a()},warning:function(b,a){this.show_alert("warning",b,a)},notice:function(b,a){this.show_alert("sucess",b,a)},error:function(b,a){this.show_alert("error",b,a)},mailed:function(b,a){this.show_alert("sucess",b,a)},show_spinner:function(a){if(Alerts.spinner==null){Alerts.initialize_spinner()}if(!a){a=_("Loading")}a=a.sub(/(\.\.\.|)/,"<span class='spb'></span>");Alerts.spinner_caption.update(a);center=Alerts.spinner.getWidth()/2;Alerts.spinner.setStyle({marginLeft:"-"+center+"px"});Alerts.spinner.show()},hide_spinner:function(){Alerts.spinner.hide()},initialize_spinner:function(){var a=document.getElementsByTagName("body")[0];var f=new Element("div",{id:"spinner"});var d=new Element("div",{"class":"shader"});var b=new Element("div",{"class":"spbg"});var e=new Element("div",{"class":"sp"});Element.insert(b,e);Element.insert(d,b);Element.insert(f,d);Element.insert(a,f);Alerts.spinner=f;Alerts.spinner.hide();Alerts.spinner_caption=e},hide:function(){hideElement(Alerts.container,{afterFinish:function(){Alerts.remove()}})},remove:function(){elements=$$("#alerts div");if(elements){elements.invoke("remove")}}};Ajax.Responders.register({onCreate:function(a){if(!a.options.silent){Alerts.show_spinner()}},onComplete:function(a){if(!a.options.silent){if(Ajax.activeRequestCount==0){Alerts.hide_spinner()}TimeoutSession.setTimer()}DateHelper.convert_all_times_from_today_to_words();try{if(a.getStatus()==200&&pageTracker!=undefined){pageTracker._trackPageview(a.url)}}catch(b){}}});DateHelper.convert_all_times_from_today_to_words();var comments={waiting:false,afterFinish:function(a){this.waiting=false;$("comment_body").value="";if(a){link=$("comments-link");link["neg:inactiveText"]=a}},show:function(){showElement("comments-container-id");toggleLink("comments-link");this.waiting=false},hide:function(){hideElement("comments-container-id",this);toggleLink("comments-link")},request:function(a){new Ajax.Request(a,{asynchronous:true,evalScripts:true,method:"get",onSuccess:function(b){comments.show()}});return false},toggle:function(a){if(this.waiting==false){this.waiting=true;Element.visible("comments-container-id")?this.hide():this.request(a)}},submit:function(){if(this.waiting==false){this.waiting=true;document.forms.comments_action_form.onsubmit()}}};$$("#contract var").each(function(a){if(a.readAttribute("value")!=""){a.setAttribute("title",a.readAttribute("name"))}});$$('a[href^="tractis-feedback:"]').each(function(a){a.observe("click",function(b){type=a.readAttribute("href").split(":").last();new Ajax.Request("/hq/report_bug?issue[report_type]="+type,{asynchronous:true,evalScripts:true,method:"get"});Event.stop(b)})});$$("#library_template_country").each(function(b){var a=$("jurisdiction_hidden");var d=$("library_template_other_country");b.observe("change",function(e){if($F(b)=="OTHER"){a.show();d.focus()}else{a.hide();d.value=""}})});var TimeoutSession=Class.create();TimeoutSession={_events:[[window,"scroll"],[window,"resize"],[document,"mousemove"],[document,"keydown"]],_timer:null,_session_refresher:null,time:60*60,idle_time:20*60,refresh_time:30*60,login:function(a){TimeoutSession.logged_in=true;TimeoutSession.setTimer(a);TimeoutSession.observeActivity()},logout:function(){clearTimeout(TimeoutSession._timer);clearTimeout(TimeoutSession._session_refresher);if(TimeoutSession.logged_in){if(TimeoutSession.idle){new Ajax.Request("/login",{method:"get",silent:true})}else{TimeoutSession.refreshSession()}}TimeoutSession.logged_in=false},checkSession:function(){new Ajax.Request("/sessions/check",{method:"get",silent:true})},setActive:function(){TimeoutSession.idle=false;if(TimeoutSession.logged_in){TimeoutSession.setIdleTimer()}},setIdle:function(){TimeoutSession.idle=true},observeActivity:function(){if(!TimeoutSession.observing_activity){TimeoutSession._events.each(function(a){Event.observe(a[0],a[1],TimeoutSession.setActive)});TimeoutSession.observing_activity=true}TimeoutSession.setActive();TimeoutSession.setSessionRefresher()},refreshSession:function(){if(!TimeoutSession.idle){new Ajax.Request("/sessions/refresh",{method:"get",silent:true})}},setSessionRefresher:function(){clearTimeout(TimeoutSession._session_refresher);TimeoutSession._session_refresher=setTimeout(TimeoutSession.refreshSession,TimeoutSession.refresh_time*1000)},setIdleTimer:function(){clearTimeout(TimeoutSession._idle_timer);TimeoutSession._idle_timer=setTimeout(TimeoutSession.setIdle,TimeoutSession.idle_time*1000)},setTimer:function(a){if(TimeoutSession.logged_in){if(!a){a=TimeoutSession.time}if(a>0){clearTimeout(TimeoutSession._timer);TimeoutSession._timer=setTimeout(TimeoutSession.checkSession,a*1000)}else{clearTimeout(TimeoutSession._timer);TimeoutSession.checkSession()}}}};function configure_mobile_phone(a){Alerts.warning(_("SMS alerts are disabled"),[_('You need to <a href="%{url}">configure your mobile phone</a> in order to enable SMS alerts.').gsub(/%\{url\}/,"/users/mobile_phone")]);a.checked=false}function choose_a_sign_method(a){a=$(a);var b;for(i=0;i<a.options.length;i++){b=$(a.options[i].value);if(a.options[i].selected){b.show()}else{b.hide()}}}function banner_html(a){a=a.gsub(/https?:\/\/[\w\d\.:]+\/images\/banners/,"https://s3.amazonaws.com/cdn.tractis.com/buttons");a=a.gsub(/https?:\/\/[\w\d\.:]+\/images\/lectores/,"https://s3.amazonaws.com/cdn.tractis.com/readers");return a}function banner_select(d){var b=Event.element(d);var a=b.up(".banner").down(".banner-example");b.value=banner_html(a.innerHTML.strip());b.select()}$$(".banner").each(function(a){var b=a.down(".banner-code");var a=a.down("div.banner-example");b.value=banner_html(a.innerHTML.strip());Event.observe(b,"click",banner_select);Event.observe(b,"keydown",banner_select);Event.observe(b,"keyup",banner_select)});ContractEvents={EVENTS:["contract_created","contract_signed","contract_before_finished","contract_finished"],EVENTS_COPY:{contract_created:_("... is created"),contract_signed:_("... receives a signature"),contract_before_finished:_('... just before it changes to "Signed"'),contract_finished:_('... changes from "Draft" to "Signed"')},EVENT_ACTIONS:{contract_created:["send_invitation","send_email"],contract_before_finished:["send_invitation"],contract_finished:["send_invitation","send_email"],contract_signed:["send_invitation","send_email","redirect_user"]},ACTIONS_COPY:{send_invitation:_("Invite a new participant"),send_email:_("Send an email"),redirect_user:_("Redirect user to this web page")},FORM:{send_invitation:'<div class="grilla"><div class="inputs"><label><strong>'+_("E-mail:")+'</strong><input type="text" name="email" /></label></div></div><div class="grilla"><div class="inputs"><label><strong>'+_("Team name:")+'</strong><input type="text" name="team" /></label></div></div><div class="grilla"><div class="inputs"><select name="role"><option value="A">'+_("Administrator")+'</option><option value="E">'+_("Editor")+'</option><option value="R" selected="selected">'+_("Reader")+'</option></select></div></div><div class="grilla"><div class="inputs"><label><input name="visible" value="1" type="checkbox" checked="checked" /> '+_("Visible")+'</label><label><input name="sign" id="wf_sign" value="1" type="checkbox" /> '+_("Signer")+'</label><script>if ($("contract_events_select")[$("contract_events_select").selectedIndex].value == "contract_before_finished") { $("wf_sign").checked = true; $("wf_sign").readOnly = true; } <\/script></div></div>',send_email:'<div class="grilla"><div class="inputs"><label><strong>'+_("E-mail:")+'</strong><input type="text" name="email" /></label></div></div><div class="grilla"><div class="inputs"><label><strong>'+_("Subject:")+'</strong><input type="text" name="subject" /></label></div></div><div class="grilla"><div class="inputs"><label><strong>'+_("Body:")+'</strong><textarea name="body" rows="8" cols="40"></textarea></label></div></div>',redirect_user:'<div class="grilla"><div class="inputs"><label><strong>'+_("Web Address:")+'</strong><input type="text" name="url" /></label></div></div>'},DETAILS:{send_invitation:_("<strong>E-mail:</strong> #{email}<br /><strong>Team name:</strong> #{team}<br /><strong>Permissions:</strong> #{role}<br /><strong>Visible:</strong> #{visible}<br /><strong>Signer:</strong> #{sign}"),send_email:_("<strong>E-mail:</strong> #{email}<br /><strong>Subject:</strong> #{subject}<br /><strong>Body:</strong> #{body}"),redirect_user:_("<strong>Web Address:</strong> #{url}")},build_select:function(b,e,f){var a=new Element("select",{"class":b,name:e});events=f.length;for(var d=0;d<events;d++){Element.insert(a,new Element("option",{value:f[d].type}).update(f[d].text))}return a},build_events_select:function(){var a=new Element("select",{"class":"contract_events_select",id:"contract_events_select",name:"event_type"});events=ContractEvents.EVENTS.length;Element.insert(a,{top:new Element("option",{selected:"selected",value:""}).update(_("When the contract..."))});for(var b=0;b<events;b++){Element.insert(a,new Element("option",{value:ContractEvents.EVENTS[b]}).update(ContractEvents.EVENTS_COPY[ContractEvents.EVENTS[b]]))}Event.observe(a,"change",ContractEvents.build_actions_select);return a},build_details_form:function(a){return ContractEvents.FORM[a]},add_details_form:function(e){var g=Event.element(e).up("tr").down(".event_details");var f=Event.element(e).up("tr").down(".event_actions select").value;Element.update(g,ContractEvents.build_details_form(f));var d=ContractEvents.FORM[f]==undefined?false:true;if(d){var a=new Element("div",{"class":"inputs sendbutton"});var b=new Element("input",{type:"button",value:_("Save")});Event.observe(b,"click",ContractEvents.save_event);Element.insert(a,b);b=new Element("input",{type:"button",value:_("Cancel")});Event.observe(b,"click",ContractEvents.remove_event);Element.insert(a,b);Element.insert(g,{bottom:new Element("div",{"class":"grilla"}).update(a)})}Event.stop(e)},build_actions_select:function(d){var g=Event.element(d).value;var f=Event.element(d).up("tr").down(".event_actions");var a=new Element("select",{"class":"contract_events_action_select",name:"action"});actions=ContractEvents.EVENT_ACTIONS[g].length;Element.insert(a,{top:new Element("option",{selected:"selected",value:""}).update(_("Perform this action..."))});var e;for(var b=0;b<actions;b++){e=ContractEvents.EVENT_ACTIONS[g][b];Element.insert(a,new Element("option",{value:e}).update(ContractEvents.ACTIONS_COPY[e]))}if(g==""){Event.element(d).up("tr").down(".event_actions select").value="";ContractEvents.add_details_form(d);Element.update(f,"")}else{Event.observe(a,"change",ContractEvents.add_details_form);Element.update(f,a)}Event.element(d).up("tr").down(".event_details").update("");Event.stop(d)},build_events_column:function(){var a=new Element("td",{"class":"firstrule"});Element.insert(a,ContractEvents.build_events_select());return a},build_actions_column:function(){var a=new Element("td",{"class":"secondrule"});Element.insert(a,ContractEvents.build_actions_select());return a},build_remove_column:function(){var a=new Element("td",{"class":"erase"});var b=new Element("a",{"class":"remove",href:"#"}).update(_("remove"));Event.observe(b,"click",ContractEvents.remove_event);Element.insert(a,b);return a},detailed_params:function(a){if(a.role){switch(a.role){case"E":a.role=_("Editor");break;case"A":a.role=_("Administrator");break;case"R":a.role=_("Reader")}}if(a.sign){a.sign=a.sign=="1"?_("Yes"):_("No")}if(a.visible){a.visible=a.visible=="1"?_("Yes"):_("No")}return a},save_event:function(b){var a=Event.element(b).up("tr");var d=Form.serialize(a,true);$$('#new_contract_event input[type="checkbox"]:not(:checked)').each(function(e){d[e.name]="0"});ContractEvents.add_saved_event(d);ContractEvents.remove_event(b);Event.stop(b)},add_saved_event:function(a){$("contract_events_config").show();var d=new Element("tr");var f=a.event_type;var e=a.action;var b=new Element("textarea",{name:"contract[workflow_events][]",style:"display:none;"}).update(Object.toJSON(a));Element.insert(d,ContractEvents.build_remove_column());Element.insert(d,new Element("td",{"class":"when"}).update(new Element("span").update(ContractEvents.EVENTS_COPY[f])));Element.insert(d,new Element("td",{"class":"dothis"}).update(new Element("span").update(ContractEvents.ACTIONS_COPY[e])));Element.insert(d,new Element("td",{"class":"event_details desc"}).update(b).insert(new Template(ContractEvents.DETAILS[e]).evaluate(ContractEvents.detailed_params(a))));Element.insert($("contract_events"),d)},add_event:function(b){if(!$("new_contract_event")){var a=new Element("tr",{id:"new_contract_event"});Element.insert(a,ContractEvents.build_remove_column());Element.insert(a,ContractEvents.build_events_column());Element.insert(a,new Element("td",{"class":"event_actions dothis"}));Element.insert(a,new Element("td",{"class":"event_details desc"}));Element.insert($("contract_events"),a);$("contract_events_config").show()}Event.stop(b)},remove_event:function(a){Event.element(a).up("tr").remove();if($$("#contract_events_config tr").length==0){$("contract_events_config").hide()}Event.stop(a)},bind_events:function(){Event.observe("add_contract_event","click",ContractEvents.add_event)}};ContractDocumentations={DOCUMENTATIONS:["doc_id","doc_payroll","doc_appraisal"],DOCUMENTATIONS_COPY:{doc_id:_("ID"),doc_payroll:_("Payroll"),doc_appraisal:_("Appraisal")},DOCUMENTATION_ACTIONS:{doc_id:"verify_doc_id",doc_payroll:"verify_doc_payroll",doc_appraisal:"verify_doc_appraisal"},ACTIONS_COPY:{verify_doc_id:"",verify_doc_payroll:"",verify_doc_appraisal:""},FORM:{verify_doc_id:'<div class="grilla"><div class="inputs"><textarea rows="4" cols="35" name="required_verification_note" placeholder="'+_("i.e. I want Tractis to verify that the name on the ID matches the name on the contract")+'"></textarea></div></div>',verify_doc_payroll:'<div class="grilla"><div class="inputs"><textarea rows="4" cols="35"  name="required_verification_note" placeholder="'+_("i.e. I want Tractis to verify that the date on the payroll is no more than a month old")+'"></textarea></div></div>',verify_doc_appraisal:'<div class="grilla"><div class="inputs"><textarea rows="4" cols="35"  name="required_verification_note" placeholder="'+_("i.e. I want Tractis to verify that the total valuation on the appraisal matches the one on the contract")+'"></textarea></div></div>'},DETAILS:{verify_doc_id:_("<strong>Verification:</strong> #{verification}"),verify_doc_appraisal:_("<strong>Verification:</strong> #{verification}"),verify_doc_payroll:_("<strong>Verification:</strong> #{verification}")},build_select:function(b,e,f){var a=new Element("select",{"class":b,name:e});documentations=f.length;for(var d=0;d<documentations;d++){Element.insert(a,new Element("option",{value:f[d].type}).update(f[d].text))}return a},build_documentations_select:function(){var a=new Element("select",{"class":"contract_documentations_select",id:"contract_documentations_select",name:"required_documentation_type"});documentations=ContractDocumentations.DOCUMENTATIONS.length;Element.insert(a,{top:new Element("option",{selected:"selected",value:""}).update(_("Choose"))});for(var b=0;b<documentations;b++){Element.insert(a,new Element("option",{value:ContractDocumentations.DOCUMENTATIONS[b]}).update(ContractDocumentations.DOCUMENTATIONS_COPY[ContractDocumentations.DOCUMENTATIONS[b]]))}Event.observe(a,"change",ContractDocumentations.build_actions_checkbox);return a},build_details_form:function(a){return ContractDocumentations.FORM[a]},add_details_form:function(b){var f=Event.element(b).up("tr").down(".documentation_details");var e=Event.element(b).up("tr").down(".documentation_actions input");var d=Event.element(b).up("tr").down(".documentation_actions input").value;if(e.checked){Element.update(f,ContractDocumentations.build_details_form(d));var a=ContractDocumentations.FORM[d]==undefined?false:true}else{Element.update(f,"")}},build_actions_checkbox:function(e){var d=Event.element(e).value;var g=Event.element(e).up("tr").down(".documentation_actions");action=ContractDocumentations.DOCUMENTATION_ACTIONS[d];action_copy=ContractDocumentations.ACTIONS_COPY[action];var f=new Element("input",{type:"checkbox","class":"contract_documentations_verification_checkbox",id:"contract_documentations_verification_checkbox",name:"required_verification",value:action});var b=new Element("label",{"class":"contract_documentations_verification_label","for":"contract_documentations_verification_checkbox"}).update(action_copy);var a=new Element("div",{"class":"inputs actions_checkbox"});Element.insert(a,b);Element.insert(a,f);Event.observe(f,"click",ContractDocumentations.add_details_form);Element.update(g,a);Event.element(e).up("tr").down(".documentation_details").update("");Event.stop(e)},build_documentations_column:function(){var a=new Element("td",{"class":"firstrule"});Element.insert(a,ContractDocumentations.build_documentations_select());return a},build_actions_column:function(){var a=new Element("td",{"class":"secondrule"});Element.insert(a,ContractDocumentations.build_actions_checkbox());return a},build_hash_column:function(){var b=guid();var a=new Element("input",{type:"hidden",name:"required_documentation_hash",value:b});return a},build_usernote_column:function(){var e=new Element("td",{"class":"firstrule"});var b=new Element("textarea",{name:"required_documentation_note","class":"contract_documentations_usernote",rows:"2",cols:"35",placeholder:_("Write here the document description you want the user to see")});Element.insert(e,b);var a=new Element("div",{"class":"inputs sendbutton"});var d=new Element("input",{type:"button",value:_("Save")});Event.observe(d,"click",ContractDocumentations.save_documentation);Element.insert(a,d);d=new Element("input",{type:"button",value:_("Cancel")});Event.observe(d,"click",ContractDocumentations.remove_documentation);Element.insert(a,d);Element.insert(e,{bottom:new Element("div",{"class":"grilla"}).update(a)});return e},build_remove_column:function(){var a=new Element("td",{"class":"erase"});var b=new Element("a",{"class":"remove",href:"#"}).update(_("remove"));Event.observe(b,"click",ContractDocumentations.remove_documentation);Element.insert(a,b);return a},save_documentation:function(b){var a=Event.element(b).up("tr");var d=Form.serialize(a,true);$$('#new_contract_documentation input[type="checkbox"]:not(:checked)').each(function(e){d[e.name]="0"});ContractDocumentations.add_saved_documentation(d);ContractDocumentations.remove_documentation(b);Event.stop(b)},add_saved_documentation:function(h){$("contract_documentations_config").show();var e=new Element("tr");var f=h.required_documentation_type;var g=h.required_documentation_note;var d=h.required_verification;var b=h.required_verification_note;var a=new Element("textarea",{name:"contract[required_documentation][]",style:"display:none;"}).update(Object.toJSON(h));Element.insert(e,ContractDocumentations.build_remove_column());Element.insert(e,new Element("td",{"class":"when"}).update(new Element("span").update(ContractDocumentations.DOCUMENTATIONS_COPY[f])));Element.insert(e,new Element("td",{"class":"usernote"}).update(new Element("span").update(g)));if(d==="0"){Element.insert(e,new Element("td",{"class":"dothis"}).update(new Element("span").update(_("No"))));Element.insert(e,new Element("td",{"class":"documentation_details desc"}).update(a))}else{Element.insert(e,new Element("td",{"class":"dothis"}).update(new Element("span").update(_("Yes"))));Element.insert(e,new Element("td",{"class":"documentation_details desc"}).update(a).insert(b))}Element.insert($("contract_documentations"),e)},add_documentation:function(b){if(!$("new_contract_documentation")){var a=new Element("tr",{id:"new_contract_documentation"});Element.insert(a,ContractDocumentations.build_remove_column());Element.insert(a,ContractDocumentations.build_documentations_column());Element.insert(a,ContractDocumentations.build_usernote_column());Element.insert(a,ContractDocumentations.build_hash_column());Element.insert(a,new Element("td",{"class":"documentation_actions dothis"}));Element.insert(a,new Element("td",{"class":"documentation_details desc"}));Element.insert($("contract_documentations"),a);$("contract_documentations_config").show()}Event.stop(b)},remove_documentation:function(a){Event.element(a).up("tr").remove();if($$("#contract_documentations_config tr").length==0){$("contract_documentations_config").hide()}Event.stop(a)},bind_documentations:function(){Event.observe("add_contract_documentation","click",ContractDocumentations.add_documentation)}};function lb_confirm(b,d){modal.display('\n<div id="modalwindowtitle" class="ok">\n  <h3>'+_("Confirm your action")+'</h3>\n  <a href="#" href="#" class="lbAction close" rel="deactivate" title="Close this window"></a>\n  <div class="clear"></div>\n</div>\n<div id="modalcontent">\n  <p>'+b+'</p>\n</div>\n<div id="modalfooter" class="active">\n  <div id="leftbuttons"><a href="#" class="lbAction" rel="deactivate"><button>'+_("Cancel")+'</button></a></div><div id="rightbuttons">\n    <input name="commit" type="button" onclick="'+d+'" value="'+_("Ok")+'" />\n  </div>\n  <div class="clear"></div>\n</div>');var a=$$("#rightbuttons input").first();Event.observe(a,"click",d)}function tractis_ajax(a,b){new Ajax.Request(a,{asynchronous:true,evalScripts:true,method:"get",onSuccess:function(f){var e=$(b);var d=f.responseText;Element.replace(e,d)}});return false}function tractis_update(a,b){$(a).update(b)}function tractis_ajax_link(a,b){new Ajax.Request(a,{asynchronous:true,evalScripts:true,method:"get",onSuccess:function(d){if(b==true){window.location.reload()}}});return false}function createCookie(d,e,f){if(f){var b=new Date();b.setTime(b.getTime()+(f*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=d+"="+e+a+"; path=/"}function clickclear(b,a){if(b.value==a){b.value=""}}function clickrecall(b,a){if(b.value==""){b.value=a}}document.observe("dom:loaded",function(){$$(".info_attr_tooltip").each(function(a){new Tooltip(a,{backgroundColor:"#333",mouseFollow:false,borderColor:"#333",textColor:"#FFF",textShadowColor:"#000",opacity:"1"})})});function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function guid(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}function send_pin(a,d,b){a=a+"?pin_to="+document.getElementById("pin_to").value;a=a+"&pin_to_country="+document.getElementById("pin_to_country").value;new Ajax.Request(a,{asynchronous:true,evalScripts:true,method:"post"})}var Cookie={set:function(e,f,b){var a="";if(b!=undefined){var g=new Date();g.setTime(g.getTime()+(86400000*parseFloat(b)));a="; expires="+g.toGMTString()}return(document.cookie=escape(e)+"="+escape(f||"")+a)},get:function(a){var b=document.cookie.match(new RegExp("(^|;)\\s*"+escape(a)+"=([^;\\s]*)"));return(b?unescape(b[2]):null)},erase:function(a){var b=Cookie.get(a)||true;Cookie.set(a,"",-1);return b},accept:function(){if(typeof navigator.cookieEnabled=="boolean"){return navigator.cookieEnabled}Cookie.set("_test","1");return(Cookie.erase("_test")=="1")}};function toggleLocalMenu(d){var l=$("local-menu-button-"+d);var m=$("local-menu-title-"+d);var b=$("local-menu-container-"+d);var j=$("local-menu-content-"+d);var e=$("local-menu-"+d);var k=l["neg:inactiveText"]||l.getAttribute("neg:inactiveText");var f=l.getAttribute("neg:active");var a=l.getAttribute("neg:contentFromURL");l["neg:save"]=l["neg:save"]||l.getAttribute("neg:save");if((l["neg:active"]==undefined||l["neg:active"]=="true")&&(f&&f=="true")){l["neg:active"]=true}else{if((l["neg:active"]==undefined||l["neg:active"]=="false")&&(f&&f=="false")){l["neg:active"]=false}}if(!k){l["neg:inactiveText"]=l.innerHTML;l.setAttribute("neg:inactiveText",l.innerHTML);k=l.innerHTML}var g=l["neg:activeText"]||l.getAttribute("neg:activeText");if(!g){l["neg:activeText"]=l.innerHTML;l.setAttribute("neg:activeText",l.innerHTML);g=l.innerHTML}if(l["neg:active"]){hideElement(b,{afterFinish:function(){Element.removeClassName(e,"open");Element.addClassName(e,"collapsed");l.update(k);m.update(k);if($("editor")){TractisEditor.setToolbarPosition()}}});l["neg:active"]=false;if(l["neg:save"]){Cookie.set("local-menu-open-"+d,"false","10000")}}else{var h=function(){m.update(g);showElement(b,{framedElement:e,afterFinish:function(){l.update(g);if($("editor")){TractisEditor.setToolbarPosition()}}});Element.removeClassName(e,"collapsed");Element.addClassName(e,"open");l["neg:active"]=true;if(l["neg:save"]){Cookie.set("local-menu-open-"+d,"true","10000")}};if(a){new Ajax.Updater(j,a,{method:"get",onSuccess:h.bind(this)})}else{h()}}return false}var detect=navigator.userAgent.toLowerCase();var OS,browser,version,total,thestring;function getBrowserInfo(){if(checkIt("konqueror")){browser="Konqueror";OS="Linux"}else{if(checkIt("safari")){browser="Safari"}else{if(checkIt("omniweb")){browser="OmniWeb"}else{if(checkIt("opera")){browser="Opera"}else{if(checkIt("webtv")){browser="WebTV"}else{if(checkIt("icab")){browser="iCab"}else{if(checkIt("msie")){browser="Internet Explorer"}else{if(!checkIt("compatible")){browser="Netscape Navigator";version=detect.charAt(8)}else{browser="An unknown browser"}}}}}}}}if(!version){version=detect.charAt(place+thestring.length)}if(!OS){if(checkIt("linux")){OS="Linux"}else{if(checkIt("x11")){OS="Unix"}else{if(checkIt("mac")){OS="Mac"}else{if(checkIt("win")){OS="Windows"}else{OS="an unknown operating system"}}}}}return browser}function checkIt(a){place=detect.indexOf(a)+1;thestring=a;return place}Event.observe(window,"load",initialize,false);Event.observe(window,"load",getBrowserInfo,false);var lightbox=Class.create();lightbox.prototype={yPos:0,xPos:0,initialize:function(b,a){if(a){this.content=a}if(b){this.content=b.href;Event.observe(b,"click",this.activate.bindAsEventListener(this),false);b.onclick=function(){return false}}},activate:function(){if(browser=="Internet Explorer"){this.getScroll();this.prepareIE("100%","hidden");this.setScroll(0,0);this.hideSelects("hidden")}this.displayLightbox("block")},prepareIE:function(a,b){bod=document.getElementsByTagName("body")[0];bod.style.height=a;bod.style.overflow=b;htm=document.getElementsByTagName("html")[0];htm.style.height=a;htm.style.overflow=b},hideSelects:function(a){selects=document.getElementsByTagName("select");for(i=0;i<selects.length;i++){selects[i].style.visibility=a}},getScroll:function(){if(self.pageYOffset){this.yPos=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){this.yPos=document.documentElement.scrollTop}else{if(document.body){this.yPos=document.body.scrollTop}}}},setScroll:function(a,b){window.scrollTo(a,b)},displayLightbox:function(a){$("overlay").style.display=a;$("lightbox").style.display=a;if(a!="none"){this.loadInfo()}},loadInfo:function(){if(this.content!=null&&this.content.length>0){var a=new Ajax.Request(this.content,{method:"post",parameters:"",onComplete:this.processInfo.bindAsEventListener(this)})}},processInfo:function(a){info="<div id='lbContent'>"+a.responseText+"</div>";new Insertion.Before($("lbLoadMessage"),info);$("lightbox").className="done";this.actions()},display:function(b,a){if(!a){a=""}$$(".lbModalContent").each(function(e){Element.remove(e)});var d=new Element("div",{id:"lbContent"+a.capitalize(),"class":"lbModalContent"}).update(b);Element.insert($("lbLoadMessage"),{before:d});$("lightbox").className="done";this.actions();this.activate()},displayWhite:function(a){modal.display(a,"white")},actions:function(){lbActions=document.getElementsByClassName("lbAction");for(i=0;i<lbActions.length;i++){Event.observe(lbActions[i],"click",this[lbActions[i].rel].bindAsEventListener(this),false);lbActions[i].onclick=function(){return false}}},insert:function(b){link=Event.element(b).parentNode;Element.remove($("lbContent"));var a=new Ajax.Request(link.href,{method:"post",parameters:"",onComplete:this.processInfo.bindAsEventListener(this)})},deactivate:function(){if($("lightbox")&&$("lightbox").style.display!="none"){if($("lbContent")){Element.remove($("lbContent"))}if($("lbContentWhite")){Element.remove($("lbContentWhite"))}if(browser=="Internet Explorer"){this.setScroll(0,this.yPos);this.prepareIE("auto","auto");this.hideSelects("visible")}this.displayLightbox("none")}}};var modal;function initialize(){addLightboxMarkup();lbox=$$(".lbOn");for(i=0;i<lbox.length;i++){valid=new lightbox(lbox[i])}modal=new lightbox(null,null)}function addLightboxMarkup(){bod=document.getElementsByTagName("body")[0];overlay=document.createElement("div");overlay.id="overlay";lb=document.createElement("div");lb.id="lightbox";lb.className="loading";lb.innerHTML='<div id="lbLoadMessage"><p>Loading</p></div>';bod.appendChild(overlay);bod.appendChild(lb)}var Carousel=Class.create(Abstract,{initialize:function(a,e,b,d){this.scrolling=false;this.scroller=a;this.slides=e;this.controls=b;this.options=Object.extend({duration:1,frequency:3,controlClassName:"carousel-control",jumperClassName:"carousel-jumper",move:"scroll",hideSlides:false,selected:false},d||{});if(this.options.move=="fade"){this.options.hideSlides=true}this.slides.each(function(f,g){f._index=g;if(this.options.hideSlides){Element.hide(f)}}.bind(this));this.select(this.currentSlide());this.controls.invoke("observe","click",this.click.bind(this));if(this.options.auto){this.start()}},select:function(a){a=$(a);if(this.current!=a){this.current=a;if(this.options.hideSlides){Element.show(a)}else{var b=this.options.duration;this.options.duration=0;this.scroll();this.options.duration=b}if(this.options.selectedClassName){this.controls.each((function(d){d.removeClassName(this.options.selectedClassName)}).bind(this));$$('a[rel="'+this.currentSlide().id+'"]').each(function(d){d.addClassName(this.options.selectedClassName)}.bind(this))}}},defaultSlide:function(){var a=window.location.hash.gsub(/^#/,"");if(a.length==0&&this.options.selected){a=this.options.selected}if(a.length>0){a=this.slides.find(function(b){if(b.id==a){return true}else{return false}}.bind(this));if(a){return a}}return this.slides[0]},currentSlide:function(){return this.current?this.current:this.defaultSlide()},click:function(event){this.stop();if(this.scrolling){this.scrolling.cancel()}var element=event.findElement("a");if(element.hasClassName(this.options.controlClassName)){eval("this."+element.rel+"()")}else{if(element.hasClassName(this.options.jumperClassName)){this.moveTo(element,element.rel)}}event.stop()},moveTo:function(a,b){if(this.options.beforeMove&&(typeof this.options.beforeMove=="function")){this.options.beforeMove()}if(this.options.selectedClassName){this.controls.each((function(d){d.removeClassName(this.options.selectedClassName)}).bind(this));a.addClassName(this.options.selectedClassName)}this.previous=this.currentSlide();this.current=$(b);this.move(this.previous,this.current);if(this.options.afterMove&&(typeof this.options.afterMove=="function")){this.options.afterMove()}return false},move:function(a,b){if(this.options.move=="scroll"){this.scroll(a,b)}else{if(this.options.move=="fade"){this.fade(a,b)}else{this.options.move(a,b)}}},fade:function(a,b){if(this.previous!=this.current){new Effect.Fade(this.previous,{duration:this.options.duration,afterFinishInternal:function(d){Element.hide(this.previous);Element.show(this.current);new Effect.Appear(this.current,{duration:this.options.duration})}.bind(this)})}},scroll:function(b,e){var d=this.scroller.cumulativeOffset();var a=this.current.cumulativeOffset();this.scrolling=new Effect.SmoothScroll(this.scroller,{duration:this.options.duration,x:(a[0]-d[0]),y:(a[1]-d[1])})},prev:function(){if(this.current){var a=this.current._index;var b=(a==0)?this.slides.length-1:a-1}else{var b=this.slides.length-1}this.moveTo(this.controls[b],this.slides[b])},next:function(){if(this.current){var b=this.current._index;var a=(this.slides.length-1==b)?0:b+1}else{var a=1}this.moveTo(this.controls[a],this.slides[a])},first:function(){var b=0;if(this.current){var a=this.current._index}this.moveTo(this.controls[b],this.slides[b])},last:function(){var b=(this.slides.length-1);if(this.current){var a=this.current._index}this.moveTo(this.controls[b],this.slides[b])},toggle:function(){if(this.previous){this.moveTo(this.controls[this.previous._index],this.slides[this.previous._index])}else{return false}},stop:function(){clearTimeout(this.timer)},start:function(){this.periodicallyUpdate()},periodicallyUpdate:function(){if(this.timer!=null){clearTimeout(this.timer);this.next()}this.timer=setTimeout(this.periodicallyUpdate.bind(this),this.options.frequency*1000)}});Effect.SmoothScroll=Class.create();Object.extend(Object.extend(Effect.SmoothScroll.prototype,Effect.Base.prototype),{initialize:function(b){this.element=$(b);var a=Object.extend({x:0,y:0,mode:"absolute"},arguments[1]||{});this.start(a)},setup:function(){if(this.options.continuous&&!this.element._ext){this.element.cleanWhitespace();this.element._ext=true;this.element.appendChild(this.element.firstChild)}this.originalLeft=this.element.scrollLeft;this.originalTop=this.element.scrollTop;if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(a){this.element.scrollLeft=this.options.x*a+this.originalLeft;this.element.scrollTop=this.options.y*a+this.originalTop}});(function(s){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};s.parseJSON=function(filter){try{if(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(this)){var j=eval("("+this+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}walk("",j)}return j}}catch(e){}throw new SyntaxError("parseJSON")};s.toJSONString=function(){if(/["\\\x00-\x1f]/.test(this)){return'"'+this.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+this+'"'}})(String.prototype);_("The certificate doesn't belong to a supported CA");_("The certificate doesn't support digital signature");_("The certificate is out of date");_("This certificate doesn't contain a supported policy");_("Please, ensure that the device (Smart card or USB) is connected.");var SignatureComponentManager={intervalId:null,intervalRefresh:null,signing:false,file:null,filters:null,accepted_certs:null,selectedCert:null,loaded:null,startInterval:function(a){SignatureComponentManager.filters=a;SignatureComponentManager.loaded=false;SignatureController.activate_cert_list();SignatureComponentManager.intervalId=window.setInterval("SignatureComponentManager.waitApplet()",1000)},init_cert_manager:function(){CertificateManager.init(SignatureComponentManager.filters)},addCertificate:function(a){if(!AppletUtils.isFileUploadPathRecoverySupported()){if(AppletUtils.isFirefox3()&&a!=null){a=a.files.item(0).getAsDataURL().replace("data:application/octet-stream;base64,","")}else{a=null}}else{a=a.value}if(a!==null&&a.length>0&&!SignatureComponentManager.signing){SignatureComponentManager.file=a;SignatureComponentManager.loadCertificate("PKCS12",SignatureComponentManager.file,null)}else{SignatureComponentManager.loadCertificate("PKCS12",null,null)}},addCertificateWithPassword:function(a,b){if(!AppletUtils.isFileUploadPathRecoverySupported()){a=a.files.item(0).getAsDataURL().replace("data:application/octet-stream;base64,","")}else{a=a.value}if(a!==null&&a.length>0&&!SignatureComponentManager.signing){SignatureComponentManager.file=a;SignatureComponentManager.loadCertificate("PKCS12",SignatureComponentManager.file,b)}},addPasswordToCertAndRedirect:function(a){var b=SignatureComponentManager.getPassword();var d=SignatureComponentManager.file;SignatureComponentManager.loadCertificate("PKCS12",d,b)},loadCertificate:function(h,g,b){try{var f=CertificateManager.addCertificate(h,g,b);if(f){var d=new String(f).parseJSON().length;if(d==1){var a=new String(f).parseJSON()[0];SignatureComponentManager.proceedToSplash(a);return}}SignatureFlow.loadCertDialog()}catch(j){}},addPasswordToPKCS11AndRedirect:function(b){var a=CertificateManager.detectPKCS11Devices();if(a!==null){SignatureComponentManager.loadCertificate("PKCS11",a,b)}else{AppletUtils.renderError(_("No certificate drivers have been found on the system"))}},addPasswordToCert:function(){var a=SignatureComponentManager.getPassword();var b=CertificateManager.addCertificate(SignatureComponentManager.file,a);SignatureComponentManager.loadCertList()},loadCertList:function(){console.log("SignatureComponentManager.loadCertList ->"+$("signature_certs_list"));var a=CertificateManager.getCertificatesStored();console.log("SignatureComponentManager.loadCertList2 ->"+$("signature_certs_list"));SignatureComponentManager.loadCerts(a,CertificateManager.loadRejectedCerts());SignatureComponentManager.selectCertificate()},hidePassword:function(){SignatureController.hidePassword()},getPassword:function(){return SignatureController.getPassword()},sign:function(b){var f=new Date();var e=new Date(b);SignatureController.disableSignButtons();SignatureComponentManager.signing=true;var d=new String($("signature_city").value);if(d.match(/,/)){d=d.replace(/,/,"/")}var a=CertificateManager.sign(e,d,ListUtils.getSelectedOption($("signature_country")),_("Creating the signature"));SignatureComponentManager.signActionFinish(a)},signActionFinish:function(a){if(a!==null){if(a.status=="CANCELED"||a.status=="ERROR"){if(a.status=="ERROR"){Alerts.hide_spinner();AppletUtils.recoverConsoleContent("Sign action finished error");AppletUtils.renderError(_("We cannot create a signature."),[_("Please, ensure that the device (Smart card or USB) is connected.")])}else{AppletUtils.renderError(_("Signature has been canceled."),[_("No signature has been performed.")])}SignatureComponentManager.signCancel()}else{Alerts.show_spinner(_("Signature created"));SignatureComponentManager.signOk(a.result)}}},updateSelected:function(){var a=SignatureController.get_selected_cert();CertificateManager.selectCertificate(a);SignatureComponentManager.selectedCert=a},selectCertificate:function(){if(SignatureController.get_selected_cert()=="0"){if(SignatureController.getLoadedCertCount()>1){SignatureFlow.loadOtherCerts(false)}}else{SignatureComponentManager.updateSelected();SignatureController.updateCertificateInfo(SignatureComponentManager.selectedCert)}},loadCerts:function(b,a){if(b||a){SignatureController.showCerts(b,a)}else{SignatureFlow.loadOtherCerts(true)}},isOnlyOneCertAccepted:function(){var a=CertificateManager.getCertificatesStored();return(a&&new String(a).parseJSON().length==1)},waitApplet:function(){if(!SignatureComponentManager.loaded&&AppletUtils.isAppletLoaded()){SignatureComponentManager.initApplet();SignatureComponentManager.appletStarted();if(SignatureComponentManager.isOnlyOneCertAccepted()){var a=new String(CertificateManager.getCertificatesStored()).parseJSON()[0];SignatureComponentManager.proceedToSplash(a)}else{SignatureComponentManager.loadCertList()}SignatureComponentManager.intervalRefresh=window.setInterval("SignatureComponentManager.checkStatus()",3000)}},checkStatus:function(){clearInterval(SignatureComponentManager.intervalRefresh);var a=CertificateManager.statusChanged();if(a==true){if(SignatureComponentManager.isOnlyOneCertAccepted()){this.proceedToSplashNoPar()}else{SignatureFlow.loadCertDialog()}}SignatureComponentManager.intervalRefresh=window.setInterval("SignatureComponentManager.checkStatus()",1000)},proceedToSplashNoPar:function(){var a=new String(CertificateManager.getCertificatesStored()).parseJSON()[0];SignatureComponentManager.proceedToSplash(a)},appletStarted:function(){clearInterval(SignatureComponentManager.intervalId);SignatureComponentManager.loaded=true},getIssuerAndSubject:function(a){var d=new String(CertificateManager.getCertificateData(a.hash)).parseJSON();var f=SignatureController.getIssuer(d);var b=SignatureController.getSubject(d);var e=SignatureController.getQCStatements(d);return{issuer:f,subject:b,qcstatements:e}},proceedToSplash:function(a){SignatureComponentManager.selectedCert=a;CertificateManager.selectCertificate(a.hash);a=SignatureComponentManager.getIssuerAndSubject(a);SignatureFlow.loadFillData(a.issuer,a.subject,a.qcstatements)},initApplet:function(){var a;if(AppletUtils.getOperatingSystem()=="Windows"){a="1.6"}else{a="1.5"}var b=AppletUtils.getJavaVersion();if(parseFloat(b)<parseFloat(a)){error=true;AppletUtils.renderError(_("You need Java "+a+" to sign the document"));SignatureComponentManager.finish()}SignatureComponentManager.init_cert_manager()},rescueAppletNotLoaded:function(){SignatureComponentManager.renderError(_("Cannot load signature component, please ensure that you have Java 1.6 installed and working and retry again"));clearInterval(SignatureComponentManager.intervalId)},signOk:function(d){var b=CertificateManager.getAdditionalCertificates();var a=CertificateManager.getSignerCertificate();Alerts.show_spinner(_("Validating the signature"));params="signature="+escape(d)+"&contract="+$("contract_id").value;if(b!==null){params+="&additionalcertificates="+escape(b)}if(a!==null){params+="&signaturecertificate="+escape(a)}if($("editor")){TractisEditor.setSaved()}var e=new Ajax.Request("/signature/validate_sign",{method:"post",parameters:params})},signCancel:function(){clearInterval(SignatureComponentManager.intervalId);modal.deactivate()},finish:function(){SignatureComponentManager.signing=false;modal.deactivate()},saveRejectedCerts:function(){params="certs="+SignatureComponentManager.rejected_certs;var a=new Ajax.Request("/signature/save_rejected",{method:"post",parameters:params})}};var AppletUtils={getJavaVersion:function(){return document.signing_applet.getJavaVersion()},renderError:function(b,a){this.signing=false;Alerts.error(b,a)},renderWarning:function(b,a){this.signing=false;Alerts.warning(b,a)},isAppletLoaded:function(){try{document.signing_applet.getJavaVersion()}catch(a){return false}return true},getOperatingSystem:function(){var b="Unknown OS";var a=navigator.platform;if(a.indexOf("Win")!=-1){b="Windows"}if(a.indexOf("Mac")!=-1){b="MacOS"}if(a.indexOf("X11")!=-1){b="UNIX"}if(a.indexOf("Linux")!=-1){b="Linux"}return b},isFileUploadPathRecoverySupported:function(){return false},recoverConsoleContent:function(a){try{var b=document.signing_applet.getConsoleContent()+"";AppletUtils.sendMessage(a,b)}catch(d){}},sendMessage:function(a,b){var d=new Ajax.Request("/hq/send_stack",{method:"post",silent:true,parameters:{title:a,stack:b}})},isFirefox3:function(){var a=navigator.userAgent;return(/Firefox\/3/.test(a))}};var SignatureController={activate_cert_list:function(){$("signature_certs_list").style.visibility="visible"},show_pass_dialog:function(){new Effect.BlindDown("form_password",{afterFinish:function(a){if($("cert_password")!=null){$("cert_password").focus()}}})},clear_cert_list:function(){this.clearList($("signature_certs_list"))},hidePassword:function(){new Effect.BlindUp("form_password")},getPassword:function(){passwd=$("cert_password").value;new Effect.BlindUp("form_password");$("cert_password").value="";return passwd},disableSignButtons:function(){$("sign_submit").disabled=true;$("sign_cancel").disabled=true},get_selected_cert:function(){return ListUtils.getSelectedOption($("signature_certs_list"))},getLoadedCertCount:function(){return ListUtils.getSize($("signature_certs_list"))},showCerts:function(j,g){if(this.getLoadedCertCount()>0){ListUtils.removeLastOption($("signature_certs_list"))}console.log("sig-controller -> showCerts");$("signature_certs_list").innerHTML="";if(j){var d=new String(j).parseJSON();var b=null;if(d&&d.length>0){b=this.enableAcceptedList($("signature_certs_list"));for(i=0;i<d.length;i++){this.addCertificateToList(b,d[i])}}}if(g){try{var f=new String(g).parseJSON()}catch(h){}var a=null;if(f&&f.length>0){a=this.enableRejectedList($("signature_certs_list"));for(i=0;i<f.length;i++){this.addCertificateToList(a,f[i])}}}ListUtils.addOptionObj($("signature_certs_list"),this.getOtherCertOption());this.displayCertificateCombo();this.markSelected();SignatureComponentManager.selectCertificate()},commitmentClicked:function(){if($("signature_commitment").checked){this.activateSign()}else{this.deactivateSign()}},commitmentAndTermsClicked:function(){if($("signature_commitment").checked&&$("signature_terms_of_service").checked){this.activateSign()}else{this.deactivateSign()}},activateSign:function(){$("sign_submit").className="ok"},deactivateSign:function(){$("sign_submit").className=""},markSelected:function(){ListUtils.selectOption($("signature_certs_list"),SignatureComponentManager.selectedCert)},getSubject:function(a){return a.cn},getIssuer:function(a){return a.ca},getQCStatements:function(a){var b=a.qcstatements;return b==null||b==""?null:Object.toJSON(b)},updateCertificateInfo:function(a){var f=new String(CertificateManager.getCertificateData(a)).parseJSON();if(f===null){this.deactivateCertificateDetails();return}var b=this.getIssuer(f);var d=this.getSubject(f);var e=this.getQCStatements(f);var g=null;if(f.rejectedReasons){g=f.rejectedReasons}$("issuer").firstChild.nodeValue=b;$("subject").firstChild.nodeValue=d;this.setQCstatements(e);if(g!==null){this.activateRejectedData(f,g)}else{this.deactivateRejectedData()}this.activateCertificateDetails()},activateRejectedData:function(a,b){$("details").className="divError";$("issuer_row").style.display="none";$("subject_row").style.display="none";$("cause_holder").style.display="";$("selected_encoded").value=a.encoded;$("cause").innerHTML=_(b.value);$("submit_rejected").style.display="none";SignatureFlow.submitCertificate(a.encoded,"submit_rejected");this.disableNextStep();this.setCertificateData()},deactivateRejectedData:function(){$("selected_encoded").value=null;$("details").className="divEmisor";$("cause_holder").style.display="none";$("submit_rejected").style.display="none";$("issuer_row").style.display="";$("subject_row").style.display="";this.enableNextStep();this.setCertificateData()},activateCertificateDetails:function(){$("certificate_details").style.display=""},deactivateCertificateDetails:function(){$("certificate_details").style.display="none"},displayCertificateCombo:function(){$("selectFromCombo").style.display="";$("next_button").style.display="";this.disableSpinner()},enableAcceptedList:function(b){var a=_("You can use these certificates");var d="accepted";return this.recoverLabel(b,a,d)},enableRejectedList:function(b){var a=_("You cannot use these certificates");var d="rejected";return this.recoverLabel(b,a,d)},recoverLabel:function(b,a,e){var d=this.addGroup(a,e);b.appendChild(d);return d},addGroup:function(a,b){group=document.createElement("optgroup");group.setAttribute("label",a);group.setAttribute("id",b);return group},disableSpinner:function(){$("detecting_certificates").style.display="none";$("certificates_found").style.display=""},addCertificateToList:function(b,a){ListUtils.addOption(b,a.cn+", "+a.ca,a.hash);if(a.selected!=null&&a.selected=="true"){SignatureComponentManager.selectedCert=a.hash}},setCertificateData:function(){$("selected_issuer").setValue($("issuer").firstChild.nodeValue);$("selected_subject").setValue($("subject").firstChild.nodeValue)},setQCstatements:function(a){$("selected_qcstatements").setValue(a)},isAcceptedCertificateSelected:function(){if($("selected_accepted").value!==null&&$("selected_accepted").value==="true"){return true}else{return false}},enableNextStep:function(){$("next_button_input").className="ok";$("selected_accepted").value=true},disableNextStep:function(){$("next_button_input").className="";$("selected_accepted").value=null},getOtherCertOption:function(){newOption=document.createElement("option");newOption.appendChild(document.createTextNode(_("Select other certificate")));newOption.setAttribute("value",0);Event.observe(newOption,"click",SignatureComponentManager.selectCertificate,true);return newOption},displayMediaData:function(){var e=$("modalalert");var d=CertificateManager.readerPresent();if(!d){e.innerHTML=_("No card reader present")}else{var b="<p>Reader found : "+CertificateManager.getReaderName()+"<p>";var a=CertificateManager.cardPresent();if(!a){b=b+"<p>No card found<p>"}else{b=b+"<p>Card Found : "+CertificateManager.getCardAttrIdentifier()+"<p>"}e.innerHTML=b}}};var SignatureFlow={loadOtherCerts:function(a){var d="step[next]=select_media&contract[id]="+$("contract_id").value;if(a){d=d+"&no_cert_detected="+a}var b=new Ajax.Request("/signature/next",{method:"post",parameters:d})},changeCertificate:function(){this.loadCertDialog()},loadCertDialog:function(){var b="step[next]=certificate_dialog&contract[id]="+$("contract_id").value+"&load_cert=true&select_cert=true";var a=new Ajax.Request("/signature/next",{method:"post",parameters:b})},loadPKCS12Dialog:function(){var b="step[next]=load_pkcs12&contract[id]="+$("contract_id").value;var a=new Ajax.Request("/signature/next",{method:"post",parameters:b})},loadPKCS11Dialog:function(){var e=CertificateManager.readerPresent();var d=e&&CertificateManager.cardPresent();var b=d&&CertificateManager.getCardAPDUsSupported();var f=$("contract_id").value==""?{}:{"contract[id]":$("contract_id").value};f.certificate_count=CertificateManager.getCertificateCount();f.card_present=d;f.reader_connected=e;f.card_apdus_supported=b;if(CertificateManager.detectPKCS11Devices()){f["step[next]"]="load_pkcs11";var a=new Ajax.Request("/signature/next",{method:"post",parameters:f})}else{f["step[next]"]="certificate_not_found";var a=new Ajax.Request("/signature/next",{method:"post",parameters:f})}},proceedToFillData:function(){if(SignatureController.isAcceptedCertificateSelected()){this.loadFillData($("selected_issuer").value,$("selected_subject").value,$("selected_qcstatements").value)}else{var a="Trying to use a non-accepted certificate";var b="Issued by "+$("selected_issuer").value+" Subject is "+$("selected_subject").value+" Certificate is "+$("selected_encoded").value;AppletUtils.sendMessage(a,b);AppletUtils.renderError(_("This is a non-accepted certificate."),[_("Please, select an accepted certificate to sign the contract.")])}},loadFillData:function(d,b,e){var f="step[next]=fill_data&contract[id]="+$("contract_id").value+"&selected[issuer]="+d+"&selected[subject]="+b+"&selected[qcstatements]="+e;var a=new Ajax.Request("/signature/next",{method:"post",parameters:f})},submitCertificate:function(b){var d="certificate="+b+"&check=true;";if($("rejected_cert").firstChild!=null){$("rejected_cert").removeChild($("rejected_cert").firstChild)}var a=new Ajax.Updater("rejected_cert","/signature/store_rejected",{method:"post",parameters:d});$("submit_rejected").style.display=""}};var CertificateManager={filters:null,init:function(h){this.filters=h;document.signing_applet.init();var b=document.signing_applet.isInitFailed();if(!b){if(this.filters){var d=new String(this.filters).evalJSON();if(d.allowed_cas!=null&&d.supported_cas!=null){var j="{type: CAAllowedFilter, parameters: {cas: "+Object.toJSON(d.allowed_cas)+"}}";var g="{type: CAFilter, parameters: {cas: "+Object.toJSON(d.supported_cas)+"}}";document.signing_applet.registerFilter(g);document.signing_applet.registerFilter(j)}else{if(d.cas!=null&&d.cas!="{}"){alert(d.cas);var g="{type: CAFilter, parameters:"+Object.toJSON(d.cas)+"}";document.signing_applet.registerFilter(g)}}if(d.allowed_policies!=null&&d.supported_policies!=null){var f="{type: PolicyAllowedFilter, parameters: {policies: "+Object.toJSON(d.allowed_policies)+"}}";var e="{type: PolicyFilter, parameters: {policies:"+Object.toJSON(d.supported_policies)+"}}";document.signing_applet.registerFilter(e);document.signing_applet.registerFilter(f)}else{var a="{type: PolicyFilter, parameters:"+Object.toJSON(d.policies)+"}";document.signing_applet.registerFilter(a)}}document.signing_applet.initBootStrapKeystores()}else{SignatureComponentManager.signCancel();AppletUtils.renderError(_("We were unable to initialize the signature service on your computer. "),[_("Please, try to sign again and, if the problem persists, contact us.")])}},statusChanged:function(){return document.signing_applet.statusChanged()},addCertificate:function(d,f,a){var e;if(!AppletUtils.isFileUploadPathRecoverySupported()&&f&&f.indexOf(".so")<0){e=(a==null?{type:d,stream:f}:{type:d,stream:f,password:a})}else{if(f){e=(a==null?{type:d,file:f}:{type:d,file:f,password:a})}else{e=(a==null?{type:d}:{type:d,password:a})}}var g=Object.toJSON(e);var b=document.signing_applet.addCertificates(g);if(b!==null){c=new String(b).evalJSON();if(c.status=="ERROR"||c.status=="INVALID_INPUT"){if(c.status=="ERROR"){AppletUtils.recoverConsoleContent("Add a new certificate error")}AppletUtils.renderError(_("We were unable to access the certificate."),[_("Please, ensure that you have selected the right and that the password is correct.")]);throw _("An error has happened with this file "+c.result)}else{if(c.status=="MESSAGE"){AppletUtils.renderWarning(c.status)}}return Object.toJSON(c.result)}else{return null}},getSelectedCertificate:function(){var b=document.signing_applet.getSignerCertificate();if(b!=null){var a=document.signing_applet.getSignerCertificate();a=CertificateManager.unwrapResult(a);return new String(a).parseJSON()}else{return null}},getCertificatesStored:function(){Alerts.show_spinner();var a=document.signing_applet.getAcceptedCertificates();if(a!==""){Alerts.hide_spinner();return CertificateManager.unwrapResult(a)}else{Alerts.hide_spinner();return null}},detectPKCS11Devices:function(){var b=AppletUtils.getOperatingSystem();if(b!="Windows"){var a;if(b=="Linux"||b=="UNIX"){a="/usr/lib/opensc-pkcs11.so"}else{if(b=="MacOS"){a="/Library/Libpkcs11-fnmtdnie/lib/libpkcs11-fnmtdnie.so"}else{a=null}}try{if(a!==null&&document.signing_applet.existsLibrary(a)){return a}else{AppletUtils.renderError(_("Cannot find signature device drivers, they where expected to be found at ")+a)}}catch(d){AppletUtils.renderError(_("An error raised detecting signature device drivers, please try again and if the error persist contact your certificate provider"))}}return null},authenticate:function(b,e){var d={SigningTime:b.toString()};var f=Object.toJSON(d);Alerts.show_spinner(_(e));var a=document.signing_applet.authenticate(f);return new String(a).evalJSON()},sign:function(b,h,g,e){var d={SigningTime:b.toString(),CommitmentTypeIndication:"http://www.tractis.com/commitments#signContract",SignatureProductionPlace:h+",*,*,"+g};Alerts.show_spinner(_(e));var f=Object.toJSON(d);var a=document.signing_applet.sign(f,null);return new String(a).evalJSON()},getAdditionalCertificates:function(){var a=document.signing_applet.getAdditionalCertificates();return CertificateManager.unwrapResult(a)},getSignerCertificate:function(){var e=document.signing_applet.getSignerCertificate();var b=CertificateManager.unwrapResult(e);var a=new String(b).evalJSON();var d=a.encoded;if(d===undefined||d.length===0){return null}else{return d}},selectCertificate:function(a){document.signing_applet.changeSignerCertificate(a)},getCertificateData:function(a){return CertificateManager.unwrapResult(document.signing_applet.getCertificateData(a))},loadRejectedCerts:function(){var a=document.signing_applet.getRejectedCertificates();return CertificateManager.unwrapResult(a)},unwrapResult:function(a){var d=new String(a).evalJSON();if(d.status=="OK"){if(d.result.length===0){return null}else{var a=Object.toJSON(d.result);return a}}else{var b="Error raised!";Alerts.show_error(_(b));throw b}},getCertificateCount:function(){return document.signing_applet.getCertificateCount()},getCardAPDUsSupported:function(){var a=document.signing_applet.getCardAPDUsSupported();return new String(a)=="true"},getReaderName:function(){return document.signing_applet.getReaderName()},readerPresent:function(){var a=document.signing_applet.readerPresent();return new String(a)=="true"},getCardAttrIdentifier:function(){return document.signing_applet.getCardAttrIdentifier()},cardPresent:function(){var a=document.signing_applet.cardPresent();return new String(a)=="true"}};var signatures={waiting:false,afterFinish:function(a){this.waiting=false;if(a){link=$("signatures-link");link["neg:inactiveText"]=a}},show:function(){showElement("signatures-container-id");this.waiting=false},hide:function(){hideElement("signatures-container-id",this)},request:function(a){new Ajax.Request(a,{asynchronous:true,evalScripts:true,method:"get",onSuccess:function(b){signatures.show()}});return false},toggle:function(a){if(this.waiting==false){this.waiting=true;toggleLink("signatures-link");Element.visible("signatures-container-id")?this.hide():(a?this.request(a):this.show())}}};var acceptations={waiting:false,afterFinish:function(a){this.waiting=false;if(a){link=$("acceptations-link");link["neg:inactiveText"]=a}},show:function(){showElement("acceptations-container-id");this.waiting=false},hide:function(){hideElement("acceptations-container-id",this)},toggle:function(a){if(this.waiting==false){this.waiting=true;toggleLink("acceptations-link");Element.visible("acceptations-container-id")?this.hide():this.show()}}};var negotiationParts={show:function(a){showElement("part-module-contents["+a+"]")},hide:function(a){hideElement("part-module-contents["+a+"]")},toggle:function(a){toggleLink("togglePartLink["+a+"]");Element.visible("part-module-contents["+a+"]")?this.hide(a):this.show(a)}};var negotiationInvitation={show:function(a){showElement("invitePeople["+a+"]",{afterFinish:function(){$("inputInvitePeople_"+a).focus()}});Element.addClassName("menus","links-lock")},hide:function(a){hideElement("invitePeople["+a+"]",{afterFinish:function(){Element.removeClassName("menus","links-lock");$("inputInvitePeople_"+a).value=""}})},submit:function(a){Element.removeClassName("menus","links-lock")},toggle:function(a){Element.visible("invitePeople["+a+"]")?this.hide(a):this.show(a)}};var negotiationInvitationTable={show:function(a){showElement("invitePeopleTable["+a+"]",{afterFinish:function(){$("inputInvitePeopleTable["+a+"]").focus()}});Element.addClassName("menus","links-lock");Element.hide("invitePeopleTableLink")},hide:function(a){hideElement("invitePeopleTable["+a+"]",{afterFinish:function(){Element.show("invitePeopleTableLink");Element.removeClassName("menus","links-lock")}})},submit:function(a){hideElement("invitePeopleTable["+a+"]");Element.removeClassName("menus","links-lock")},toggle:function(a){Element.visible("invitePeopleTable["+a+"]")?this.hide(a):this.show(a)}};var partInvitation={show:function(){showElement("invitePart",{afterFinish:function(){$("team_member_email").focus()}});hideElement("invitePartText");Element.addClassName("menus","links-lock")},hide:function(){hideElement("invitePart",{afterFinish:function(){showElement("invitePartText");$("team_member_email").value="";Element.removeClassName("menus","links-lock")}})},submit:function(){hideElement("invitePart");Element.removeClassName("menus","links-lock")},toggle:function(){Element.visible("invitePart")?this.hide():this.show()}};var editParticipant={show:function(a){Element.addClassName("menus","links-lock");hideElement("participant-module["+a+"]",{afterFinish:function(){showElement("editParticipant_"+a)}})},hide:function(a){hideElement("editParticipant_"+a,{afterFinish:function(){showElement("participant-module["+a+"]");Element.removeClassName("menus","links-lock")}})},submit:function(a){hideElement("editParticipant_"+a+"");Element.removeClassName("menus","links-lock")},visible:function(a){visible=$$("div#editParticipant_"+a+" label.visible input").first();signer=$$("div#editParticipant_"+a+" label.sign input").first();if(visible.checked){Element.removeClassName("editParticipant_"+a,"invisible");Element.addClassName("editParticipant_"+a,"visible")}else{visible.checked=false;signer.checked=false;Element.removeClassName("editParticipant_"+a,"visible");Element.addClassName("editParticipant_"+a,"invisible")}},toggle:function(a){toggleLink("editParticipantLink["+a+"]");Element.visible("editParticipant_"+a)?this.hide(a):this.show(a)}};var removeParticipant={show:function(a){Element.addClassName("menus","links-lock");hideElement("participant-module["+a+"]",{afterFinish:function(){showElement("removeParticipant["+a+"]")}})},hide:function(a){hideElement("removeParticipant["+a+"]",{afterFinish:function(){showElement("participant-module["+a+"]");Element.removeClassName("menus","links-lock")}})},submit:function(a){hideElement("removeParticipant["+a+"]");Element.removeClassName("menus","links-lock")},toggle:function(a){toggleLink("removeParticipantLink["+a+"]");Element.visible("removeParticipant["+a+"]")?this.hide(a):this.show(a)}};var versions={show:function(){showElement("older-versions-module")},hide:function(a){hideElement("older-versions-module")},toggle:function(a){toggleLink("olderVersionsLink");Element.visible("older-versions-module")?this.hide():this.show()},getSelected:function(){var b=new Array();var d=$$("#local-menu-versions input[type=checkbox]");for(var a=0;a<d.length;a++){if(d[a].checked){b.push(d[a])}}return b},checked:function(d){var b=this.getSelected();if(b.length>2){for(var a=0;a<b.length;a++){if(d!=b[a]){b[a].checked=false}}}this.testCompareButton()},testCompareButton:function(){$("compare_button").disabled=(this.getSelected().length!=2)},submit:function(a){var b=this.getSelected();if(b.length!=2){return null}else{document.location=a.replace(/v1/,b[0].value).replace(/v2/,b[1].value)}}};var mailform={show:function(){showElement("mail-form-id");Element.hide("mail-form-buttons")},hide:function(){hideElement("mail-form-id");Element.show("mail-form-buttons")},toggle:function(a){toggleLink("mail-form-link");Element.visible("mail-form-id")?this.hide():this.show()}};var CommentNotifications={show:function(){if($("comments_notifications").style.display=="none"){showElement("comments_notifications")}else{hideElement("comments_notifications")}},showParticipants:function(a){if(a.value=="all"&&a.checked==true){hideElement("notifications_specifics")}else{if(a.value=="specifics"&&a.checked==true){showElement("notifications_specifics")}}},hideParticipants:function(){hideElement("notifications_specifics")}};function setSelectionRange(b,d,e){if(b.setSelectionRange){b.focus();b.setSelectionRange(d,d)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",e);a.moveStart("character",d);a.select()}}}var AuthenticationManager=Class.create(SignatureComponentManager,{start:function(a,b){this.changeSecondStep();SignatureComponentManager.signing=false;SignatureComponentManager.startInterval(a,b)},changeSecondStep:function(){SignatureFlow.loadFillData=this.performAuthentication;SignatureFlow.proceedToFillData=this.checkSelectedCertificate;SignatureFlow.changeCertificate=this.changeCertificate;AuthenticationManager.afterAuth=this.afterAuth;AuthenticationManager.authOk=this.authOk;AuthenticationManager.authenticate=this.authenticate;AuthenticationManager.showSplash=this.showSplash;AuthenticationManager.triggerAuthentication=this.triggerAuthentication},triggerAuthentication:function(){new Ajax.Request("/verifications/authenticate",{method:"post"})},changeCertificate:function(){var b="step[next]=certificate_dialog&contract[id]="+$("contract_id").value+"&load_cert=true&select_cert=true";var a=new Ajax.Request("/signature/next",{method:"post",parameters:b})},checkSelectedCertificate:function(){if(SignatureController.isAcceptedCertificateSelected()){AuthenticationManager.triggerAuthentication()}else{AppletUtils.renderError(_("This is a non-accepted certificate."),[_("Please, select an accepted certificate to authenticate.")])}},performAuthentication:function(b,a){if(!SignatureComponentManager.isOnlyOneCertAccepted()){AuthenticationManager.triggerAuthentication()}else{AuthenticationManager.showSplash(b,a)}},showSplash:function(d,b){var e="step[next]=authentication_last_step&contract[id]="+$("contract_id").value+"&selected[issuer]="+d+"&selected[subject]="+b;var a=new Ajax.Request("/signature/next",{method:"post",parameters:e})},authenticate:function(b){SignatureComponentManager.signing=true;var a=CertificateManager.authenticate(b,"Authenticating");AuthenticationManager.afterAuth(a)},afterAuth:function(a){if(a!==null){if(a.status=="CANCELED"||a.status=="ERROR"){if(a.status=="ERROR"){AppletUtils.recoverConsoleContent("Sign action finished error")}AppletUtils.renderError(_("We were unable to access the certificate."),[_("Please, ensure that the device (Smart card or USB) is connected.")]);SignatureComponentManager.signCancel()}else{AuthenticationManager.authOk(a.result)}}},authOk:function(b){var a=CertificateManager.getAdditionalCertificates();params="signature="+escape(b)+"&id="+$("to_be_sign_text").value;if(a!==null){params+="&additionalcertificates="+escape(a)}var d=new Ajax.Request("/verifications/update",{method:"post",parameters:params})}});if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(e,a,b){var d=this;if(Object.isArray(e)){this.handles=e.collect(function(f){return $(f)})}else{this.handles=[$(e)]}this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1",10);this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(f){return $(f)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0",10);this.alignY=parseInt(this.options.alignY||"0",10);this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(g,f){f=d.handles.length-1-f;d.setValue(parseFloat((Object.isArray(d.options.sliderValue)?d.options.sliderValue[f]:d.options.sliderValue)||d.range.start),f);g.makePositioned().observe("mousedown",d.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max()){return(this.allowedValues.max())}if(a<=this.allowedValues.min()){return(this.allowedValues.min())}var d=Math.abs(this.allowedValues[0]-a);var b=this.allowedValues[0];this.allowedValues.each(function(e){var f=Math.abs(e-a);if(f<=d){b=e;d=f}});return b}if(a>this.range.end){return this.range.end}if(a<this.range.start){return this.range.start}return a},setValue:function(b,a){if(!this.active){this.activeHandleIdx=a||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}a=a||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((a>0)&&(b<this.values[a-1])){b=this.values[a-1]}if((a<(this.handles.length-1))&&(b>this.values[a+1])){b=this.values[a+1]}}b=this.getNearestValue(b);this.values[a]=b;this.value=this.values[0];this.handles[a].style[this.isVertical()?"top":"left"]=this.translateToPx(b);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(b,a){this.setValue(this.values[a||this.activeHandleIdx||0]+b,a||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(a-this.range.start))+"px"},translateToValue:function(a){return((a/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(b){var a=this.values.sortBy(Prototype.K);b=b||0;return $R(a[b],a[b+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var a=this;if(this.spans){$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(b,a){if(this.isVertical()){b.style.top=this.translateToPx(a.start);b.style.height=this.translateToPx(a.end-a.start+this.range.start)}else{b.style.left=this.translateToPx(a.start);b.style.width=this.translateToPx(a.end-a.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(d){if(Event.isLeftClick(d)){if(!this.disabled){this.active=true;var e=Event.element(d);var f=[Event.pointerX(d),Event.pointerY(d)];var a=e;if(a==this.track){var b=Position.cumulativeOffset(this.track);this.event=d;this.setValue(this.translateToValue((this.isVertical()?f[1]-b[1]:f[0]-b[0])-(this.handleLength/2)));var b=Position.cumulativeOffset(this.activeHandle);this.offsetX=(f[0]-b[0]);this.offsetY=(f[1]-b[1])}else{while((this.handles.indexOf(e)==-1)&&e.parentNode){e=e.parentNode}if(this.handles.indexOf(e)!=-1){this.activeHandle=e;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var b=Position.cumulativeOffset(this.activeHandle);this.offsetX=(f[0]-b[0]);this.offsetY=(f[1]-b[1])}}}Event.stop(d)}},update:function(a){if(this.active){if(!this.dragging){this.dragging=true}this.draw(a);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(a)}},draw:function(b){var d=[Event.pointerX(b),Event.pointerY(b)];var a=Position.cumulativeOffset(this.track);d[0]-=this.offsetX+a[0];d[1]-=this.offsetY+a[1];this.event=b;this.setValue(this.translateToValue(this.isVertical()?d[1]:d[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});var TractisScoreSlider=Class.create();TractisScoreSlider.init=function(a){TractisScoreSlider.hook_events("sign_methods");if(a){TractisScoreSlider.min_score=a}var b=$("tractis_score_slider");TractisScoreSlider.slider=new Control.Slider(b.down(".handle"),b,{values:[1,2,3,4],range:$R(1,4),increment:25,minimum:1,maximum:4,sliderValue:$("tractis_score_value").value,onSlide:TractisScoreSlider.update_slider_info,onChange:TractisScoreSlider.update_tractis_score});TractisScoreSlider.update_tractis_score()};TractisScoreSlider.hook_events=function(a){$$("#"+a+' input[type="checkbox"]').each(function(b){Event.observe(b,"click",TractisScoreSlider.toggle_method);Event.observe(b,"change",TractisScoreSlider.toggle_method);TractisScoreSlider.toggle_method(b)})};TractisScoreSlider.set_value=function(a){TractisScoreSlider.slider.setValue(a)};TractisScoreSlider.contact_your_admin_link_details="onclick=\"new Ajax.Request('/users/modal_contact_your_admin', {asynchronous:true, evalScripts:true, method:'get'}); return false;\" href=\"#\"";TractisScoreSlider.can_check_input=function(a,d){var b=true;if(a.hasClassName("not_enough_score")){b=false;var e=a.getAttribute("tractis:methodname");Alerts.error(_("You can't select signature methods with a Tractis Score lower than %{score}").gsub(/%\{score\}/,TractisScoreSlider.slider.value),[_("In order to allow %{method} as a valid signature method, you must first lower your Tractis Score preferences.").gsub(/%\{method\}/,e)])}else{if(a.hasClassName("business_account_restricted")){b=false;var e=a.getAttribute("tractis:methodname");Alerts.error(_("You can't use %{method} to sign this contract").gsub(/%\{method\}/,e),[_("The administrator of the %{account} Business account has forbidden to use %{method} as a signature method. If you have any doubt or comment, please, <a %{contact_your_admin_link}>contact your administrator</a>.").gsub(/%\{account\}/,(TractisScoreSlider.business_account?TractisScoreSlider.business_account:"")).gsub(/%\{method\}/,e).gsub(/%\{contact_your_admin_link\}/,TractisScoreSlider.contact_your_admin_link_details)])}}return b};TractisScoreSlider.toggle_method=function(d){var b;var a=false;switch(d.type){case"change":a=true;case"click":b=Event.element(d);break;default:b=$(d)}var e=b.up("tr");if(b.checked&&TractisScoreSlider.can_check_input(b,e)){e.removeClassName("disabled");e.setOpacity(1)}else{if(b.checked){b.checked=false;a=false;Event.stop(d)}e.addClassName("disabled");e.setOpacity(0.75)}if(b.hasClassName("business_account_restricted")){e.setOpacity(0.6)}if(a&&TractisScoreSlider.onInputChange){TractisScoreSlider.onInputChange(d)}};TractisScoreSlider.can_update_tractis_score=function(b,a){var d=false;if(!a||!b){d=true}else{if(TractisScoreSlider.min_score&&(TractisScoreSlider.min_score>b)){Alerts.error(_("You can't select a Tractis Score lower than %{score}").gsub(/%\{score\}/,TractisScoreSlider.min_score),[_("The administrator of the %{account} Business account has forbidden to use signature methods with a Tractis Score lower than %{score}. For any doubt or comment, please, <a %{contact_your_admin_link}>contact your administrator</a>.").gsub(/%\{account\}/,(TractisScoreSlider.business_account?TractisScoreSlider.business_account:"")).gsub(/%\{score\}/,TractisScoreSlider.min_score).gsub(/%\{contact_your_admin_link\}/,TractisScoreSlider.contact_your_admin_link_details)]);d=false}else{if(a>=b){d=true}else{for(i=b;!d&&i<=4;i++){d=$$("#tractis_score_"+i+' input[type="checkbox"]').find(function(e){return e.checked})}if(d){d=true}else{Alerts.error(_("You can't select Tractis Score %{score}").gsub(/%\{score\}/,b),[_("You must have at least one signature method allowed."),_("Please, select a signature method with a higher score before updating your Tractis Score.")]);d=false}}}}return d};TractisScoreSlider.update_slider_info=function(j,a,d){var g=$("selected_tractis_score");var l;j=parseInt(j,10);switch(j){case 1:l=_("1 - Assurance level: Minimum");break;case 2:l=_("2 - Assurance level: Low");break;case 3:l=_("3 - Assurance level: Substantial");break;case 4:l=_("4 - Assurance level: High");break;default:l=_("Invalid Tractis Score");break}g.update(new Element("span",{"class":"tractis_score"+j}).update(l));var b,h,k;for(i=1;i<=4;i++){h=$("tractis_score_"+i);if(h){b=i<j;if(b){h.addClassName("disabled");h.setOpacity(0.4)}else{h.removeClassName("disabled");h.setOpacity(1)}try{if(d){d(h,b)}}catch(f){}}k=$$(".description_tractis_score_"+i);k.invoke("hide")}k=$$(".description_tractis_score_"+j);k.invoke("show")};TractisScoreSlider.adjust_checkboxes=function(b,a){b.getElementsBySelector('input[type="checkbox"]').each(function(d){if(a){d.checked=false;d.addClassName("not_enough_score");TractisScoreSlider.toggle_method(d)}else{if(d.hasClassName("business_account_restricted")){d.checked=false;TractisScoreSlider.toggle_method(d)}d.removeClassName("not_enough_score")}}.bind(this))};TractisScoreSlider.update_tractis_score=function(d,b){var f=$("tractis_score_value");var a=f.value;if(a){a=parseInt(a,10)}if(a!=d){if(TractisScoreSlider.can_update_tractis_score(d,a)){if(d){f.value=d}TractisScoreSlider.update_slider_info(f.value,this,TractisScoreSlider.adjust_checkboxes);var e;for(i=d;i<a;i++){e=$("tractis_score_"+i);if(e){e.getElementsBySelector('input[type="checkbox"]').each(function(g){g.checked=true;TractisScoreSlider.toggle_method(g)})}}if(b&&TractisScoreSlider.onScoreChange){TractisScoreSlider.onScoreChange()}}else{TractisScoreSlider.slider.setValue(a);TractisScoreSlider.update_slider_info(f.value,this,TractisScoreSlider.adjust_checkboxes)}}};TractisScoreSlider.disable_slider=function(){var a=$("tractis_score_slider");a.setOpacity(0.5);TractisScoreSlider.slider.setDisabled()};TractisScoreSlider.enable_slider=function(){if(Ajax.activeRequestCount<=1){var a=$("tractis_score_slider");a.setOpacity(1);TractisScoreSlider.slider.setEnabled()}};var TractisCertSelector=Class.create();TractisCertSelector.init=function(a){TractisCertSelector.load_data(a);TractisCertSelector.list_body=$("cert-list").down("tbody");TractisCertSelector.all_none=$("cert-list").down("thead input");TractisCertSelector.cert_country=$("cert-country");TractisCertSelector.cert_ca=$("cert-ca");TractisCertSelector.cert_media_type=$("cert-media-type");TractisCertSelector.mode="all";TractisCertSelector.full_setup();TractisCertSelector.update_form_field();Event.observe(TractisCertSelector.cert_country,"click",TractisCertSelector.apply_country_filter);Event.observe(TractisCertSelector.cert_ca,"click",TractisCertSelector.apply_ca_filter);Event.observe(TractisCertSelector.cert_media_type,"click",TractisCertSelector.apply_media_type_filter);Event.observe(TractisCertSelector.cert_country,"change",TractisCertSelector.apply_country_filter);Event.observe(TractisCertSelector.cert_ca,"change",TractisCertSelector.apply_ca_filter);Event.observe(TractisCertSelector.cert_media_type,"change",TractisCertSelector.apply_media_type_filter);Event.observe(TractisCertSelector.all_none,"click",TractisCertSelector.select_all_none)};TractisCertSelector.select_all_none=function(b){var a=Event.element(b).checked;$$("#cert-list tbody input").each(function(d){TractisCertSelector.update_cert_status(d,a)},this)};TractisCertSelector.full_setup=function(){TractisCertSelector.fill_cert_country();TractisCertSelector.fill_cert_ca();TractisCertSelector.fill_cert_media_type();TractisCertSelector.apply_filters();TractisCertSelector.update_totals();TractisCertSelector.update_mode_links()};TractisCertSelector.update_mode_links=function(){var a=$("certselector-modes");a.update("");var b=_("Show allowed certificates only");if(TractisCertSelector.mode!="selected"){b=new Element("a",{href:"selected"}).update(b);Event.observe(b,"click",TractisCertSelector.change_mode)}Element.insert(a,b);Element.insert(a," - ");b=_("Show all certificates");if(TractisCertSelector.mode=="selected"){b=new Element("a",{href:"all"}).update(b);Event.observe(b,"click",TractisCertSelector.change_mode)}Element.insert(a,b)};TractisCertSelector.change_mode=function(a){TractisCertSelector.mode=Event.element(a).getAttribute("href");Event.stop(a);TractisCertSelector.full_setup()};TractisCertSelector.load_data=function(d){TractisCertSelector.cert_list=d.evalJSON();TractisCertSelector.cert_list=TractisCertSelector.certificate_list().sortBy(function(f){return f.country+f.ca+f.name+f.oid});var b,a,e;a=TractisCertSelector.cert_list.length;TractisCertSelector.total_selected=0;for(b=0;b<a;++b){e=TractisCertSelector.cert_list[b];if(e.accepted){TractisCertSelector.total_selected++}e.cid=b;if(!e.name||e.name==""){e.name=_("Certificate policy with OID: %{oid}").gsub(/%\{oid\}/,e.oid)}}};TractisCertSelector.fill_certs_filter=function(f,a,d){var e=d.collect(function(g){return g[f]},this).uniq().sort();a.update("");var b=new Element("option",{selected:"selected",value:""});b.update(_("All (%{amount})").gsub(/%\{amount\}/,e.length));Element.insert(a,b);e.each(function(g){Element.insert(a,new Element("option",{value:g}).update(g))},this)};TractisCertSelector.fill_cert_country=function(a){if(!a){a=TractisCertSelector.certificate_list()}TractisCertSelector.fill_certs_filter("country",TractisCertSelector.cert_country,a)};TractisCertSelector.fill_cert_ca=function(a){if(!a){a=TractisCertSelector.certificate_list()}TractisCertSelector.fill_certs_filter("ca",TractisCertSelector.cert_ca,a)};TractisCertSelector.fill_cert_media_type=function(d){if(!d){d=TractisCertSelector.certificate_list()}var a=TractisCertSelector.get_filter(TractisCertSelector.cert_country);var b=TractisCertSelector.get_filter(TractisCertSelector.cert_ca);TractisCertSelector.fill_certs_filter("media_type",TractisCertSelector.cert_media_type,d)};TractisCertSelector.get_filter=function(a){TractisCertSelector.all_none.focus();var b=$A($F(a)).flatten();if(b.include("")&&b.length>1){a.down("option").selected=false;b=$A($F(a)).flatten()}else{if(b.length==0||(b.length==1&&b[0]=="")){a.value="";b=undefined}}return b};TractisCertSelector.filtered_certs=function(e,b,d,f){var a=e.findAll(function(g){if(b&&!b.include(g.country)){return false}if(d&&!d.include(g.ca)){return false}if(f&&!f.include(g.media_type)){return false}return true},this);return a};TractisCertSelector.apply_filters=function(e){if(!e){e=TractisCertSelector.certificate_list()}var b=TractisCertSelector.get_filter(TractisCertSelector.cert_country);var d=TractisCertSelector.get_filter(TractisCertSelector.cert_ca);var f=TractisCertSelector.get_filter(TractisCertSelector.cert_media_type);var a=TractisCertSelector.filtered_certs(e,b,d,f);TractisCertSelector.fill_table(a)};TractisCertSelector.apply_country_filter=function(b){certs=TractisCertSelector.certificate_list();var a=TractisCertSelector.get_filter(TractisCertSelector.cert_country);certs=TractisCertSelector.filtered_certs(certs,a);TractisCertSelector.fill_certs_filter("ca",TractisCertSelector.cert_ca,certs);TractisCertSelector.fill_certs_filter("media_type",TractisCertSelector.cert_media_type,certs);TractisCertSelector.apply_filters()};TractisCertSelector.apply_ca_filter=function(d){certs=TractisCertSelector.certificate_list();var a=TractisCertSelector.get_filter(TractisCertSelector.cert_country);var b=TractisCertSelector.get_filter(TractisCertSelector.cert_ca);certs=TractisCertSelector.filtered_certs(certs,a,b);TractisCertSelector.fill_certs_filter("media_type",TractisCertSelector.cert_media_type,certs);TractisCertSelector.apply_filters()};TractisCertSelector.apply_media_type_filter=function(a){TractisCertSelector.apply_filters()};TractisCertSelector.update_cert_status=function(b,a){if(a==undefined){b=Event.element(b);a=b.checked}else{if(a==b.checked){return}}if(a){b.setAttribute("checked","checked")}else{b.removeAttribute("checked")}TractisCertSelector.cert_list[b.name].accepted=a;if(a){TractisCertSelector.total_selected++}else{TractisCertSelector.total_selected--}TractisCertSelector.update_totals();TractisCertSelector.update_form_field()};TractisCertSelector.update_form_field=function(){$("policies").value=TractisCertSelector.serialize()};TractisCertSelector.update_totals=function(){$("certselector-amount").update(_("<strong>%{amount}</strong> allowed certificates").gsub(/%\{amount\}/,TractisCertSelector.total_selected))};TractisCertSelector.serialize=function(){return TractisCertSelector.cert_list.findAll(function(a){return a.accepted}).collect(function(a){return a.oid}).toJSON()};TractisCertSelector.certificate_list=function(){if(TractisCertSelector.mode=="selected"){return TractisCertSelector.cert_list.findAll(function(a){return a.accepted})}else{return TractisCertSelector.cert_list}};TractisCertSelector.fill_table=function(a){if(!a){a=TractisCertSelector.certificate_list()}TractisCertSelector.all_accepted=true;TractisCertSelector.list_body.update("");a.each(function(d){var b=$("cert-list").down("tbody");var f=new Element("tr");var e=new Element("input",{type:"checkbox",name:d.cid});Event.observe(e,"click",TractisCertSelector.update_cert_status);accepted=e.wrap("td",{"class":"action"});Element.insert(f,new Element("td").update(d.country));Element.insert(f,new Element("td").update(d.ca));Element.insert(f,new Element("td",{"class":"w100"}).update(d.name));Element.insert(f,new Element("td",{"class":"media"}).update(d.media_type));Element.insert(f,new Element("td",{"class":"score"}).update(d.score));Element.insert(f,accepted);Element.insert(TractisCertSelector.list_body,f);if(d.accepted){e.setAttribute("checked","checked")}TractisCertSelector.all_accepted=TractisCertSelector.all_accepted&&d.accepted});if(TractisCertSelector.all_accepted){TractisCertSelector.all_none.setAttribute("checked","checked")}else{TractisCertSelector.all_none.removeAttribute("checked")}};function bind_table_events(a){a=$(a||document.body);a.select("td.item a").each(function(b){var d=b.up("tr");Event.observe(d,"click",function(f){var e=Event.element(f);if(e.tagName.toUpperCase().match("^(INPUT|A|SELECT|OPTION)$")||e.match("td.action")||e.up("td.action")){return null}if(b.onclick){b.onclick()}else{window.location=b.getAttribute("href")}}.bind(this));d.setStyle({cursor:"pointer"})});a.select("td.star a").each(function(d){var b=d.up("td");Event.observe(b,"click",function(e){if(Event.element(e).tagName.toUpperCase()=="TD"){if(d.onclick){d.onclick()}else{window.location=d.getAttribute("href")}}Event.stop(e)}.bind(this));b.setStyle({cursor:"pointer"})});a.select("td.action").each(function(d){var b=d.down('input[type="checkbox"]');if(b){var e=b.up("tr");highlightRow(e,b.checked);Event.observe(b,"click",function(f){highlightRow(e,b.checked)}.bind(this))}d.setStyle({cursor:"default"})})}bind_table_events();var Tooltips=Class.create();Tooltips.prototype={initialize:function(a,b){var d=$$(a);d.each(function(e){new Tooltip(e,b)})}};var Tooltip=Class.create();Tooltip.prototype={initialize:function(b,a){this.el=$(b);this.initialized=false;this.setOptions(a);this.showEvent=this.show.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEvent=this.update.bindAsEventListener(this);Event.observe(this.el,"mouseover",this.showEvent);Event.observe(this.el,"mouseout",this.hideEvent);if(a&&a.content){this.content=$(a.content).innerHTML}else{this.content=this.el.title.stripScripts().strip()}this.content=this.el.title.stripScripts().strip();this.el.title="";this.el.descendants().each(function(d){if(Element.readAttribute(d,"alt")){d.alt=""}})},setOptions:function(a){this.options={backgroundColor:"#999",borderColor:"#666",textColor:"",textShadowColor:"",maxWidth:250,align:"left",delay:250,mouseFollow:true,opacity:0.75,appearDuration:0.25,hideDuration:0.25};Object.extend(this.options,a||{})},show:function(a){this.xCord=Event.pointerX(a);this.yCord=Event.pointerY(a);if(!this.initialized){this.timeout=window.setTimeout(this.appear.bind(this),this.options.delay)}},hide:function(a){if(this.initialized){this.appearingFX.cancel();if(this.options.mouseFollow){Event.stopObserving(this.el,"mousemove",this.updateEvent)}new Effect.Fade(this.tooltip,{duration:this.options.hideDuration,afterFinish:function(){Element.remove(this.tooltip)}.bind(this)})}this._clearTimeout(this.timeout);this.initialized=false},update:function(a){this.xCord=Event.pointerX(a);this.yCord=Event.pointerY(a);this.setup()},appear:function(){this.tooltip=new Element("div",{className:"tooltip",style:"display: none"});var d=new Element("div",{className:"xarrow"}).insert('<b class="a1"></b><b class="a2"></b><b class="a3"></b><b class="a4"></b><b class="a5"></b><b class="a6"></b>');var e=new Element("div",{className:"xtop"}).insert(new Element("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));var a=new Element("div",{className:"xbottom"}).insert(new Element("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"}));var b=new Element("div",{className:"xboxcontent",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+((this.options.textColor!="")?"; color:"+this.options.textColor:"")+((this.options.textShadowColor!="")?"; text-shadow:2px 2px 0"+this.options.textShadowColor+";":"")}).update(this.content);this.tooltip.insert(d).insert(e).insert(b).insert(a);$(document.body).insert({top:this.tooltip});this.tooltip.select(".xarrow b").each(function(f){if(!f.hasClassName("a1")){f.setStyle({backgroundColor:this.options.backgroundColor,borderColor:this.options.borderColor})}else{f.setStyle({backgroundColor:this.options.borderColor})}}.bind(this));Element.extend(this.tooltip);this.options.width=this.tooltip.getWidth()+1;this.tooltip.style.width=this.options.width+"px";this.setup();if(this.options.mouseFollow){Event.observe(this.el,"mousemove",this.updateEvent)}this.initialized=true;this.appearingFX=new Effect.Appear(this.tooltip,{duration:this.options.appearDuration,to:this.options.opacity})},setup:function(){if(this.options.width>this.options.maxWidth){this.options.width=this.options.maxWidth;this.tooltip.style.width=this.options.width+"px"}if(this.xCord+this.options.width>=Element.getWidth(document.body)){this.options.align="right";this.xCord=this.xCord-this.options.width+20;this.tooltip.down(".xarrow").setStyle({left:this.options.width-24+"px"})}else{this.options.align="left";this.tooltip.down(".xarrow").setStyle({left:12+"px"})}this.tooltip.style.left=this.xCord-7+"px";this.tooltip.style.top=this.yCord+12+"px"},_clearTimeout:function(a){clearTimeout(a);clearInterval(a);return null}};(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.protocolCheck=b()}}})(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a){return a(o,!0)}if(i){return i(o,!0)}var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o])}return s})({1:[function(require,module,exports){function _registerEvent(target,eventType,cb){if(target.addEventListener){target.addEventListener(eventType,cb);return{remove:function(){target.removeEventListener(eventType,cb)}}}else{target.attachEvent(eventType,cb);return{remove:function(){target.detachEvent(eventType,cb)}}}}function _createHiddenIframe(target,uri){var iframe=document.createElement("iframe");iframe.src=uri;iframe.id="hiddenIframe";iframe.style.display="none";target.appendChild(iframe);return iframe}function openUriWithHiddenFrame(uri,failCb,successCb){var timeout=setTimeout(function(){failCb();handler.remove()},1000);var iframe=document.querySelector("#hiddenIframe");if(!iframe){iframe=_createHiddenIframe(document.body,"about:blank")}var handler=_registerEvent(window,"blur",onBlur);function onBlur(){clearTimeout(timeout);handler.remove();successCb()}iframe.contentWindow.location.href=uri}function openUriWithTimeoutHack(uri,failCb,successCb){var timeout=setTimeout(function(){failCb();handler.remove()},1000);var target=window;while(target!=target.parent){target=target.parent}var handler=_registerEvent(target,"blur",onBlur);function onBlur(){clearTimeout(timeout);handler.remove();successCb()}window.location=uri}function openUriUsingFirefox(uri,failCb,successCb){var iframe=document.querySelector("#hiddenIframe");if(!iframe){iframe=_createHiddenIframe(document.body,"about:blank")}try{iframe.contentWindow.location.href=uri;successCb()}catch(e){if(e.name=="NS_ERROR_UNKNOWN_PROTOCOL"){failCb()}}}function openUriUsingIEInOlderWindows(uri,failCb,successCb){if(getInternetExplorerVersion()===10){openUriUsingIE10InWindows7(uri,failCb,successCb)}else{if(getInternetExplorerVersion()===9||getInternetExplorerVersion()===11){openUriWithHiddenFrame(uri,failCb,successCb)}else{openUriInNewWindowHack(uri,failCb,successCb)}}}function openUriUsingIE10InWindows7(uri,failCb,successCb){var timeout=setTimeout(failCb,1000);window.addEventListener("blur",function(){clearTimeout(timeout);successCb()});var iframe=document.querySelector("#hiddenIframe");if(!iframe){iframe=_createHiddenIframe(document.body,"about:blank")}try{iframe.contentWindow.location.href=uri}catch(e){failCb();clearTimeout(timeout)}}function openUriInNewWindowHack(uri,failCb,successCb){var myWindow=window.open("","","width=0,height=0");myWindow.document.write("<iframe src='"+uri+"'></iframe>");setTimeout(function(){try{myWindow.location.href;myWindow.setTimeout("window.close()",1000);successCb()}catch(e){myWindow.close();failCb()}},1000)}function openUriWithMsLaunchUri(uri,failCb,successCb){navigator.msLaunchUri(uri,successCb,failCb)}function checkBrowser(){var isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;return{isOpera:isOpera,isFirefox:typeof InstallTrigger!=="undefined",isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome&&!isOpera,isIE:
/*@cc_on!@*/
false||!!document.documentMode}}function getInternetExplorerVersion(){var rv=-1;if(navigator.appName==="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1)}}else{if(navigator.appName==="Netscape"){var ua=navigator.userAgent;var re=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1)}}}return rv}module.exports=function(uri,failCb,successCb){function failCallback(){failCb&&failCb()}function successCallback(){successCb&&successCb()}if(navigator.msLaunchUri){openUriWithMsLaunchUri(uri,failCb,successCb)}else{var browser=checkBrowser();if(browser.isFirefox){openUriUsingFirefox(uri,failCallback,successCallback)}else{if(browser.isChrome){openUriWithTimeoutHack(uri,failCallback,successCallback)}else{if(browser.isIE){openUriUsingIEInOlderWindows(uri,failCallback,successCallback)}else{}}}}}},{}]},{},[1])(1)});function fixProto(d,b){var e={enumerable:false},a;if(typeof d!=="object"||typeof b!=="object"){return}for(a in b){b.hasOwnProperty(a)||Object.defineProperty(d,a,e)}}fixProto(Array.prototype,[]);(function(){var a;Object.defineProperty(window,"io",{get:function(){return a},set:function(d){var b;a=d;Object.defineProperty(a,"sails",{get:function(){return b},set:function(e){b=e;b.autoConnect=false}})}})})();!function(e){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=e()}else{if("function"==typeof define&&define.amd){define([],e)}else{var d;d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,d.io=e()}}}(function(){var e;return function d(b,m,l){function k(p,o){if(!m[p]){if(!b[p]){var n="function"==typeof require&&require;if(!o&&n){return n(p,!0)}if(j){return j(p,!0)}var f=new Error("Cannot find module '"+p+"'");throw f.code="MODULE_NOT_FOUND",f}var a=m[p]={exports:{}};b[p][0].call(a.exports,function(g){var q=b[p][1][g];return k(q?q:g)},a,a.exports,d,b,m,l)}return m[p].exports}for(var j="function"==typeof require&&require,h=0;h<l.length;h++){k(l[h])}return k}({1:[function(g,f,h){f.exports=g("./lib/")},{"./lib/":2}],2:[function(g,f,h){f.exports=g("./socket"),f.exports.parser=g("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(g,f,h){(function(v){function u(k,j){if(!(this instanceof u)){return new u(k,j)}j=j||{},k&&"object"==typeof k&&(j=k,k=null),k?(k=n(k),j.hostname=k.host,j.secure="https"==k.protocol||"wss"==k.protocol,j.port=k.port,k.query&&(j.query=k.query)):j.host&&(j.hostname=n(j.host).host),this.secure=null!=j.secure?j.secure:v.location&&"https:"==location.protocol,j.hostname&&!j.port&&(j.port=this.secure?"443":"80"),this.agent=j.agent||!1,this.hostname=j.hostname||(v.location?location.hostname:"localhost"),this.port=j.port||(v.location&&location.port?location.port:this.secure?443:80),this.query=j.query||{},"string"==typeof this.query&&(this.query=a.decode(this.query)),this.upgrade=!1!==j.upgrade,this.path=(j.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!j.forceJSONP,this.jsonp=!1!==j.jsonp,this.forceBase64=!!j.forceBase64,this.enablesXDR=!!j.enablesXDR,this.timestampParam=j.timestampParam||"t",this.timestampRequests=j.timestampRequests,this.transports=j.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=j.policyPort||843,this.rememberUpgrade=j.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=j.onlyBinaryUpgrades,this.perMessageDeflate=!1!==j.perMessageDeflate?j.perMessageDeflate||{}:!1,!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=j.pfx||null,this.key=j.key||null,this.passphrase=j.passphrase||null,this.cert=j.cert||null,this.ca=j.ca||null,this.ciphers=j.ciphers||null,this.rejectUnauthorized=void 0===j.rejectUnauthorized?null:j.rejectUnauthorized;var l="object"==typeof v&&v;l.global===l&&j.extraHeaders&&Object.keys(j.extraHeaders).length>0&&(this.extraHeaders=j.extraHeaders),this.open()}function t(k){var j={};for(var l in k){k.hasOwnProperty(l)&&(j[l]=k[l])}return j}var s=g("./transports"),r=g("component-emitter"),q=g("debug")("engine.io-client:socket"),p=g("indexof"),o=g("engine.io-parser"),n=g("parseuri"),b=g("parsejson"),a=g("parseqs");f.exports=u,u.priorWebsocketSuccess=!1,r(u.prototype),u.protocol=o.protocol,u.Socket=u,u.Transport=g("./transport"),u.transports=g("./transports"),u.parser=g("engine.io-parser"),u.prototype.createTransport=function(k){q('creating transport "%s"',k);var j=t(this.query);j.EIO=o.protocol,j.transport=k,this.id&&(j.sid=this.id);var l=new s[k]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:j,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return l},u.prototype.open=function(){var k;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket")){k="websocket"}else{if(0===this.transports.length){var j=this;return void setTimeout(function(){j.emit("error","No transports available")},0)}k=this.transports[0]}this.readyState="opening";try{k=this.createTransport(k)}catch(l){return this.transports.shift(),void this.open()}k.open(),this.setTransport(k)},u.prototype.setTransport=function(k){q("setting transport %s",k.name);var j=this;this.transport&&(q("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=k,k.on("drain",function(){j.onDrain()}).on("packet",function(l){j.onPacket(l)}).on("error",function(l){j.onError(l)}).on("close",function(){j.onClose("transport close")})},u.prototype.probe=function(G){function F(){if(w.onlyBinaryUpgrades){var j=!this.supportsBinary&&w.transport.supportsBinary;x=x||j}x||(q('probe transport "%s" opened',G),y.send([{type:"ping",data:"probe"}]),y.once("packet",function(k){if(!x){if("pong"==k.type&&"probe"==k.data){if(q('probe transport "%s" pong',G),w.upgrading=!0,w.emit("upgrading",y),!y){return}u.priorWebsocketSuccess="websocket"==y.name,q('pausing current transport "%s"',w.transport.name),w.transport.pause(function(){x||"closed"!=w.readyState&&(q("changing transport and sending upgrade packet"),z(),w.setTransport(y),y.send([{type:"upgrade"}]),w.emit("upgrade",y),y=null,w.upgrading=!1,w.flush())})}else{q('probe transport "%s" failed',G);var l=new Error("probe error");l.transport=y.name,w.emit("upgradeError",l)}}}))}function E(){x||(x=!0,z(),y.close(),y=null)}function D(j){var k=new Error("probe error: "+j);k.transport=y.name,E(),q('probe transport "%s" failed because of error: %s',G,j),w.emit("upgradeError",k)}function C(){D("transport closed")}function B(){D("socket closed")}function A(j){y&&j.name!=y.name&&(q('"%s" works - aborting "%s"',j.name,y.name),E())}function z(){y.removeListener("open",F),y.removeListener("error",D),y.removeListener("close",C),w.removeListener("close",B),w.removeListener("upgrading",A)}q('probing transport "%s"',G);var y=this.createTransport(G,{probe:1}),x=!1,w=this;u.priorWebsocketSuccess=!1,y.once("open",F),y.once("error",D),y.once("close",C),this.once("close",B),this.once("upgrading",A),y.open()},u.prototype.onOpen=function(){if(q("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){q("starting upgrade probes");for(var k=0,j=this.upgrades.length;j>k;k++){this.probe(this.upgrades[k])}}},u.prototype.onPacket=function(k){if("opening"==this.readyState||"open"==this.readyState){switch(q('socket receive: type "%s", data "%s"',k.type,k.data),this.emit("packet",k),this.emit("heartbeat"),k.type){case"open":this.onHandshake(b(k.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var j=new Error("server error");j.code=k.data,this.onError(j);break;case"message":this.emit("data",k.data),this.emit("message",k.data)}}else{q('packet received with socket readyState "%s"',this.readyState)}},u.prototype.onHandshake=function(j){this.emit("handshake",j),this.id=j.sid,this.transport.query.sid=j.sid,this.upgrades=this.filterUpgrades(j.upgrades),this.pingInterval=j.pingInterval,this.pingTimeout=j.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(k){clearTimeout(this.pingTimeoutTimer);var j=this;j.pingTimeoutTimer=setTimeout(function(){"closed"!=j.readyState&&j.onClose("ping timeout")},k||j.pingInterval+j.pingTimeout)},u.prototype.setPing=function(){var j=this;clearTimeout(j.pingIntervalTimer),j.pingIntervalTimer=setTimeout(function(){q("writing ping packet - expecting pong within %sms",j.pingTimeout),j.ping(),j.onHeartbeat(j.pingTimeout)},j.pingInterval)},u.prototype.ping=function(){var j=this;this.sendPacket("ping",function(){j.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(q("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(k,j,l){return this.sendPacket("message",k,j,l),this},u.prototype.sendPacket=function(k,j,w,m){if("function"==typeof j&&(m=j,j=void 0),"function"==typeof w&&(m=w,w=null),"closing"!=this.readyState&&"closed"!=this.readyState){w=w||{},w.compress=!1!==w.compress;var l={type:k,data:j,options:w};this.emit("packetCreate",l),this.writeBuffer.push(l),m&&this.once("flush",m),this.flush()}},u.prototype.close=function(){function k(){l.onClose("forced close"),q("socket closing - telling transport to close"),l.transport.close()}function j(){l.removeListener("upgrade",j),l.removeListener("upgradeError",j),k()}function m(){l.once("upgrade",j),l.once("upgradeError",j)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var l=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?m():k()}):this.upgrading?m():k()}return this},u.prototype.onError=function(j){q("socket error %j",j),u.priorWebsocketSuccess=!1,this.emit("error",j),this.onClose("transport error",j)},u.prototype.onClose=function(k,j){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){q('socket close with reason: "%s"',k);var l=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",k,j),l.writeBuffer=[],l.prevBufferLen=0}},u.prototype.filterUpgrades=function(k){for(var j=[],m=0,l=k.length;l>m;m++){~p(this.transports,k[m])&&j.push(k[m])}return j}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(h,g,m){function l(b){this.path=b.path,this.hostname=b.hostname,this.port=b.port,this.secure=b.secure,this.query=b.query,this.timestampParam=b.timestampParam,this.timestampRequests=b.timestampRequests,this.readyState="",this.agent=b.agent||!1,this.socket=b.socket,this.enablesXDR=b.enablesXDR,this.pfx=b.pfx,this.key=b.key,this.passphrase=b.passphrase,this.cert=b.cert,this.ca=b.ca,this.ciphers=b.ciphers,this.rejectUnauthorized=b.rejectUnauthorized,this.extraHeaders=b.extraHeaders}var k=h("engine.io-parser"),j=h("component-emitter");g.exports=l,j(l.prototype),l.prototype.onError=function(n,f){var o=new Error(n);return o.type="TransportError",o.description=f,this.emit("error",o),this},l.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},l.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},l.prototype.send=function(b){if("open"!=this.readyState){throw new Error("Transport not open")}this.write(b)},l.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},l.prototype.onData=function(n){var f=k.decodePacket(n,this.socket.binaryType);this.onPacket(f)},l.prototype.onPacket=function(b){this.emit("packet",b)},l.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(g,f,h){(function(a){function n(b){var t,s=!1,r=!1,q=!1!==b.jsonp;if(a.location){var p="https:"==location.protocol,o=location.port;o||(o=p?443:80),s=b.hostname!=location.hostname||o!=b.port,r=b.secure!=p}if(b.xdomain=s,b.xscheme=r,t=new m(b),"open" in t&&!b.forceJSONP){return new l(b)}if(!q){throw new Error("JSONP disabled")}return new k(b)}var m=g("xmlhttprequest-ssl"),l=g("./polling-xhr"),k=g("./polling-jsonp"),j=g("./websocket");h.polling=n,h.websocket=j}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(g,f,h){(function(p){function o(){}function n(q){m.call(this,q),this.query=this.query||{},k||(p.___eio||(p.___eio=[]),k=p.___eio),this.index=k.length;var j=this;k.push(function(r){j.onData(r)}),this.query.j=this.index,p.document&&p.addEventListener&&p.addEventListener("beforeunload",function(){j.script&&(j.script.onerror=o)},!1)}var m=g("./polling"),l=g("component-inherit");f.exports=n;var k,b=/\n/g,a=/\\n/g;l(n,m),n.prototype.supportsBinary=!1,n.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),m.prototype.doClose.call(this)},n.prototype.doPoll=function(){var q=this,j=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),j.async=!0,j.src=this.uri(),j.onerror=function(t){q.onError("jsonp poll error",t)};var s=document.getElementsByTagName("script")[0];s?s.parentNode.insertBefore(j,s):(document.head||document.body).appendChild(j),this.script=j;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},n.prototype.doWrite=function(y,x){function w(){v(),x()}function v(){if(u.iframe){try{u.form.removeChild(u.iframe)}catch(A){u.onError("jsonp polling iframe removal error",A)}}try{var z='<iframe src="javascript:0" name="'+u.iframeId+'">';t=document.createElement(z)}catch(A){t=document.createElement("iframe"),t.name=u.iframeId,t.src="javascript:0"}t.id=u.iframeId,u.form.appendChild(t),u.iframe=t}var u=this;if(!this.form){var t,s=document.createElement("form"),r=document.createElement("textarea"),q=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=q,s.method="POST",s.setAttribute("accept-charset","utf-8"),r.name="d",s.appendChild(r),document.body.appendChild(s),this.form=s,this.area=r}this.form.action=this.uri(),v(),y=y.replace(a,"\\\n"),this.area.value=y.replace(b,"\\n");try{this.form.submit()}catch(j){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==u.iframe.readyState&&w()}:this.iframe.onload=w}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-inherit":16}],7:[function(g,f,h){(function(t){function s(){}function r(k){if(n.call(this,k),t.location){var j="https:"==location.protocol,l=location.port;l||(l=j?443:80),this.xd=k.hostname!=t.location.hostname||l!=k.port,this.xs=k.secure!=j}else{this.extraHeaders=k.extraHeaders}}function q(j){this.method=j.method||"GET",this.uri=j.uri,this.xd=!!j.xd,this.xs=!!j.xs,this.async=!1!==j.async,this.data=void 0!=j.data?j.data:null,this.agent=j.agent,this.isBinary=j.isBinary,this.supportsBinary=j.supportsBinary,this.enablesXDR=j.enablesXDR,this.pfx=j.pfx,this.key=j.key,this.passphrase=j.passphrase,this.cert=j.cert,this.ca=j.ca,this.ciphers=j.ciphers,this.rejectUnauthorized=j.rejectUnauthorized,this.extraHeaders=j.extraHeaders,this.create()}function p(){for(var j in q.requests){q.requests.hasOwnProperty(j)&&q.requests[j].abort()}}var o=g("xmlhttprequest-ssl"),n=g("./polling"),m=g("component-emitter"),b=g("component-inherit"),a=g("debug")("engine.io-client:polling-xhr");f.exports=r,f.exports.Request=q,b(r,n),r.prototype.supportsBinary=!0,r.prototype.request=function(j){return j=j||{},j.uri=this.uri(),j.xd=this.xd,j.xs=this.xs,j.agent=this.agent||!1,j.supportsBinary=this.supportsBinary,j.enablesXDR=this.enablesXDR,j.pfx=this.pfx,j.key=this.key,j.passphrase=this.passphrase,j.cert=this.cert,j.ca=this.ca,j.ciphers=this.ciphers,j.rejectUnauthorized=this.rejectUnauthorized,j.extraHeaders=this.extraHeaders,new q(j)},r.prototype.doWrite=function(k,j){var v="string"!=typeof k&&void 0!==k,u=this.request({method:"POST",data:k,isBinary:v}),l=this;u.on("success",j),u.on("error",function(w){l.onError("xhr post error",w)}),this.sendXhr=u},r.prototype.doPoll=function(){a("xhr poll");var k=this.request(),j=this;k.on("data",function(l){j.onData(l)}),k.on("error",function(l){j.onError("xhr poll error",l)}),this.pollXhr=k},m(q.prototype),q.prototype.create=function(){var k={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};k.pfx=this.pfx,k.key=this.key,k.passphrase=this.passphrase,k.cert=this.cert,k.ca=this.ca,k.ciphers=this.ciphers,k.rejectUnauthorized=this.rejectUnauthorized;var j=this.xhr=new o(k),v=this;try{a("xhr open %s: %s",this.method,this.uri),j.open(this.method,this.uri,this.async);try{if(this.extraHeaders){j.setDisableHeaderCheck(!0);for(var u in this.extraHeaders){this.extraHeaders.hasOwnProperty(u)&&j.setRequestHeader(u,this.extraHeaders[u])}}}catch(l){}if(this.supportsBinary&&(j.responseType="arraybuffer"),"POST"==this.method){try{this.isBinary?j.setRequestHeader("Content-type","application/octet-stream"):j.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(l){}}"withCredentials" in j&&(j.withCredentials=!0),this.hasXDR()?(j.onload=function(){v.onLoad()},j.onerror=function(){v.onError(j.responseText)}):j.onreadystatechange=function(){4==j.readyState&&(200==j.status||1223==j.status?v.onLoad():setTimeout(function(){v.onError(j.status)},0))},a("xhr data %s",this.data),j.send(this.data)}catch(l){return void setTimeout(function(){v.onError(l)},0)}t.document&&(this.index=q.requestsCount++,q.requests[this.index]=this)},q.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},q.prototype.onData=function(j){this.emit("data",j),this.onSuccess()},q.prototype.onError=function(j){this.emit("error",j),this.cleanup(!0)},q.prototype.cleanup=function(k){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=s:this.xhr.onreadystatechange=s,k){try{this.xhr.abort()}catch(j){}}t.document&&delete q.requests[this.index],this.xhr=null}},q.prototype.onLoad=function(){var k;try{var j;try{j=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(x){}if("application/octet-stream"===j){k=this.xhr.response}else{if(this.supportsBinary){try{k=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(x){for(var w=new Uint8Array(this.xhr.response),v=[],u=0,l=w.length;l>u;u++){v.push(w[u])}k=String.fromCharCode.apply(null,v)}}else{k=this.xhr.responseText}}}catch(x){this.onError(x)}null!=k&&this.onData(k)},q.prototype.hasXDR=function(){return"undefined"!=typeof t.XDomainRequest&&!this.xs&&this.enablesXDR},q.prototype.abort=function(){this.cleanup()},t.document&&(q.requestsCount=0,q.requests={},t.attachEvent?t.attachEvent("onunload",p):t.addEventListener&&t.addEventListener("beforeunload",p,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(v,u,t){function s(g){var f=g&&g.forceBase64;(!l||f)&&(this.supportsBinary=!1),r.call(this,g)}var r=v("../transport"),q=v("parseqs"),p=v("engine.io-parser"),o=v("component-inherit"),n=v("yeast"),m=v("debug")("engine.io-client:polling");u.exports=s;var l=function(){var a=v("xmlhttprequest-ssl"),f=new a({xdomain:!1});return null!=f.responseType}();o(s,r),s.prototype.name="polling",s.prototype.doOpen=function(){this.poll()},s.prototype.pause=function(g){function f(){m("paused"),j.readyState="paused",g()}var j=this;if(this.readyState="pausing",this.polling||!this.writable){var h=0;this.polling&&(m("we are currently polling - waiting to pause"),h++,this.once("pollComplete",function(){m("pre-pause polling complete"),--h||f()})),this.writable||(m("we are currently writing - waiting to pause"),h++,this.once("drain",function(){m("pre-pause writing complete"),--h||f()}))}else{f()}},s.prototype.poll=function(){m("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},s.prototype.onData=function(g){var f=this;m("polling got data %s",g);var h=function(b,k,j){return"opening"==f.readyState&&f.onOpen(),"close"==b.type?(f.onClose(),!1):void f.onPacket(b)};p.decodePayload(g,this.socket.binaryType,h),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():m('ignoring poll - transport state "%s"',this.readyState))},s.prototype.doClose=function(){function g(){m("writing close packet"),f.write([{type:"close"}])}var f=this;"open"==this.readyState?(m("transport open - closing"),g()):(m("transport not open - deferring close"),this.once("open",g))},s.prototype.write=function(g){var f=this;this.writable=!1;var h=function(){f.writable=!0,f.emit("drain")},f=this;p.encodePayload(g,this.supportsBinary,function(b){f.doWrite(b,h)})},s.prototype.uri=function(){var g=this.query||{},f=this.secure?"https":"http",j="";!1!==this.timestampRequests&&(g[this.timestampParam]=n()),this.supportsBinary||g.sid||(g.b64=1),g=q.encode(g),this.port&&("https"==f&&443!=this.port||"http"==f&&80!=this.port)&&(j=":"+this.port),g.length&&(g="?"+g);var h=-1!==this.hostname.indexOf(":");return f+"://"+(h?"["+this.hostname+"]":this.hostname)+j+this.path+g}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(g,f,h){(function(t){function s(k){var j=k&&k.forceBase64;j&&(this.supportsBinary=!1),this.perMessageDeflate=k.perMessageDeflate,r.call(this,k)}var r=g("../transport"),q=g("engine.io-parser"),p=g("parseqs"),o=g("component-inherit"),n=g("yeast"),m=g("debug")("engine.io-client:websocket"),b=t.WebSocket||t.MozWebSocket,a=b||("undefined"!=typeof window?null:g("ws"));f.exports=s,o(s,r),s.prototype.name="websocket",s.prototype.supportsBinary=!0,s.prototype.doOpen=function(){if(this.check()){var k=this.uri(),j=void 0,l={agent:this.agent,perMessageDeflate:this.perMessageDeflate};l.pfx=this.pfx,l.key=this.key,l.passphrase=this.passphrase,l.cert=this.cert,l.ca=this.ca,l.ciphers=this.ciphers,l.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(l.headers=this.extraHeaders),this.ws=b?new a(k):new a(k,j,l),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},s.prototype.addEventListeners=function(){var j=this;this.ws.onopen=function(){j.onOpen()},this.ws.onclose=function(){j.onClose()},this.ws.onmessage=function(k){j.onData(k.data)},this.ws.onerror=function(k){j.onError("websocket error",k)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(s.prototype.onData=function(k){var j=this;setTimeout(function(){r.prototype.onData.call(j,k)},0)}),s.prototype.write=function(k){function j(){w.emit("flush"),setTimeout(function(){w.writable=!0,w.emit("drain")},0)}var w=this;this.writable=!1;for(var v=k.length,u=0,l=v;l>u;u++){!function(x){q.encodePacket(x,w.supportsBinary,function(B){if(!b){var A={};if(x.options&&(A.compress=x.options.compress),w.perMessageDeflate){var z="string"==typeof B?t.Buffer.byteLength(B):B.length;z<w.perMessageDeflate.threshold&&(A.compress=!1)}}try{b?w.ws.send(B):w.ws.send(B,A)}catch(y){m("websocket closed before onclose event")}--v||j()})}(k[u])}},s.prototype.onClose=function(){r.prototype.onClose.call(this)},s.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},s.prototype.uri=function(){var k=this.query||{},j=this.secure?"wss":"ws",u="";this.port&&("wss"==j&&443!=this.port||"ws"==j&&80!=this.port)&&(u=":"+this.port),this.timestampRequests&&(k[this.timestampParam]=n()),this.supportsBinary||(k.b64=1),k=p.encode(k),k.length&&(k="?"+k);var l=-1!==this.hostname.indexOf(":");return j+"://"+(l?"["+this.hostname+"]":this.hostname)+u+this.path+k},s.prototype.check=function(){return !(!a||"__initialize" in a&&this.name===s.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(g,f,j){var h=g("has-cors");f.exports=function(l){var k=l.xdomain,o=l.xscheme,n=l.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!k||h)){return new XMLHttpRequest}}catch(m){}try{if("undefined"!=typeof XDomainRequest&&!o&&n){return new XDomainRequest}}catch(m){}if(!k){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(m){}}}},{"has-cors":22}],11:[function(g,f,k){function j(m,l,p){function o(b,q){if(o.count<=0){throw new Error("after called too many times")}--o.count,b?(n=!0,l(b),l=p):0!==o.count||n||l(null,q)}var n=!1;return p=p||h,o.count=m,0===m?l():o}function h(){}f.exports=j},{}],12:[function(g,f,h){f.exports=function(k,j,q){var p=k.byteLength;if(j=j||0,q=q||p,k.slice){return k.slice(j,q)}if(0>j&&(j+=p),0>q&&(q+=p),q>p&&(q=p),j>=p||j>=q||0===p){return new ArrayBuffer(0)}for(var o=new Uint8Array(k),n=new Uint8Array(q-j),m=j,l=0;q>m;m++,l++){n[l]=o[m]}return n.buffer}},{}],13:[function(g,f,h){!function(b){h.encode=function(a){var m,l=new Uint8Array(a),k=l.length,j="";for(m=0;k>m;m+=3){j+=b[l[m]>>2],j+=b[(3&l[m])<<4|l[m+1]>>4],j+=b[(15&l[m+1])<<2|l[m+2]>>6],j+=b[63&l[m+2]]}return k%3===2?j=j.substring(0,j.length-1)+"=":k%3===1&&(j=j.substring(0,j.length-2)+"=="),j},h.decode=function(v){var u,t,s,r,q,p=0.75*v.length,o=v.length,n=0;"="===v[v.length-1]&&(p--,"="===v[v.length-2]&&p--);var m=new ArrayBuffer(p),a=new Uint8Array(m);for(u=0;o>u;u+=4){t=b.indexOf(v[u]),s=b.indexOf(v[u+1]),r=b.indexOf(v[u+2]),q=b.indexOf(v[u+3]),a[n++]=t<<2|s>>4,a[n++]=(15&s)<<4|r>>2,a[n++]=(3&r)<<6|63&q}return m}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(g,f,h){(function(b){function p(r){for(var q=0;q<r.length;q++){var u=r[q];if(u.buffer instanceof ArrayBuffer){var t=u.buffer;if(u.byteLength!==t.byteLength){var s=new Uint8Array(u.byteLength);s.set(new Uint8Array(t,u.byteOffset,u.byteLength)),t=s.buffer}r[q]=t}}}function o(r,q){q=q||{};var t=new m;p(r);for(var s=0;s<r.length;s++){t.append(r[s])}return q.type?t.getBlob(q.type):t.getBlob()}function n(r,q){return p(r),new Blob(r,q||{})}var m=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder,l=function(){try{var r=new Blob(["hi"]);return 2===r.size}catch(q){return !1}}(),k=l&&function(){try{var r=new Blob([new Uint8Array([1,2])]);return 2===r.size}catch(q){return !1}}(),j=m&&m.prototype.append&&m.prototype.getBlob;f.exports=function(){return l?k?b.Blob:n:j?o:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],15:[function(g,f,k){function j(b){return b?h(b):void 0}function h(m){for(var l in j.prototype){m[l]=j.prototype[l]}return m}f.exports=j,j.prototype.on=j.prototype.addEventListener=function(m,l){return this._callbacks=this._callbacks||{},(this._callbacks[m]=this._callbacks[m]||[]).push(l),this},j.prototype.once=function(m,l){function o(){n.off(m,o),l.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},o.fn=l,this.on(m,o),this},j.prototype.off=j.prototype.removeListener=j.prototype.removeAllListeners=j.prototype.removeEventListener=function(m,l){if(this._callbacks=this._callbacks||{},0==arguments.length){return this._callbacks={},this}var p=this._callbacks[m];if(!p){return this}if(1==arguments.length){return delete this._callbacks[m],this}for(var o,n=0;n<p.length;n++){if(o=p[n],o===l||o.fn===l){p.splice(n,1);break}}return this},j.prototype.emit=function(m){this._callbacks=this._callbacks||{};var l=[].slice.call(arguments,1),p=this._callbacks[m];if(p){p=p.slice(0);for(var o=0,n=p.length;n>o;++o){p[o].apply(this,l)}}return this},j.prototype.listeners=function(b){return this._callbacks=this._callbacks||{},this._callbacks[b]||[]},j.prototype.hasListeners=function(b){return !!this.listeners(b).length}},{}],16:[function(g,f,h){f.exports=function(k,j){var l=function(){};l.prototype=j.prototype,k.prototype=new l,k.prototype.constructor=k}},{}],17:[function(r,q,p){function o(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function n(){var h=arguments,g=this.useColors;if(h[0]=(g?"%c":"")+this.namespace+(g?" %c":" ")+h[0]+(g?"%c ":" ")+"+"+p.humanize(this.diff),!g){return h}var u="color: "+this.color;h=[h[0],u,"color: inherit"].concat(Array.prototype.slice.call(h,1));var t=0,s=0;return h[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(t++,"%c"===b&&(s=t))}),h.splice(s,0,u),h}function m(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function l(g){try{null==g?p.storage.removeItem("debug"):p.storage.debug=g}catch(f){}}function k(){var g;try{g=p.storage.debug}catch(f){}return g}function j(){try{return window.localStorage}catch(b){}}p=q.exports=r("./debug"),p.log=m,p.formatArgs=n,p.save=l,p.load=k,p.useColors=o,p.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:j(),p.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],p.formatters.j=function(b){return JSON.stringify(b)},p.enable(k())},{"./debug":18}],18:[function(v,u,t){function s(){return t.colors[l++%t.colors.length]}function r(h){function g(){}function k(){var x=k,w=+new Date,B=w-(m||w);x.diff=B,x.prev=m,x.curr=w,m=w,null==x.useColors&&(x.useColors=t.useColors()),null==x.color&&x.useColors&&(x.color=s());var A=Array.prototype.slice.call(arguments);A[0]=t.coerce(A[0]),"string"!=typeof A[0]&&(A=["%o"].concat(A));var z=0;A[0]=A[0].replace(/%([a-z%])/g,function(a,E){if("%%"===a){return a}z++;var D=t.formatters[E];if("function"==typeof D){var C=A[z];a=D.call(x,C),A.splice(z,1),z--}return a}),"function"==typeof t.formatArgs&&(A=t.formatArgs.apply(x,A));var y=k.log||t.log||console.log.bind(console);y.apply(x,A)}g.enabled=!1,k.enabled=!0;var j=t.enabled(h)?k:g;return j.namespace=h,j}function q(g){t.save(g);for(var f=(g||"").split(/[\s,]+/),j=f.length,h=0;j>h;h++){f[h]&&(g=f[h].replace(/\*/g,".*?"),"-"===g[0]?t.skips.push(new RegExp("^"+g.substr(1)+"$")):t.names.push(new RegExp("^"+g+"$")))}}function p(){t.enable("")}function o(g){var f,h;for(f=0,h=t.skips.length;h>f;f++){if(t.skips[f].test(g)){return !1}}for(f=0,h=t.names.length;h>f;f++){if(t.names[f].test(g)){return !0}}return !1}function n(b){return b instanceof Error?b.stack||b.message:b}t=u.exports=r,t.coerce=n,t.disable=p,t.enable=q,t.enabled=o,t.humanize=v("ms"),t.names=[],t.skips=[],t.formatters={};var m,l=0},{ms:25}],19:[function(g,f,h){(function(M){function L(k,j){var l="b"+h.packets[k.type]+k.data.data;return j(l)}function K(k,j,p){if(!j){return h.encodeBase64Packet(k,p)}var o=k.data,n=new Uint8Array(o),m=new Uint8Array(1+o.byteLength);m[0]=x[k.type];for(var l=0;l<n.length;l++){m[l+1]=n[l]}return p(m.buffer)}function J(k,j,m){if(!j){return h.encodeBase64Packet(k,m)}var l=new FileReader;return l.onload=function(){k.data=l.result,h.encodePacket(k,j,!0,m)},l.readAsArrayBuffer(k.data)}function I(k,j,n){if(!j){return h.encodeBase64Packet(k,n)}if(y){return J(k,j,n)}var m=new Uint8Array(1);m[0]=x[k.type];var l=new a([m.buffer,k.data]);return n(l)}function H(k,j,p){for(var o=new Array(k.length),n=C(k.length,p),m=function(b,r,q){j(r,function(s,t){o[b]=t,q(s,o)})},l=0;l<k.length;l++){m(l,k[l],n)}}var G=g("./keys"),F=g("has-binary"),E=g("arraybuffer.slice"),D=g("base64-arraybuffer"),C=g("after"),B=g("utf8"),A=navigator.userAgent.match(/Android/i),z=/PhantomJS/i.test(navigator.userAgent),y=A||z;h.protocol=3;var x=h.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},w=G(x),v={type:"error",data:"parser error"},a=g("blob");h.encodePacket=function(b,o,n,m){"function"==typeof o&&(m=o,o=!1),"function"==typeof n&&(m=n,n=null);var l=void 0===b.data?void 0:b.data.buffer||b.data;if(M.ArrayBuffer&&l instanceof ArrayBuffer){return K(b,o,m)}if(a&&l instanceof M.Blob){return I(b,o,m)}if(l&&l.base64){return L(b,m)}var k=x[b.type];return void 0!==b.data&&(k+=n?B.encode(String(b.data)):String(b.data)),m(""+k)},h.encodeBase64Packet=function(s,r){var q="b"+h.packets[s.type];if(a&&s.data instanceof M.Blob){var p=new FileReader;return p.onload=function(){var j=p.result.split(",")[1];r(q+j)},p.readAsDataURL(s.data)}var o;try{o=String.fromCharCode.apply(null,new Uint8Array(s.data))}catch(n){for(var m=new Uint8Array(s.data),l=new Array(m.length),b=0;b<m.length;b++){l[b]=m[b]}o=String.fromCharCode.apply(null,l)}return q+=M.btoa(o),r(q)},h.decodePacket=function(k,j,p){if("string"==typeof k||void 0===k){if("b"==k.charAt(0)){return h.decodeBase64Packet(k.substr(1),j)}if(p){try{k=B.decode(k)}catch(o){return v}}var n=k.charAt(0);return Number(n)==n&&w[n]?k.length>1?{type:w[n],data:k.substring(1)}:{type:w[n]}:v}var m=new Uint8Array(k),n=m[0],l=E(k,1);return a&&"blob"===j&&(l=new a([l])),{type:w[n],data:l}},h.decodeBase64Packet=function(b,l){var k=w[b.charAt(0)];if(!M.ArrayBuffer){return{type:k,data:{base64:!0,data:b.substr(1)}}}var j=D.decode(b.substr(1));return"blob"===l&&a&&(j=new a([j])),{type:k,data:j}},h.encodePayload=function(k,j,o){function n(b){return b.length+":"+b}function m(b,p){h.encodePacket(b,l?j:!1,!0,function(q){p(null,n(q))})}"function"==typeof j&&(o=j,j=null);var l=F(k);return j&&l?a&&!y?h.encodePayloadAsBlob(k,o):h.encodePayloadAsArrayBuffer(k,o):k.length?void H(k,m,function(q,p){return o(p.join(""))}):o("0:")},h.decodePayload=function(O,N,u){if("string"!=typeof O){return h.decodePayloadAsBinary(O,N,u)}"function"==typeof N&&(u=N,N=null);var t;if(""==O){return u(v,0,1)}for(var s,r,q="",p=0,o=O.length;o>p;p++){var n=O.charAt(p);if(":"!=n){q+=n}else{if(""==q||q!=(s=Number(q))){return u(v,0,1)}if(r=O.substr(p+1,s),q!=r.length){return u(v,0,1)}if(r.length){if(t=h.decodePacket(r,N,!0),v.type==t.type&&v.data==t.data){return u(v,0,1)}var m=u(t,p+s,o);if(!1===m){return}}p+=s,q=""}}return""!=q?u(v,0,1):void 0},h.encodePayloadAsArrayBuffer=function(k,j){function l(n,m){h.encodePacket(n,!0,!0,function(b){return m(null,b)})}return k.length?void H(k,l,function(b,p){var o=p.reduce(function(r,q){var s;return s="string"==typeof q?q.length:q.byteLength,r+s.toString().length+s+2},0),n=new Uint8Array(o),m=0;return p.forEach(function(r){var q="string"==typeof r,N=r;if(q){for(var u=new Uint8Array(r.length),t=0;t<r.length;t++){u[t]=r.charCodeAt(t)}N=u.buffer}q?n[m++]=0:n[m++]=1;for(var s=N.byteLength.toString(),t=0;t<s.length;t++){n[m++]=parseInt(s[t])}n[m++]=255;for(var u=new Uint8Array(N),t=0;t<u.length;t++){n[m++]=u[t]}}),j(n.buffer)}):j(new ArrayBuffer(0))},h.encodePayloadAsBlob=function(k,j){function l(n,m){h.encodePacket(n,!0,!0,function(b){var u=new Uint8Array(1);if(u[0]=1,"string"==typeof b){for(var t=new Uint8Array(b.length),s=0;s<b.length;s++){t[s]=b.charCodeAt(s)}b=t.buffer,u[0]=0}for(var r=b instanceof ArrayBuffer?b.byteLength:b.size,q=r.toString(),p=new Uint8Array(q.length+1),s=0;s<q.length;s++){p[s]=parseInt(q[s])}if(p[q.length]=255,a){var o=new a([u.buffer,p.buffer,b]);m(null,o)}})}H(k,l,function(b,m){return j(new a(m))})},h.decodePayloadAsBinary=function(U,T,S){"function"==typeof T&&(S=T,T=null);for(var R=U,Q=[],P=!1;R.byteLength>0;){for(var O=new Uint8Array(R),N=0===O[0],u="",t=1;255!=O[t];t++){if(u.length>310){P=!0;break}u+=O[t]}if(P){return S(v,0,1)}R=E(R,2+u.length),u=parseInt(u);var s=E(R,0,u);if(N){try{s=String.fromCharCode.apply(null,new Uint8Array(s))}catch(r){var q=new Uint8Array(s);s="";for(var t=0;t<q.length;t++){s+=String.fromCharCode(q[t])}}}Q.push(s),R=E(R,u)}var k=Q.length;Q.forEach(function(b,j){S(h.decodePacket(b,T,!0),j,k)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(g,f,h){f.exports=Object.keys||function(k){var j=[],m=Object.prototype.hasOwnProperty;for(var l in k){m.call(k,l)&&j.push(l)}return j}},{}],21:[function(g,f,h){(function(j){function b(l){function k(m){if(!m){return !1}if(j.Buffer&&j.Buffer.isBuffer(m)||j.ArrayBuffer&&m instanceof ArrayBuffer||j.Blob&&m instanceof Blob||j.File&&m instanceof File){return !0}if(a(m)){for(var o=0;o<m.length;o++){if(k(m[o])){return !0}}}else{if(m&&"object"==typeof m){m.toJSON&&(m=m.toJSON());for(var n in m){if(Object.prototype.hasOwnProperty.call(m,n)&&k(m[n])){return !0}}}}return !1}return k(l)}var a=g("isarray");f.exports=b}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:24}],22:[function(g,f,j){try{f.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials" in new XMLHttpRequest}catch(h){f.exports=!1}},{}],23:[function(g,f,j){var h=[].indexOf;f.exports=function(l,k){if(h){return l.indexOf(k)}for(var m=0;m<l.length;++m){if(l[m]===k){return m}}return -1}},{}],24:[function(g,f,h){f.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],25:[function(x,w,v){function u(g){if(g=""+g,!(g.length>10000)){var f=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(g);if(f){var j=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return j*m;case"days":case"day":case"d":return j*n;case"hours":case"hour":case"hrs":case"hr":case"h":return j*o;case"minutes":case"minute":case"mins":case"min":case"m":return j*p;case"seconds":case"second":case"secs":case"sec":case"s":return j*q;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return j}}}}function t(b){return b>=n?Math.round(b/n)+"d":b>=o?Math.round(b/o)+"h":b>=p?Math.round(b/p)+"m":b>=q?Math.round(b/q)+"s":b+"ms"}function s(b){return r(b,n,"day")||r(b,o,"hour")||r(b,p,"minute")||r(b,q,"second")||b+" ms"}function r(g,f,h){return f>g?void 0:1.5*f>g?Math.floor(g/f)+" "+h:Math.ceil(g/f)+" "+h+"s"}var q=1000,p=60*q,o=60*p,n=24*o,m=365.25*n;w.exports=function(g,f){return f=f||{},"string"==typeof g?u(g):f["long"]?s(g):t(g)}},{}],26:[function(g,f,h){(function(b){var o=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,m=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,l=/(?:^|:|,)(?:\s*\[)+/g,k=/^\s+/,j=/\s+$/;f.exports=function(a){return"string"==typeof a&&a?(a=a.replace(k,"").replace(j,""),b.JSON&&JSON.parse?JSON.parse(a):o.test(a.replace(n,"@").replace(m,"]").replace(l,""))?new Function("return "+a)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],27:[function(g,f,h){h.encode=function(k){var j="";for(var l in k){k.hasOwnProperty(l)&&(j.length&&(j+="&"),j+=encodeURIComponent(l)+"="+encodeURIComponent(k[l]))}return j},h.decode=function(k){for(var j={},o=k.split("&"),n=0,m=o.length;m>n;n++){var l=o[n].split("=");j[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}return j}},{}],28:[function(g,f,k){var j=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];f.exports=function(m){var l=m,r=m.indexOf("["),q=m.indexOf("]");-1!=r&&-1!=q&&(m=m.substring(0,r)+m.substring(r,q).replace(/:/g,";")+m.substring(q,m.length));for(var p=j.exec(m||""),o={},n=14;n--;){o[h[n]]=p[n]||""}return -1!=r&&-1!=q&&(o.source=l,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o}},{}],29:[function(a,g,f){(function(h){!function(S){function R(k){for(var j,o,n=[],m=0,l=k.length;l>m;){j=k.charCodeAt(m++),j>=55296&&56319>=j&&l>m?(o=k.charCodeAt(m++),56320==(64512&o)?n.push(((1023&j)<<10)+(1023&o)+65536):(n.push(j),m--)):n.push(j)}return n}function Q(k){for(var j,n=k.length,m=-1,l="";++m<n;){j=k[m],j>65535&&(j-=65536,l+=C(j>>>10&1023|55296),j=56320|1023&j),l+=C(j)}return l}function P(j){if(j>=55296&&57343>=j){throw Error("Lone surrogate U+"+j.toString(16).toUpperCase()+" is not a scalar value")}}function O(k,j){return C(k>>j&63|128)}function N(k){if(0==(4294967168&k)){return C(k)}var j="";return 0==(4294965248&k)?j=C(k>>6&31|192):0==(4294901760&k)?(P(k),j=C(k>>12&15|224),j+=O(k,6)):0==(4292870144&k)&&(j=C(k>>18&7|240),j+=O(k,12),j+=O(k,6)),j+=C(63&k|128)}function M(k){for(var j,o=R(k),n=o.length,m=-1,l="";++m<n;){j=o[m],l+=N(j)}return l}function L(){if(D>=E){throw Error("Invalid byte index")}var j=255&F[D];if(D++,128==(192&j)){return 63&j}throw Error("Invalid continuation byte")}function K(){var k,j,n,m,l;if(D>E){throw Error("Invalid byte index")}if(D==E){return !1}if(k=255&F[D],D++,0==(128&k)){return k}if(192==(224&k)){var j=L();if(l=(31&k)<<6|j,l>=128){return l}throw Error("Invalid continuation byte")}if(224==(240&k)){if(j=L(),n=L(),l=(15&k)<<12|j<<6|n,l>=2048){return P(l),l}throw Error("Invalid continuation byte")}if(240==(248&k)&&(j=L(),n=L(),m=L(),l=(15&k)<<18|j<<12|n<<6|m,l>=65536&&1114111>=l)){return l}throw Error("Invalid UTF-8 detected")}function J(k){F=R(k),E=F.length,D=0;for(var j,l=[];(j=K())!==!1;){l.push(j)}return Q(l)}var I="object"==typeof f&&f,H="object"==typeof g&&g&&g.exports==I&&g,G="object"==typeof h&&h;(G.global===G||G.window===G)&&(S=G);var F,E,D,C=String.fromCharCode,B={version:"2.0.0",encode:M,decode:J};if("function"==typeof e&&"object"==typeof e.amd&&e.amd){e(function(){return B})}else{if(I&&!I.nodeType){if(H){H.exports=B}else{var A={},z=A.hasOwnProperty;for(var b in B){z.call(B,b)&&(I[b]=B[b])}}}else{S.utf8=B}}}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],30:[function(x,w,v){function u(g){var f="";do{f=q[g%p]+f,g=Math.floor(g/p)}while(g>0);return f}function t(g){var f=0;for(m=0;m<g.length;m++){f=f*p+o[g.charAt(m)]}return f}function s(){var b=u(+new Date);return b!==r?(n=0,r=b):b+"."+u(n++)}for(var r,q="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),p=64,o={},n=0,m=0;p>m;m++){o[q[m]]=m}s.encode=u,s.decode=t,w.exports=s},{}],31:[function(r,q,p){function o(y,x){"object"==typeof y&&(x=y,y=void 0),x=x||{};var w,v=n(y),u=v.source,t=v.id,s=v.path,h=j[t]&&s in j[t].nsps,g=x.forceNew||x["force new connection"]||!1===x.multiplex||h;return g?(k("ignoring socket cache for %s",u),w=l(u,x)):(j[t]||(k("new io instance for %s",u),j[t]=l(u,x)),w=j[t]),w.socket(v.path)}var n=r("./url"),m=r("socket.io-parser"),l=r("./manager"),k=r("debug")("socket.io-client");q.exports=p=o;var j=p.managers={};p.protocol=m.protocol,p.connect=o,p.Manager=r("./manager"),p.Socket=r("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(B,A,z){function y(g,f){return this instanceof y?(g&&"object"==typeof g&&(f=g,g=void 0),f=f||{},f.path=f.path||"/socket.io",this.nsps={},this.subs=[],this.opts=f,this.reconnection(f.reconnection!==!1),this.reconnectionAttempts(f.reconnectionAttempts||1/0),this.reconnectionDelay(f.reconnectionDelay||1000),this.reconnectionDelayMax(f.reconnectionDelayMax||5000),this.randomizationFactor(f.randomizationFactor||0.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==f.timeout?20000:f.timeout),this.readyState="closed",this.uri=g,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new u.Encoder,this.decoder=new u.Decoder,this.autoConnect=f.autoConnect!==!1,void (this.autoConnect&&this.open())):new y(g,f)}var x=B("engine.io-client"),w=B("./socket"),v=B("component-emitter"),u=B("socket.io-parser"),t=B("./on"),s=B("component-bind"),r=B("debug")("socket.io-client:manager"),q=B("indexof"),p=B("backo2"),o=Object.prototype.hasOwnProperty;A.exports=y,y.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps){o.call(this.nsps,b)&&this.nsps[b].emit.apply(this.nsps[b],arguments)}},y.prototype.updateSocketIds=function(){for(var b in this.nsps){o.call(this.nsps,b)&&(this.nsps[b].id=this.engine.id)}},v(y.prototype),y.prototype.reconnection=function(b){return arguments.length?(this._reconnection=!!b,this):this._reconnection},y.prototype.reconnectionAttempts=function(b){return arguments.length?(this._reconnectionAttempts=b,this):this._reconnectionAttempts},y.prototype.reconnectionDelay=function(b){return arguments.length?(this._reconnectionDelay=b,this.backoff&&this.backoff.setMin(b),this):this._reconnectionDelay},y.prototype.randomizationFactor=function(b){return arguments.length?(this._randomizationFactor=b,this.backoff&&this.backoff.setJitter(b),this):this._randomizationFactor},y.prototype.reconnectionDelayMax=function(b){return arguments.length?(this._reconnectionDelayMax=b,this.backoff&&this.backoff.setMax(b),this):this._reconnectionDelayMax},y.prototype.timeout=function(b){return arguments.length?(this._timeout=b,this):this._timeout},y.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},y.prototype.open=y.prototype.connect=function(k){if(r("readyState %s",this.readyState),~this.readyState.indexOf("open")){return this}r("opening %s",this.uri),this.engine=x(this.uri,this.opts);var j=this.engine,D=this;this.readyState="opening",this.skipReconnect=!1;var C=t(j,"open",function(){D.onopen(),k&&k()}),n=t(j,"error",function(a){if(r("connect_error"),D.cleanup(),D.readyState="closed",D.emitAll("connect_error",a),k){var f=new Error("Connection error");f.data=a,k(f)}else{D.maybeReconnectOnOpen()}});if(!1!==this._timeout){var m=this._timeout;r("connect attempt will timeout after %d",m);var l=setTimeout(function(){r("connect attempt timed out after %d",m),C.destroy(),j.close(),j.emit("error","timeout"),D.emitAll("connect_timeout",m)},m);this.subs.push({destroy:function(){clearTimeout(l)}})}return this.subs.push(C),this.subs.push(n),this},y.prototype.onopen=function(){r("open"),this.cleanup(),this.readyState="open",this.emit("open");var b=this.engine;this.subs.push(t(b,"data",s(this,"ondata"))),this.subs.push(t(b,"ping",s(this,"onping"))),this.subs.push(t(b,"pong",s(this,"onpong"))),this.subs.push(t(b,"error",s(this,"onerror"))),this.subs.push(t(b,"close",s(this,"onclose"))),this.subs.push(t(this.decoder,"decoded",s(this,"ondecoded")))},y.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},y.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},y.prototype.ondata=function(b){this.decoder.add(b)},y.prototype.ondecoded=function(b){this.emit("packet",b)},y.prototype.onerror=function(b){r("error",b),this.emitAll("error",b)},y.prototype.socket=function(g){function f(){~q(h.connecting,j)||h.connecting.push(j)}var j=this.nsps[g];if(!j){j=new w(this,g),this.nsps[g]=j;var h=this;j.on("connecting",f),j.on("connect",function(){j.id=h.engine.id}),this.autoConnect&&f()}return j},y.prototype.destroy=function(g){var f=q(this.connecting,g);~f&&this.connecting.splice(f,1),this.connecting.length||this.close()},y.prototype.packet=function(g){r("writing packet %j",g);var f=this;f.encoding?f.packetBuffer.push(g):(f.encoding=!0,this.encoder.encode(g,function(b){for(var a=0;a<b.length;a++){f.engine.write(b[a],g.options)}f.encoding=!1,f.processPacketQueue()}))},y.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}},y.prototype.cleanup=function(){r("cleanup");for(var b;b=this.subs.shift();){b.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},y.prototype.close=y.prototype.disconnect=function(){r("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},y.prototype.onclose=function(b){r("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",b),this._reconnection&&!this.skipReconnect&&this.reconnect()},y.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect){return this}var g=this;if(this.backoff.attempts>=this._reconnectionAttempts){r("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1}else{var f=this.backoff.duration();r("will wait %dms before reconnect attempt",f),this.reconnecting=!0;var h=setTimeout(function(){g.skipReconnect||(r("attempting reconnect"),g.emitAll("reconnect_attempt",g.backoff.attempts),g.emitAll("reconnecting",g.backoff.attempts),g.skipReconnect||g.open(function(a){a?(r("reconnect attempt error"),g.reconnecting=!1,g.reconnect(),g.emitAll("reconnect_error",a.data)):(r("reconnect success"),g.onreconnect())}))},f);this.subs.push({destroy:function(){clearTimeout(h)}})}},y.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",b)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(g,f,j){function h(l,k,m){return l.on(k,m),{destroy:function(){l.removeListener(k,m)}}}f.exports=h},{}],34:[function(z,y,x){function w(g,f){this.io=g,this.nsp=f,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var v=z("socket.io-parser"),u=z("component-emitter"),t=z("to-array"),s=z("./on"),r=z("component-bind"),q=z("debug")("socket.io-client:socket"),p=z("has-binary");y.exports=x=w;var o={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},n=u.prototype.emit;u(w.prototype),w.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=[s(b,"open",r(this,"onopen")),s(b,"packet",r(this,"onpacket")),s(b,"close",r(this,"onclose"))]}},w.prototype.open=w.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},w.prototype.send=function(){var b=t(arguments);return b.unshift("message"),this.emit.apply(this,b),this},w.prototype.emit=function(g){if(o.hasOwnProperty(g)){return n.apply(this,arguments),this}var f=t(arguments),j=v.EVENT;p(f)&&(j=v.BINARY_EVENT);var h={type:j,data:f};return h.options={},h.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof f[f.length-1]&&(q("emitting packet with ack id %d",this.ids),this.acks[this.ids]=f.pop(),h.id=this.ids++),this.connected?this.packet(h):this.sendBuffer.push(h),delete this.flags,this},w.prototype.packet=function(b){b.nsp=this.nsp,this.io.packet(b)},w.prototype.onopen=function(){q("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:v.CONNECT})},w.prototype.onclose=function(b){q("close (%s)",b),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",b)},w.prototype.onpacket=function(b){if(b.nsp==this.nsp){switch(b.type){case v.CONNECT:this.onconnect();break;case v.EVENT:this.onevent(b);break;case v.BINARY_EVENT:this.onevent(b);break;case v.ACK:this.onack(b);break;case v.BINARY_ACK:this.onack(b);break;case v.DISCONNECT:this.ondisconnect();break;case v.ERROR:this.emit("error",b.data)}}},w.prototype.onevent=function(g){var f=g.data||[];q("emitting event %j",f),null!=g.id&&(q("attaching ack callback to event"),f.push(this.ack(g.id))),this.connected?n.apply(this,f):this.receiveBuffer.push(f)},w.prototype.ack=function(g){var f=this,h=!1;return function(){if(!h){h=!0;var b=t(arguments);q("sending ack %j",b);var a=p(b)?v.BINARY_ACK:v.ACK;f.packet({type:a,id:g,data:b})}}},w.prototype.onack=function(g){var f=this.acks[g.id];"function"==typeof f?(q("calling ack %s with %j",g.id,g.data),f.apply(this,g.data),delete this.acks[g.id]):q("bad ack %s",g.id)},w.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},w.prototype.emitBuffered=function(){var b;for(b=0;b<this.receiveBuffer.length;b++){n.apply(this,this.receiveBuffer[b])}for(this.receiveBuffer=[],b=0;b<this.sendBuffer.length;b++){this.packet(this.sendBuffer[b])}this.sendBuffer=[]},w.prototype.ondisconnect=function(){q("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},w.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++){this.subs[b].destroy()}this.subs=null}this.io.destroy(this)},w.prototype.close=w.prototype.disconnect=function(){return this.connected&&(q("performing disconnect (%s)",this.nsp),this.packet({type:v.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},w.prototype.compress=function(b){return this.flags=this.flags||{},this.flags.compress=b,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(g,f,h){(function(k){function j(m,l){var p=m,l=l||k.location;null==m&&(m=l.protocol+"//"+l.host),"string"==typeof m&&("/"==m.charAt(0)&&(m="/"==m.charAt(1)?l.protocol+m:l.host+m),/^(https?|wss?):\/\//.test(m)||(a("protocol-less url %s",m),m="undefined"!=typeof l?l.protocol+"//"+m:"https://"+m),a("parse %s",m),p=b(m)),p.port||(/^(http|ws)$/.test(p.protocol)?p.port="80":/^(http|ws)s$/.test(p.protocol)&&(p.port="443")),p.path=p.path||"/";var o=-1!==p.host.indexOf(":"),n=o?"["+p.host+"]":p.host;return p.id=p.protocol+"://"+n+":"+p.port,p.href=p.protocol+"://"+n+(l&&l.port==p.port?"":":"+p.port),p}var b=g("parseuri"),a=g("debug")("socket.io-client:url");f.exports=j}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:39,parseuri:45}],36:[function(g,f,j){function h(b){b=b||{},this.ms=b.min||100,this.max=b.max||10000,this.factor=b.factor||2,this.jitter=b.jitter>0&&b.jitter<=1?b.jitter:0,this.attempts=0}f.exports=h,h.prototype.duration=function(){var l=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var k=Math.random(),m=Math.floor(k*this.jitter*l);l=0==(1&Math.floor(10*k))?l-m:l+m}return 0|Math.min(l,this.max)},h.prototype.reset=function(){this.attempts=0},h.prototype.setMin=function(b){this.ms=b},h.prototype.setMax=function(b){this.max=b},h.prototype.setJitter=function(b){this.jitter=b}},{}],37:[function(g,f,j){var h=[].slice;f.exports=function(l,k){if("string"==typeof k&&(k=l[k]),"function"!=typeof k){throw new Error("bind() requires a function")}var m=h.call(arguments,2);return function(){return k.apply(l,m.concat(h.call(arguments)))}}},{}],38:[function(g,f,k){function j(b){return b?h(b):void 0}function h(m){for(var l in j.prototype){m[l]=j.prototype[l]}return m}f.exports=j,j.prototype.on=j.prototype.addEventListener=function(m,l){return this._callbacks=this._callbacks||{},(this._callbacks["$"+m]=this._callbacks["$"+m]||[]).push(l),this},j.prototype.once=function(m,l){function n(){this.off(m,n),l.apply(this,arguments)}return n.fn=l,this.on(m,n),this},j.prototype.off=j.prototype.removeListener=j.prototype.removeAllListeners=j.prototype.removeEventListener=function(m,l){if(this._callbacks=this._callbacks||{},0==arguments.length){return this._callbacks={},this}var p=this._callbacks["$"+m];if(!p){return this}if(1==arguments.length){return delete this._callbacks["$"+m],this}for(var o,n=0;n<p.length;n++){if(o=p[n],o===l||o.fn===l){p.splice(n,1);break}}return this},j.prototype.emit=function(m){this._callbacks=this._callbacks||{};var l=[].slice.call(arguments,1),p=this._callbacks["$"+m];if(p){p=p.slice(0);for(var o=0,n=p.length;n>o;++o){p[o].apply(this,l)}}return this},j.prototype.listeners=function(b){return this._callbacks=this._callbacks||{},this._callbacks["$"+b]||[]},j.prototype.hasListeners=function(b){return !!this.listeners(b).length}},{}],39:[function(g,f,h){arguments[4][17][0].apply(h,arguments)},{"./debug":40,dup:17}],40:[function(g,f,h){arguments[4][18][0].apply(h,arguments)},{dup:18,ms:44}],41:[function(g,f,h){(function(j){function b(l){function k(m){if(!m){return !1}if(j.Buffer&&j.Buffer.isBuffer&&j.Buffer.isBuffer(m)||j.ArrayBuffer&&m instanceof ArrayBuffer||j.Blob&&m instanceof Blob||j.File&&m instanceof File){return !0}if(a(m)){for(var o=0;o<m.length;o++){if(k(m[o])){return !0}}}else{if(m&&"object"==typeof m){m.toJSON&&"function"==typeof m.toJSON&&(m=m.toJSON());for(var n in m){if(Object.prototype.hasOwnProperty.call(m,n)&&k(m[n])){return !0}}}}return !1}return k(l)}var a=g("isarray");f.exports=b}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:43}],42:[function(g,f,h){arguments[4][23][0].apply(h,arguments)},{dup:23}],43:[function(g,f,h){arguments[4][24][0].apply(h,arguments)},{dup:24}],44:[function(g,f,h){arguments[4][25][0].apply(h,arguments)},{dup:25}],45:[function(g,f,h){arguments[4][28][0].apply(h,arguments)},{dup:28}],46:[function(g,f,h){(function(a){var k=g("isarray"),j=g("./is-buffer");h.deconstructPacket=function(m){function l(b){if(!b){return b}if(j(b)){var t={_placeholder:!0,num:p.length};return p.push(b),t}if(k(b)){for(var s=new Array(b.length),r=0;r<b.length;r++){s[r]=l(b[r])}return s}if("object"==typeof b&&!(b instanceof Date)){var s={};for(var q in b){s[q]=l(b[q])}return s}return b}var p=[],o=m.data,n=m;return n.data=l(o),n.attachments=p.length,{packet:n,buffers:p}},h.reconstructPacket=function(m,l){function n(b){if(b&&b._placeholder){var q=l[b.num];return q}if(k(b)){for(var p=0;p<b.length;p++){b[p]=n(b[p])}return b}if(b&&"object"==typeof b){for(var o in b){b[o]=n(b[o])}return b}return b}return m.data=n(m.data),m.attachments=void 0,m},h.removeBlobs=function(b,o){function n(r,u,t){if(!r){return r}if(a.Blob&&r instanceof Blob||a.File&&r instanceof File){m++;var s=new FileReader;s.onload=function(){t?t[u]=this.result:l=this.result,--m||o(l)},s.readAsArrayBuffer(r)}else{if(k(r)){for(var q=0;q<r.length;q++){n(r[q],q,r)}}else{if(r&&"object"==typeof r&&!j(r)){for(var p in r){n(r[p],p,r)}}}}}var m=0,l=b;n(l),m||o(l)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":48,isarray:43}],47:[function(D,C,B){function A(){}function z(g){var f="",h=!1;return f+=g.type,(B.BINARY_EVENT==g.type||B.BINARY_ACK==g.type)&&(f+=g.attachments,f+="-"),g.nsp&&"/"!=g.nsp&&(h=!0,f+=g.nsp),null!=g.id&&(h&&(f+=",",h=!1),f+=g.id),null!=g.data&&(h&&(f+=","),f+=s.stringify(g.data)),t("encoded %j as %s",g,f),f}function y(g,f){function h(b){var l=q.deconstructPacket(b),k=z(l.packet),j=l.buffers;j.unshift(k),f(j)}q.removeBlobs(g,h)}function x(){this.reconstructor=null}function w(k){var j={},E=0;if(j.type=Number(k.charAt(0)),null==B.types[j.type]){return u()}if(B.BINARY_EVENT==j.type||B.BINARY_ACK==j.type){for(var o="";"-"!=k.charAt(++E)&&(o+=k.charAt(E),E!=k.length);){}if(o!=Number(o)||"-"!=k.charAt(E)){throw new Error("Illegal attachments")}j.attachments=Number(o)}if("/"==k.charAt(E+1)){for(j.nsp="";++E;){var n=k.charAt(E);if(","==n){break}if(j.nsp+=n,E==k.length){break}}}else{j.nsp="/"}var m=k.charAt(E+1);if(""!==m&&Number(m)==m){for(j.id="";++E;){var n=k.charAt(E);if(null==n||Number(n)!=n){--E;break}if(j.id+=k.charAt(E),E==k.length){break}}j.id=Number(j.id)}if(k.charAt(++E)){try{j.data=s.parse(k.substr(E))}catch(l){return u()}}return t("decoded %s as %j",k,j),j}function v(b){this.reconPack=b,this.buffers=[]}function u(b){return{type:B.ERROR,data:"parser error"}}var t=D("debug")("socket.io-parser"),s=D("json3"),r=(D("isarray"),D("component-emitter")),q=D("./binary"),p=D("./is-buffer");B.protocol=4,B.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],B.CONNECT=0,B.DISCONNECT=1,B.EVENT=2,B.ACK=3,B.ERROR=4,B.BINARY_EVENT=5,B.BINARY_ACK=6,B.Encoder=A,B.Decoder=x,A.prototype.encode=function(g,f){if(t("encoding packet %j",g),B.BINARY_EVENT==g.type||B.BINARY_ACK==g.type){y(g,f)}else{var h=z(g);f([h])}},r(x.prototype),x.prototype.add=function(g){var f;if("string"==typeof g){f=w(g),B.BINARY_EVENT==f.type||B.BINARY_ACK==f.type?(this.reconstructor=new v(f),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",f)):this.emit("decoded",f)}else{if(!p(g)&&!g.base64){throw new Error("Unknown type: "+g)}if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}f=this.reconstructor.takeBinaryData(g),f&&(this.reconstructor=null,this.emit("decoded",f))}},x.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},v.prototype.takeBinaryData=function(g){if(this.buffers.push(g),this.buffers.length==this.reconPack.attachments){var f=q.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),f}return null},v.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(g,f,h){(function(b){function j(a){return b.Buffer&&b.Buffer.isBuffer(a)||b.ArrayBuffer&&a instanceof ArrayBuffer}f.exports=j}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],49:[function(g,f,h){arguments[4][15][0].apply(h,arguments)},{dup:15}],50:[function(a,g,f){(function(h){(function(){function w(aL,aK){function aJ(E){if(aJ[E]!==ay){return aJ[E]}var D;if("bug-string-char-index"==E){D="a"!="a"[0]}else{if("json"==E){D=aJ("json-stringify")&&aJ("json-parse")}else{var C,B='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==E){var A=aK.stringify,z="function"==typeof A&&av;if(z){(C=function(){return 1}).toJSON=C;try{z="0"===A(0)&&"0"===A(new aI)&&'""'==A(new aH)&&A(aw)===ay&&A(ay)===ay&&A()===ay&&"1"===A(C)&&"[1]"==A([C])&&"[null]"==A([ay])&&"null"==A(null)&&"[null,null,null]"==A([ay,aw,null])&&A({a:[C,!0,!1,null,"\x00\b\n\f\r	"]})==B&&"1"===A(null,C)&&"[\n 1,\n 2\n]"==A([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==A(new aF(-8640000000000000))&&'"+275760-09-13T00:00:00.000Z"'==A(new aF(8640000000000000))&&'"-000001-01-01T00:00:00.000Z"'==A(new aF(-62198755200000))&&'"1969-12-31T23:59:59.999Z"'==A(new aF(-1))}catch(y){z=!1}}D=z}if("json-parse"==E){var x=aK.parse;if("function"==typeof x){try{if(0===x("0")&&!x(!1)){C=x(B);var j=5==C.a.length&&1===C.a[0];if(j){try{j=!x('"	"')}catch(y){}if(j){try{j=1!==x("01")}catch(y){}}if(j){try{j=1!==x("1.")}catch(y){}}}}}catch(y){j=!1}}D=j}}}return aJ[E]=!!D}aL||(aL=s.Object()),aK||(aK=s.Object());var aI=aL.Number||s.Number,aH=aL.String||s.String,aG=aL.Object||s.Object,aF=aL.Date||s.Date,aE=aL.SyntaxError||s.SyntaxError,aD=aL.TypeError||s.TypeError,aC=aL.Math||s.Math,aB=aL.JSON||s.JSON;"object"==typeof aB&&aB&&(aK.stringify=aB.stringify,aK.parse=aB.parse);var aA,az,ay,ax=aG.prototype,aw=ax.toString,av=new aF(-3509827334573292);try{av=-109252==av.getUTCFullYear()&&0===av.getUTCMonth()&&1===av.getUTCDate()&&10==av.getUTCHours()&&37==av.getUTCMinutes()&&6==av.getUTCSeconds()&&708==av.getUTCMilliseconds()}catch(au){}if(!aJ("json")){var at="[object Function]",ar="[object Date]",aq="[object Number]",ap="[object String]",ao="[object Array]",an="[object Boolean]",am=aJ("bug-string-char-index");if(!av){var al=aC.floor,ak=[0,31,59,90,120,151,181,212,243,273,304,334],aj=function(k,j){return ak[j]+365*(k-1970)+al((k-1969+(j=+(j>1)))/4)-al((k-1901+j)/100)+al((k-1601+j)/400)}}if((aA=ax.hasOwnProperty)||(aA=function(k){var j,l={};return(l.__proto__=null,l.__proto__={toString:1},l).toString!=aw?aA=function(n){var m=this.__proto__,x=n in (this.__proto__=null,this);return this.__proto__=m,x}:(j=l.constructor,aA=function(m){var n=(this.constructor||j).prototype;return m in this&&!(m in n&&this[m]===n[m])}),l=null,aA.call(this,k)}),az=function(k,j){var x,n,m,l=0;(x=function(){this.valueOf=0}).prototype.valueOf=0,n=new x;for(m in n){aA.call(n,m)&&l++}return x=n=null,l?az=2==l?function(z,y){var C,B={},A=aw.call(z)==at;for(C in z){A&&"prototype"==C||aA.call(B,C)||!(B[C]=1)||!aA.call(z,C)||y(C)}}:function(z,y){var C,B,A=aw.call(z)==at;for(C in z){A&&"prototype"==C||!aA.call(z,C)||(B="constructor"===C)||y(C)}(B||aA.call(z,C="constructor"))&&y(C)}:(n=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],az=function(z,y){var D,C,B=aw.call(z)==at,A=!B&&"function"!=typeof z.constructor&&u[typeof z.hasOwnProperty]&&z.hasOwnProperty||aA;for(D in z){B&&"prototype"==D||!A.call(z,D)||y(D)}for(C=n.length;D=n[--C];A.call(z,D)&&y(D)){}}),az(k,j)},!aJ("json-stringify")){var ai={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},ah="000000",ag=function(k,j){return(ah+(j||0)).slice(-k)},af="\\u00",ae=function(k){for(var j='"',y=0,x=k.length,n=!am||x>10,m=n&&(am?k.split(""):k);x>y;y++){var l=k.charCodeAt(y);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:j+=ai[l];break;default:if(32>l){j+=af+ag(2,l.toString(16));break}j+=n?m[y]:k.charAt(y)}}return j+'"'},ad=function(aS,aR,aQ,aP,aO,aN,aM){var T,S,R,Q,P,O,K,H,E,A,N,J,C,z,y,x;try{T=aR[aS]}catch(l){}if("object"==typeof T&&T){if(S=aw.call(T),S!=ar||aA.call(T,"toJSON")){"function"==typeof T.toJSON&&(S!=aq&&S!=ap&&S!=ao||aA.call(T,"toJSON"))&&(T=T.toJSON(aS))}else{if(T>-1/0&&1/0>T){if(aj){for(P=al(T/86400000),R=al(P/365.2425)+1970-1;aj(R+1,0)<=P;R++){}for(Q=al((P-aj(R,0))/30.42);aj(R,Q+1)<=P;Q++){}P=1+P-aj(R,Q),O=(T%86400000+86400000)%86400000,K=al(O/3600000)%24,H=al(O/60000)%60,E=al(O/1000)%60,A=O%1000}else{R=T.getUTCFullYear(),Q=T.getUTCMonth(),P=T.getUTCDate(),K=T.getUTCHours(),H=T.getUTCMinutes(),E=T.getUTCSeconds(),A=T.getUTCMilliseconds()}T=(0>=R||R>=10000?(0>R?"-":"+")+ag(6,0>R?-R:R):ag(4,R))+"-"+ag(2,Q+1)+"-"+ag(2,P)+"T"+ag(2,K)+":"+ag(2,H)+":"+ag(2,E)+"."+ag(3,A)+"Z"}else{T=null}}}if(aQ&&(T=aQ.call(aR,aS,T)),null===T){return"null"}if(S=aw.call(T),S==an){return""+T}if(S==aq){return T>-1/0&&1/0>T?""+T:"null"}if(S==ap){return ae(""+T)}if("object"==typeof T){for(z=aM.length;z--;){if(aM[z]===T){throw aD()}}if(aM.push(T),N=[],y=aN,aN+=aO,S==ao){for(C=0,z=T.length;z>C;C++){J=ad(C,T,aQ,aP,aO,aN,aM),N.push(J===ay?"null":J)}x=N.length?aO?"[\n"+aN+N.join(",\n"+aN)+"\n"+y+"]":"["+N.join(",")+"]":"[]"}else{az(aP||T,function(k){var j=ad(k,T,aQ,aP,aO,aN,aM);j!==ay&&N.push(ae(k)+":"+(aO?" ":"")+j)}),x=N.length?aO?"{\n"+aN+N.join(",\n"+aN)+"\n"+y+"}":"{"+N.join(",")+"}":"{}"}return aM.pop(),x}};aK.stringify=function(D,C,B){var A,z,y,x;if(u[typeof C]&&C){if((x=aw.call(C))==at){z=C}else{if(x==ao){y={};for(var n,m=0,l=C.length;l>m;n=C[m++],x=aw.call(n),(x==ap||x==aq)&&(y[n]=1)){}}}}if(B){if((x=aw.call(B))==aq){if((B-=B%1)>0){for(A="",B>10&&(B=10);A.length<B;A+=" "){}}}else{x==ap&&(A=B.length<=10?B:B.slice(0,10))}}return ad("",(n={},n[""]=D,n),z,y,A,"",[])}}if(!aJ("json-parse")){var ac,ab,aa=aH.fromCharCode,Z={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},Y=function(){throw ac=ab=null,aE()},X=function(){for(var k,j,y,x,n,m=ab,l=m.length;l>ac;){switch(n=m.charCodeAt(ac)){case 9:case 10:case 13:case 32:ac++;break;case 123:case 125:case 91:case 93:case 58:case 44:return k=am?m.charAt(ac):m[ac],ac++,k;case 34:for(k="@",ac++;l>ac;){if(n=m.charCodeAt(ac),32>n){Y()}else{if(92==n){switch(n=m.charCodeAt(++ac)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:k+=Z[n],ac++;break;case 117:for(j=++ac,y=ac+4;y>ac;ac++){n=m.charCodeAt(ac),n>=48&&57>=n||n>=97&&102>=n||n>=65&&70>=n||Y()}k+=aa("0x"+m.slice(j,ac));break;default:Y()}}else{if(34==n){break}for(n=m.charCodeAt(ac),j=ac;n>=32&&92!=n&&34!=n;){n=m.charCodeAt(++ac)}k+=m.slice(j,ac)}}}if(34==m.charCodeAt(ac)){return ac++,k}Y();default:if(j=ac,45==n&&(x=!0,n=m.charCodeAt(++ac)),n>=48&&57>=n){for(48==n&&(n=m.charCodeAt(ac+1),n>=48&&57>=n)&&Y(),x=!1;l>ac&&(n=m.charCodeAt(ac),n>=48&&57>=n);ac++){}if(46==m.charCodeAt(ac)){for(y=++ac;l>y&&(n=m.charCodeAt(y),n>=48&&57>=n);y++){}y==ac&&Y(),ac=y}if(n=m.charCodeAt(ac),101==n||69==n){for(n=m.charCodeAt(++ac),(43==n||45==n)&&ac++,y=ac;l>y&&(n=m.charCodeAt(y),n>=48&&57>=n);y++){}y==ac&&Y(),ac=y}return +m.slice(j,ac)}if(x&&Y(),"true"==m.slice(ac,ac+4)){return ac+=4,!0}if("false"==m.slice(ac,ac+5)){return ac+=5,!1}if("null"==m.slice(ac,ac+4)){return ac+=4,null}Y()}}return"$"},W=function(k){var j,l;if("$"==k&&Y(),"string"==typeof k){if("@"==(am?k.charAt(0):k[0])){return k.slice(1)}if("["==k){for(j=[];k=X(),"]"!=k;l||(l=!0)){l&&(","==k?(k=X(),"]"==k&&Y()):Y()),","==k&&Y(),j.push(W(k))}return j}if("{"==k){for(j={};k=X(),"}"!=k;l||(l=!0)){l&&(","==k?(k=X(),"}"==k&&Y()):Y()),(","==k||"string"!=typeof k||"@"!=(am?k.charAt(0):k[0])||":"!=X())&&Y(),j[k.slice(1)]=W(X())}return j}Y()}return k},V=function(k,j,m){var l=U(k,j,m);l===ay?delete k[j]:k[j]=l},U=function(k,j,n){var m,l=k[j];if("object"==typeof l&&l){if(aw.call(l)==ao){for(m=l.length;m--;){V(l,m,n)}}else{az(l,function(x){V(l,x,n)})}}return n.call(k,j,l)};aK.parse=function(k,j){var m,l;return ac=0,ab=""+k,m=W(X()),"$"!=X()&&Y(),ac=ab=null,j&&aw.call(j)==at?U((l={},l[""]=m,l),"",j):m}}}return aK.runInContext=w,aK}var v="function"==typeof e&&e.amd,u={"function":!0,object:!0},t=u[typeof f]&&f&&!f.nodeType&&f,s=u[typeof window]&&window||this,r=t&&u[typeof g]&&g&&!g.nodeType&&"object"==typeof h&&h;if(!r||r.global!==r&&r.window!==r&&r.self!==r||(s=r),t&&!v){w(s,t)}else{var q=s.JSON,p=s.JSON3,o=!1,b=w(s,s.JSON3={noConflict:function(){return o||(o=!0,s.JSON=q,s.JSON3=p,q=p=null),b}});s.JSON={parse:b.parse,stringify:b.stringify}}v&&e(function(){return b})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],51:[function(g,f,j){function h(l,k){var n=[];k=k||0;for(var m=k||0;m<l.length;m++){n[m-k]=l[m]}return n}f.exports=h},{}]},{},[31])(31)});(function(){var f=["useCORSRouteToGetCookie","url","multiplex","transports","query","path","headers","initialConnectionHeaders","reconnection","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","randomizationFactor","timeout"];var d=["autoConnect","environment","headers","url","transports","path"];var h={version:"__sails_io_sdk_version",platform:"__sails_io_sdk_platform",language:"__sails_io_sdk_language"};var k={version:"0.13.6",language:"javascript",platform:(function(){if(typeof module==="object"&&typeof module.exports!=="undefined"){return"node"}else{return"browser"}})()};k.versionString=h.version+"="+k.version+"&"+h.platform+"="+k.platform+"&"+h.language+"="+k.language;var e=(function(){if(typeof window!=="object"||typeof window.document!=="object"||typeof window.document.getElementsByTagName!=="function"){return null}var l=window.document.getElementsByTagName("script");return l[l.length-1]})();var g="";var b={};if(e){g=e.src;d.forEach(function(l){b[l]=(function(){var m=e.getAttribute("data-"+l);if(!m){m=e.getAttribute(l)}if(typeof m==="string"){try{return JSON.parse(m)}catch(n){return m}}else{if(m===null){return undefined}else{throw new Error("sails.io.js :: Unexpected/invalid script tag configuration for `"+l+"`: `"+m+"` (a `"+typeof m+"`). Should be a string.")}}})();if(b[l]===undefined){delete b[l]}});if(typeof b.autoConnect!=="undefined"){if(b.autoConnect===""){b.autoConnect=true}else{if(typeof b.autoConnect!=="boolean"){throw new Error("sails.io.js :: Unexpected/invalid configuration for `autoConnect` provided in script tag: `"+b.autoConnect+"` (a `"+typeof b.autoConnect+"`). Should be a boolean.")}}}if(typeof b.environment!=="undefined"){if(typeof b.environment!=="string"){throw new Error("sails.io.js :: Unexpected/invalid configuration for `environment` provided in script tag: `"+b.environment+"` (a `"+typeof b.environment+"`). Should be a string.")}}if(typeof b.headers!=="undefined"){if(typeof b.headers!=="object"||Array.isArray(b.headers)){throw new Error("sails.io.js :: Unexpected/invalid configuration for `headers` provided in script tag: `"+b.headers+"` (a `"+typeof b.headers+'`). Should be a JSON-compatible dictionary (i.e. `{}`).  Don\'t forget those double quotes (""), even on key names!  Use single quotes (\'\') to wrap the HTML attribute value; e.g. `headers=\'{"X-Auth": "foo"}\'`')}}if(typeof b.url!=="undefined"){if(typeof b.url!=="string"){throw new Error("sails.io.js :: Unexpected/invalid configuration for `url` provided in script tag: `"+b.url+"` (a `"+typeof b.url+"`). Should be a string.")}}}var j=(typeof io!=="undefined")?io:undefined;function a(t){var r;if(t){r=t}else{r=j}if(!r){if(k.platform==="node"){throw new Error("No socket.io client available.  When requiring `sails.io.js` from Node.js, a socket.io client (`io`) must be passed in; e.g.:\n```\nvar io = require('sails.io.js')( require('socket.io-client') )\n```\n(see https://github.com/balderdashy/sails.io.js/tree/master/test for more examples)")}else{throw new Error("The Sails socket SDK depends on the socket.io client, but the socket.io global (`io`) was not available when `sails.io.js` loaded.  Normally, the socket.io client code is bundled with sails.io.js, so something is a little off.  Please check to be sure this version of `sails.io.js` has the minified Socket.io client at the top of the file.")}}if(r.sails){if(k.platform==="node"){throw new Error("The provided socket.io client (`io`) has already been augmented into a Sails socket SDK instance (it has `io.sails`).")}else{throw new Error("The socket.io client (`io`) has already been augmented into a Sails socket SDK instance.  Usually, this means you are bringing `sails.io.js` onto the page more than once.")}}function p(u){u=u||{prefix:true};if(typeof console!=="object"||typeof console.log!=="function"||typeof console.log.bind!=="function"){return function w(){}}return function v(){var x=Array.prototype.slice.call(arguments);if(r.sails.environment==="production"){return}var y="";if(u.prefix){x.unshift(y)}console.log.bind(console).apply(this,x)}}var q=p();q.noPrefix=p({prefix:false});function l(v){var u=v.requestQueue;if(!u){return}for(var w in u){var x=({}).hasOwnProperty.call(u,w);if(x){var y=u[w];v.request.apply(v,y)}}v.requestQueue=null}function s(w,u){w=w||{};if(typeof window==="undefined"){return u()}var v=document.createElement("script");window._sailsIoJSConnect=function(x){v.parentNode.removeChild(v);u(x)};v.src=w.url;document.getElementsByTagName("head")[0].appendChild(v)}function m(u){this.body=u.body||{};this.headers=u.headers||{};this.statusCode=u.statusCode||200;if(this.statusCode<200||this.statusCode>=400){this.error=this.body||this.statusCode}}m.prototype.toString=function(){return"[ResponseFromSails]  -- Status: "+this.statusCode+"  -- Headers: "+this.headers+"  -- Body: "+this.body};m.prototype.toPOJO=function(){return{body:this.body,headers:this.headers,statusCode:this.statusCode}};m.prototype.pipe=function(){return new Error("Client-side streaming support not implemented yet.")};function n(v,x){if(!v._raw){throw new Error("Failed to emit from socket- raw SIO socket is missing.")}var u=x.cb;delete x.cb;var w=x.method;v._raw.emit(w,x,function y(z){if(u){u(z.body,new m(z))}})}function o(w){var u=this;w=w||{};var v={};f.forEach(function(x){if(x=="headers"){return}Object.defineProperty(u,x,{get:function(){if(x=="url"){return v[x]||(u._raw&&u._raw.io&&u._raw.io.uri)}return v[x]},set:function(y){if(u.isConnected()&&r.sails.strict!==false&&y!=v[x]){throw new Error("Cannot change value of `"+x+"` while socket is connected.")}if(u._raw&&u._raw.io&&u._raw.io.reconnecting&&!u._raw.io.skipReconnect){u._raw.io.skipReconnect=true;q("Stopping reconnect; use .reconnect() to connect socket after changing options.")}v[x]=y}})});f.forEach(function(x){u[x]=w[x]});u.eventQueue={};u.on("sails:parseError",function(x){q("Sails encountered an error parsing a socket message sent from this client, and did not have access to a callback function to respond with.");q("Error details:",x)})}o.prototype._connect=function(){var w=this;w.isConnecting=true;f.forEach(function(y){if("undefined"==typeof w[y]){w[y]=r.sails[y]}});w.extraHeaders=w.initialConnectionHeaders||{};if(w.initialConnectionHeaders&&k.platform!=="node"){if(typeof console==="object"&&typeof console.warn==="function"){console.warn("initialConnectionHeaders option available in Node.js only!")}}w.url=w.url?w.url.replace(/(\/)$/,""):undefined;if(typeof w.query!=="string"){w.query=k.versionString}else{w.query+="&"+k.versionString}var v=(function(){if(typeof window==="undefined"||typeof window.location==="undefined"){return false}if(typeof w.url!=="string"){return false}var C=(function(){try{C=w.url.match(/^([a-z]+:\/\/)/i)[1].toLowerCase()}catch(F){}C=C||"http://";return C})();var A=!!w.url.match("^https");var B=(function(){try{return w.url.match(/^[a-z]+:\/\/[^:]*:([0-9]*)/i)[1]}catch(F){}return A?"443":"80"})();var y=w.url.replace(/^([a-z]+:\/\/)/i,"");if(C.replace(/[:\/]/g,"")!==window.location.protocol.replace(/[:\/]/g,"")){return true}var D=y.search(window.location.hostname)===0;if(!D){return true}var E=window.location.protocol.match(/https/i);var z=(window.location.port+"")||(E?"443":"80");if(B!==z){return true}return false})();(function u(y){if(!(w.useCORSRouteToGetCookie&&v)){return y()}var z=w.url;if(typeof w.useCORSRouteToGetCookie==="string"){z+=w.useCORSRouteToGetCookie}else{z+="/__getcookie"}if(typeof window!=="undefined"){s({url:z,method:"GET"},y);return}var A=require("request");A.get(z,function(D,C,B){if(D){w.isConnecting=false;q("Failed to connect socket (failed to get cookie)","Error:",D);return}y()})})(function x(){w._raw=r(w.url,w);w.replay();w.on("connect",function z(){w.isConnecting=false;q.noPrefix("\n\n  |>    Now connected to Sails.\n\\___/   For help, see: http://bit.ly/1DmTvgK\n        (using sails.io.js "+r.sails.sdk.platform+" SDK @v"+r.sails.sdk.version+")\n\n\n")});w.on("disconnect",function(){w.connectionLostTimestamp=(new Date()).getTime();q("====================================");q("Socket was disconnected from Sails.");q("Usually, this is due to one of the following reasons:\n -> the server "+(w.url?w.url+" ":"")+"was taken down\n -> your browser lost internet connectivity");q("====================================")});w.on("reconnecting",function(A){q("\n        Socket is trying to reconnect to Sails...\n_-|>_-  (attempt #"+A+")\n\n")});w.on("reconnect",function(D,B){if(!w.isConnecting){w.on("connect",l.bind(w,w))}var C=((new Date()).getTime()-w.connectionLostTimestamp);var A=(C/1000);q("\n  |>    Socket reconnected successfully after\n\\___/   being offline for ~"+A+" seconds.\n\n")});w.on("error",function y(A){w.isConnecting=false;q("Failed to connect socket (possibly due to failed `beforeConnect` on server)","Error:",A)})})};o.prototype.reconnect=function(){if(this.isConnecting){throw new Error("Cannot connect- socket is already connecting")}if(this.isConnected()){throw new Error("Cannot connect- socket is already connected")}return this._connect()};o.prototype.disconnect=function(){this.isConnecting=false;if(!this.isConnected()){throw new Error("Cannot disconnect- socket is already disconnected")}return this._raw.disconnect()};o.prototype.isConnected=function(){if(!this._raw){return false}return !!this._raw.connected};o.prototype.replay=function(){var u=this;for(var w in u.eventQueue){for(var v in u.eventQueue[w]){u._raw.on(w,u.eventQueue[w][v])}}if(!u.isConnected()){u._raw.once("connect",l.bind(u,u))}else{l(u)}return u};o.prototype.on=function(u,v){if(this._raw){this._raw.on(u,v);return this}if(!this.eventQueue[u]){this.eventQueue[u]=[v]}else{this.eventQueue[u].push(v)}return this};o.prototype.off=function(u,v){if(this._raw){this._raw.off(u,v);return this}if(this.eventQueue[u]&&this.eventQueue[u].indexOf(v)>-1){this.eventQueue[u].splice(this.eventQueue[u].indexOf(v),1)}return this};o.prototype.removeAllListeners=function(){if(this._raw){this._raw.removeAllListeners();return this}this.eventQueue={};return this};o.prototype.get=function(v,w,u){if(typeof w==="function"){u=w;w={}}return this.request({method:"get",params:w,url:v},u)};o.prototype.post=function(v,w,u){if(typeof w==="function"){u=w;w={}}return this.request({method:"post",data:w,url:v},u)};o.prototype.put=function(v,w,u){if(typeof w==="function"){u=w;w={}}return this.request({method:"put",params:w,url:v},u)};o.prototype["delete"]=function(v,w,u){if(typeof w==="function"){u=w;w={}}return this.request({method:"delete",params:w,url:v},u)};o.prototype.request=function(w,u){var x='Usage:\nsocket.request( options, [fnToCallWhenComplete] )\n\noptions.url :: e.g. "/foo/bar"\noptions.method :: e.g. "get", "post", "put", or "delete", etc.\noptions.params :: e.g. { emailAddress: "mike@sailsjs.org" }\noptions.headers :: e.g. { "x-my-custom-header": "some string" }';if(typeof w!=="object"||typeof w.url!=="string"){throw new Error("Invalid or missing URL!\n"+x)}if(w.method&&typeof w.method!=="string"){throw new Error('Invalid `method` provided (should be a string like "post" or "put")\n'+x)}if(w.headers&&typeof w.headers!=="object"){throw new Error("Invalid `headers` provided (should be a dictionary with string values)\n"+x)}if(w.params&&typeof w.params!=="object"){throw new Error("Invalid `params` provided (should be a dictionary with JSON-serializable values)\n"+x)}if(w.data&&typeof w.data!=="object"){throw new Error("Invalid `data` provided (should be a dictionary with JSON-serializable values)\n"+x)}if(u&&typeof u!=="function"){throw new Error("Invalid callback function!\n"+x)}if(w.data&&w.params){throw new Error("Cannot specify both `params` and `data`!  They are aliases of each other.\n"+x)}else{if(w.data){w.params=w.data;delete w.data}}if(!this.isConnected()){this.requestQueue=this.requestQueue||[];this.requestQueue.push([w,u]);return}w.headers=w.headers||{};var v={method:w.method.toLowerCase()||"get",headers:w.headers,data:w.params||w.data||{},url:w.url.replace(/^(.+)\/*\s*$/,"$1"),cb:u};if(this.headers&&"object"==typeof this.headers){for(var y in this.headers){if(!w.headers.hasOwnProperty(y)){w.headers[y]=this.headers[y]}}}n(this,v)};o.prototype._request=function(v,u){throw new Error("`_request()` was a private API deprecated as of v0.11 of the sails.io.js client. Use `.request()` instead.")};r.sails={autoConnect:true,useCORSRouteToGetCookie:true,environment:g.match(/(\#production|\.min\.js)/g)?"production":"development",sdk:k,transports:["polling","websocket"]};d.forEach(function(u){if(typeof b[u]!=="undefined"){r.sails[u]=b[u]}});r.sails.connect=function(v,w){if("object"===typeof v){w=v;v=null}w=w||{};w.url=v||w.url||undefined;var u=new o(w);u._connect();return u};r.socket=new o();setTimeout(function(){if(r.sails.autoConnect===false||r.sails.autoconnect===false){delete r.socket;return}r.socket._connect()},0);return r}if(k.platform==="node"){module.exports=a}else{if(typeof define==="function"&&define.amd){define([],function(){return a})}else{a()}}})();(function(d,a,e){var b=d.TractisPKI,f={};f.version="1.0.0";f.noConflict=function(){d.TractisPKI=b;return this};d.TractisPKI=f;f.Util={extend:function(l){var k=Array.prototype.slice.call(arguments,1),m,h,g,n;for(h=0,g=k.length;h<g;h++){n=k[h]||{};for(m in n){if(n.hasOwnProperty(m)){l[m]=n[m]}}}return l},setOptions:function(h,g){h.options=f.extend({},h.options,g);return h.options},nullifempty:function(g){if(g===""){return null}return g}};f.extend=f.Util.extend;f.setOptions=f.Util.setOptions;(function(){var g=false,h=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;f.Class=function(){};f.Class.extend=function(n){var m=this.prototype;g=true;var l=new this();g=false;for(var k in n){l[k]=typeof n[k]=="function"&&typeof m[k]=="function"&&h.test(n[k])?(function(o,p){return function(){var r=this._super;this._super=m[o];var q=p.apply(this,arguments);this._super=r;return q}})(k,n[k]):n[k]}function j(){if(!g&&this.initialize){this.initialize.apply(this,arguments)}}j.prototype=l;j.prototype.constructor=j;j.extend=arguments.callee;return j}})();f.ServiceConnector=f.Class.extend({});f.NullServiceConnector=f.ServiceConnector.extend({options:{},initialize:function(g){var h=this;f.setOptions(this,g)},sendCommand:function(h,g,j){},disconnect:function(){}});f.PkiClientApiV1=f.Class.extend({options:{serviceConnector:null},initialize:function(g){f.setOptions(this,g)},getCertList:function(g,h){this.options.serviceConnector.sendCommand("v1/certificates",{policyList:g},h)},signContract:function(k,j,g,h,m){var l={baseUrl:k,cookie:j,hashCert:g};if(typeof h!=="undefined"){l.spp=h}this.options.serviceConnector.sendCommand("v1/signatures/xades/contract",l,m)},auth:function(j,g,h,l){var k={hashValue:j,hashCert:g};if(typeof h!=="undefined"){k.spp=h}this.options.serviceConnector.sendCommand("v1/signatures/xades/hash",k,l)},bootlog:function(g){this.options.serviceConnector.sendCommand("v1/status/bootlog",{},g)}})}(window,document));(function(e,b,f){var g=e.TractisPKI;var d="tractis-app";function a(h){var j=b.createElement("a");j.href=h;return j}g.ProtocolDetector=g.Class.extend({options:{timeout:180,protocol:d},initialize:function(h){g.setOptions(this,h)},detect:function(j){var h=this;e.protocolCheck(h.options.protocol,function(){if(j){j(true,"protocol not recognized")}});setTimeout(function(){if(j){j(false)}},h.options.timeout*1000)}});g.WsConnector=g.ServiceConnector.extend({options:{wport:65999,timeout:60,timeretry:5,endPointUrl:false,endPointLog:true,endPointLogCookies:false,onLog:function(){},onCertChange:function(){}},initialize:function(j){var l=this;g.setOptions(this,j);l._sendEndPointLog("info","try to connect to websocket");this.websocket=io.sails.connect("https://127.0.0.1:"+this.options.wport);var h=setInterval(function(){try{l.websocket.disconnect()}catch(m){}l.websocket.reconnect()},l.options.timeretry*1000);this.websocket.on("log",function(m){l._sendEndPointLog("info",m);l.options.onLog(m)});this.websocket.on("certchange",function(m){l._sendEndPointLog("info","certchange:"+m);l.options.onCertChange(m);PkiClientManager.reload()});this.websocket.on("error",function(){setTimeout(function(){this.websocket.reconnect()},l.options.timeretry*1000)});this.websocket.on("connect",function k(n,m){l._sendEndPointLog("info","connected to websocket");clearInterval(h)})},_sendEndPointLog:function(m,k){if(this.options.endPointLog){var j={type:"post",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({url:e.location.href,severity:m,content:k,version:PkiClientCerts.getClientVersion()})};var h;if(this.options.endPointUrl){j.url=this.options.endPointUrl;j.crossDomain=true}else{var l=a(e.location);j.url=((l.protocol=="")?"http:":l.protocol)+"//"+(l.hostname)+((l.port=="")?"":":"+(l.port))+"/pkiclient/log"}if(this.options.endPointCookies){j.setCookies=this.options.endPointCookies}jQuery.ajax(j)}},sendCommand:function(n,m,o){var l=this;var h=o;this._sendEndPointLog("info","sending command:"+n);var j=setTimeout(function(){l._sendEndPointLog("info","timeout on command:"+n);if(h){h(true,"timeout",null)}h=false},l.options.timeout*1000);l.websocket.get("/"+n,m,function k(p,q){clearTimeout(j);if(q.statusCode==200){l._sendEndPointLog("info","success on command:"+n);if(h){h(false,p,q)}h=false}else{l._sendEndPointLog("error",q.statusCode+":"+p);if(h){h(true,p,q)}h=false}})},disconnect:function(){this.websocket.disconnect()}})}(window,document));var PkiClientConf={port:64999,timeout:60,mode:"signature",isl:"tractis",customProtocol:"tractis-app",waitClientRetry:5000,waitClientTrys:100,pingClientTimeout:2000,checkDateTimeout:5000};var PkiClientCerts={isSupported:function(){return(typeof(Storage)!=="undefined")},clean:function(){localStorage.removeItem("selectedCert");localStorage.removeItem("acceptedCerts");localStorage.removeItem("rejectedCerts");localStorage.removeItem("policies");localStorage.removeItem("mode");localStorage.removeItem("is_reloading");localStorage.removeItem("clientVersion")},setIsReloading:function(a){localStorage.setItem("isReloading",a)},getIsReloading:function(){return localStorage.isReloading},setClientVersion:function(a){localStorage.setItem("clientVersion",a)},getClientVersion:function(){return localStorage.clientVersion},setMode:function(a){localStorage.setItem("mode",a)},getMode:function(){return localStorage.mode},setPolicies:function(a){localStorage.setItem("policies",JSON.stringify(a))},getPolicies:function(){policies=JSON.parse(localStorage.policies);return JSON.parse(policies)},setSelectedCert:function(a){localStorage.setItem("selectedCert",JSON.stringify(a))},getSelectedCert:function(){return JSON.parse(localStorage.getItem("selectedCert"))},addToAcceptedCerts:function(a){var b=PkiClientCerts.getAcceptedCerts();b.push(a);localStorage.setItem("acceptedCerts",JSON.stringify(b))},getAcceptedCerts:function(){if(localStorage.acceptedCerts===undefined){localStorage.setItem("acceptedCerts",JSON.stringify([]))}var a=JSON.parse(localStorage.getItem("acceptedCerts"));return JSON.parse(a)},addToRejectedCerts:function(a){var b=PkiClientCerts.getRejectedCerts();b.push(a);localStorage.setItem("rejectedCerts",JSON.stringify(b))},getRejectedCerts:function(){if(localStorage.rejectedCerts===undefined){localStorage.setItem("rejectedCerts",JSON.stringify([]))}var a=JSON.parse(localStorage.getItem("rejectedCerts"));return JSON.parse(a)},getAllCerts:function(){return PkiClientCerts.getAcceptedCerts().concat(PkiClientCerts.getRejectedCerts())},cleanAllCerts:function(){localStorage.removeItem("acceptedCerts");localStorage.removeItem("rejectedCerts")},isOnlyOneCertAccepted:function(){var a=PkiClientCerts.getAcceptedCerts();return(a&&a.length==1)},noCertsAccepted:function(){var a=PkiClientCerts.getAcceptedCerts();return(a&&a.length==0)}};var PkiClientInit={isBrowserSupported:function(){return(typeof(Storage)!=="undefined")},getOsInfo:function(){var a=null;if(navigator.userAgent.indexOf("WOW64")!=-1||navigator.userAgent.indexOf("Win64")!=-1){a="64"}else{a="32"}return{vendor:"win",arch:a}},init:function(a){PkiClientInit.ping(function(b){if(b){a(false,false)}else{PkiClientInit.start(function(d,e){a(d,e)})}})},start:function(a){var b=PkiClientConf.customProtocol+":lang="+PkiClientManager.readCookie("lang");window.protocolCheck(b,function(){a({code:"client_not_installed"},{os:PkiClientInit.getOsInfo()})},function(){console.log("Custom-protocol-detector: installed")});PkiClientInit.wait(PkiClientConf.waitClientTrys,function(d){if(d){a(false,false)}else{a({code:"client_wait_timeout"},false)}})},wait:function(b,a){var d=PkiClientConf.waitClientTrys;PkiClientInit.ping(function(f){if(f){a(true)}else{var e=b-1;if(e<1){a(false)}else{setTimeout(function(){PkiClientInit.wait(e,a)},PkiClientConf.waitClientRetry)}}})},ping:function(a){jQuery.ajax({type:"GET",url:"https://127.0.0.1:"+PkiClientConf.port+"/v1/status",success:function(e){if(e===null){var b="not_know"}else{if(typeof e==="object"){var b=e.version}else{var d=JSON.parse(e);var b=d.version}}console.log(" - Contacted with TractisApp "+e+"("+b+")");PkiClientCerts.setClientVersion(b);a(true)},error:function(d,e,b){a(false)},timeout:PkiClientConf.pingClientTimeout})},checkDateTime:function(a){console.log("calling check-date-time");jQuery.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({osDateTime:(new Date()).toUTCString()}),url:"/pkiclient/time",success:function(b){a(false)},error:function(d,e,b){if(d.status===406){a(true)}else{a(false)}},timeout:PkiClientConf.checkDateTimeout})}};var PkiClientManager={reload:function(){var a=PkiClientCerts.getMode();PkiClientManager.init(undefined,a)},init:function(a,b){PkiClientInit.checkDateTime(function(d){if(d){$("detecting_certificates").style.display="none";$("client_date_in_future").style.display="";return}else{if(a!=undefined){PkiClientCerts.clean();PkiClientCerts.setIsReloading(false)}else{PkiClientCerts.setIsReloading(true)}PkiClientCerts.setMode(b);PkiClientInit.init(function(g,h){if(g&&g.code==="browser_not_supported"){Alerts.error(_("Browser not supported"),[_("Please contact support")]);return}if(g&&g.code==="client_not_installed"){$("detecting_certificates").style.display="none";$("client_not_installed").style.display="";return}if(g&&g.code==="client_wait_timeout"){Alerts.error(_("Error"),[_("We can connect to our certificate client")]);return}if($("detecting_certificates")){$("detecting_certificates").style.display=""}if($("client_not_installed")){$("client_not_installed").style.display="none"}if(a==undefined){var e=PkiClientCerts.getPolicies()}else{if(b=="signature"){var e=JSON.parse(a).allowed_policies}else{var f=JSON.parse(a).policies;var e=Object.keys(f).map(function(j){return f[j]});e=e[0]}PkiClientCerts.setPolicies(e)}pkiConnector=new TractisPKI.WsConnector({timeout:PkiClientConf.timeout,port:PkiClientConf.isl,wport:PkiClientConf.port});pkiClient=new TractisPKI.PkiClientApiV1({serviceConnector:pkiConnector});PkiClientManager.loadCertificates(function(j){if(!j){PkiClientManager.startFlow()}else{Alerts.error(_("Error loading certificates"),[_("Please contact support")])}})})}})},loadCertificates:function(b){Alerts.show_spinner();var a=PkiClientCerts.getPolicies();pkiClient.getCertList(a,function(g,d){if(!g){PkiClientCerts.cleanAllCerts();var f=d;for(i=0;i<f.length;i++){var e=f[i];if(e.rejectedReasons===undefined){PkiClientCerts.addToAcceptedCerts(e)}else{PkiClientCerts.addToRejectedCerts(e)}}Alerts.hide_spinner();b(false)}else{Alerts.error(_("Error"),[_("Error")]);b(true)}})},startFlow:function(){if(PkiClientCerts.noCertsAccepted()){new Ajax.Request("/signature/no_cert_detected",{method:"get"})}else{if(PkiClientCerts.isOnlyOneCertAccepted()){PkiClientManager.proceedToSplash(PkiClientCerts.getAcceptedCerts()[0])}else{if(PkiClientCerts.getIsReloading()=="true"){if(!$("signature_certs_list")){var b="step[next]=certificate_dialog&contract[id]="+$("contract_id").value+"&load_cert=false&select_cert=true&pki_client_go=showCertificateList";var a=new Ajax.Request("/signature/next",{method:"post",parameters:b})}else{PkiClientManager.showCertificateList()}}else{PkiClientManager.showCertificateList()}}}},authProceedToFillData:function(a){if(a){if(PkiClientManager.isAcceptedCertificateSelected()){var b=$("selected_accepted").value;PkiClientManager.selectCertificate();new Ajax.Request("/verifications/authenticate",{method:"post"})}else{AppletUtils.renderError(_("This is a non-accepted certificate."),[_("Please, select an accepted certificate to authenticate.")])}}else{new Ajax.Request("/verifications/authenticate",{method:"post"})}},isAcceptedCertificateSelected:function(){if($("selected_accepted").value!==null&&$("selected_accepted").value==="true"){return true}else{return true}},changeCertificate:function(){var b="step[next]=certificate_dialog&contract[id]="+$("contract_id").value+"&load_cert=true&select_cert=true";var a=new Ajax.Request("/signature/next",{method:"post",parameters:b})},proceedToSplash:function(b){PkiClientManager.markSelected(b);if(PkiClientCerts.getMode()=="signature"){var d="step[next]=fill_data&contract[id]="+$("contract_id").value+"&selected[hash]="+b.hash+"&selected[issuer]="+b.ca+"&selected[subject]="+b.name+"&selected[qcstatements]="+b.qcstatements;var a=new Ajax.Request("/signature/next",{method:"post",parameters:d})}else{PkiClientManager.authProceedToFillData(false)}},showCertificateList:function(){var b=PkiClientCerts.getAcceptedCerts();var a=PkiClientCerts.getRejectedCerts();if(PkiClientManager.getLoadedCertCount()>0){ListUtils.removeLastOption($("signature_certs_list"))}$("signature_certs_list").innerHTML="";if(b&&b.length>0){acceptedList=PkiClientManager.enableAcceptedList($("signature_certs_list"));for(i=0;i<b.length;i++){PkiClientManager.addCertificateToList(acceptedList,b[i])}PkiClientManager.markSelected(b[0])}if(a&&a.length>0){rejectedList=PkiClientManager.enableRejectedList($("signature_certs_list"));for(i=0;i<a.length;i++){PkiClientManager.addCertificateToList(rejectedList,a[i])}}PkiClientManager.displayCertificateCombo();PkiClientManager.selectCertificate()},markSelected:function(a){PkiClientCerts.setSelectedCert(a)},selectCertificate:function(){var a=PkiClientManager.get_selected_cert();var b=PkiClientCerts.getAllCerts();for(i=0;i<b.length;i++){if(b[i].hash===a){PkiClientManager.markSelected(b[i]);PkiClientManager.updateCertificateInfo();return}}},get_selected_cert:function(){return ListUtils.getSelectedOption($("signature_certs_list"))},updateCertificateInfo:function(){var e=PkiClientCerts.getSelectedCert();if(e===null){PkiClientManager.deactivateCertificateDetails();return}var a=e.ca;var b=e.cn;var d=e.qcstatements;var f=null;if(e.rejectedReasons){f=JSON.parse(e.rejectedReasons)}$("issuer").firstChild.nodeValue=a;$("subject").firstChild.nodeValue=b;$("selected_qcstatements").setValue(d);if(f!==null){PkiClientManager.activateRejectedData(e,f[0]._str)}else{PkiClientManager.deactivateRejectedData()}PkiClientManager.activateCertificateDetails()},sign:function(a){Alerts.show_spinner(_("Signing..."));var f=PkiClientCerts.getSelectedCert();var g=new Date();var e=new Date(a);PkiClientManager.disableSignButtons();var b={city:new String($("signature_city").value),stateOrProvince:null,postalCode:null,countryName:ListUtils.getSelectedOption($("signature_country"))};var h=PkiClientManager.readCookie("_session_id");var d="_session_id="+h;pkiClient.signContract(window.location.href,d,f.hash,b,function(o,m){if(!o){var l=m.signature;Alerts.show_spinner(_("Validating the signature"));var p="signature="+escape(l)+"&contract="+$("contract_id").value;var k=f.chain;if(k!==null){p+="&additionalcertificates="+escape(k)}var j=f.encoded;if(j!==null){p+="&signaturecertificate="+escape(j)}if($("editor")){TractisEditor.setSaved()}var n=new Ajax.Request("/signature/validate_sign",{method:"post",parameters:p})}else{Alerts.error(_("Signature Error"),[_("We had a problem generating the signature, please contact support")])}})},authenticate:function(a){Alerts.show_spinner(_("Authenticating"));var d=PkiClientCerts.getSelectedCert();var e=new Date();var b=new Date(a);var f=$("to_be_sign_text").value;pkiClient.auth(f,d.hash,undefined,function(l,j){if(!l){var h=j.signature;if(h!==null){var g=d.chain;params="signature="+escape(h)+"&id="+$("to_be_sign_text").value;if(g!==null){params+="&additionalcertificates="+escape(g)}var k=new Ajax.Request("/verifications/update",{method:"post",parameters:params})}else{Alerts.error(_("Error"),[_("Error")])}}else{Alerts.error(_("Error"),[_("Error")])}})},readCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},activateCertificateDetails:function(){$("certificate_details").style.display=""},deactivateCertificateDetails:function(){$("certificate_details").style.display="none"},setCertificateData:function(){$("selected_issuer").setValue($("issuer").firstChild.nodeValue);$("selected_subject").setValue($("subject").firstChild.nodeValue)},activateRejectedData:function(a,b){$("details").className="divError";$("issuer_row").style.display="none";$("subject_row").style.display="none";$("cause_holder").style.display="";$("selected_encoded").value=a.encoded;$("cause").innerHTML=_(b);$("submit_rejected").style.display="none";PkiClientManager.disableNextStep();PkiClientManager.setCertificateData()},deactivateRejectedData:function(){$("selected_encoded").value=null;$("details").className="divEmisor";$("cause_holder").style.display="none";$("submit_rejected").style.display="none";$("issuer_row").style.display="";$("subject_row").style.display="";PkiClientManager.enableNextStep();PkiClientManager.setCertificateData()},getLoadedCertCount:function(){if($("signature_certs_list")){return ListUtils.getSize($("signature_certs_list"))}else{return 0}},enableAcceptedList:function(b){var a=_("You can use these certificates");var d="accepted";return this.recoverLabel(b,a,d)},enableRejectedList:function(b){var a=_("You cannot use these certificates");var d="rejected";return this.recoverLabel(b,a,d)},recoverLabel:function(b,a,e){var d=this.addGroup(a,e);b.appendChild(d);return d},addGroup:function(a,b){group=document.createElement("optgroup");group.setAttribute("label",a);group.setAttribute("id",b);return group},disableSpinner:function(){$("detecting_certificates").style.display="none";$("certificates_found").style.display=""},addCertificateToList:function(b,a){ListUtils.addOption(b,a.cn+", "+a.ca,a.hash);if(a.selected!=null&&a.selected=="true"){SignatureComponentManagerClient.selectedCert=a.hash}},displayCertificateCombo:function(){$("selectFromCombo").style.display="";$("next_button").style.display="";this.disableSpinner()},enableNextStep:function(){$("next_button_input").className="ok";$("selected_accepted").value=true},disableNextStep:function(){$("next_button_input").className="";$("selected_accepted").value=null},downloadApp:function(a){$("client_not_installed_before_download").style.display="none";$("client_not_installed_after_download").style.display="";window.location.href=a},disableSignButtons:function(){$("sign_submit").disabled=true;$("sign_submit").style.display="none";$("sign_cancel").disabled=true;$("signing_spinner").style.display=""}};